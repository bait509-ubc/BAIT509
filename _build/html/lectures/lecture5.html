
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5. Preprocessing Categorical Features and Column Transformer &#8212; BAIT 509 - Business Applications of Machine Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://bait509-ubc.github.io/BAIT509/intro.html/lectures/lecture5.html" />
    <link rel="shortcut icon" href="../_static/bait_logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Naive Bayes and Hyperparameter Optimization" href="lecture6.html" />
    <link rel="prev" title="4. SVM with RBF Kernel and Feature Preprocessing" href="lecture4.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/bait_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">BAIT 509 - Business Applications of Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption" role="heading">
 <span class="caption-text">
  Things You Should Know
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../things_to_know/who.html">
   Who: Hayley Boyce
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../things_to_know/how.html">
   How: The Course Structure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../things_to_know/what.html">
   What: Learning Outcomes
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="lecture1.html">
   1. Intro to ML &amp;  Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture2.html">
   2. Splitting and Cross-validation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture3.html">
   3. Baseline, k-Nearest Neighbours
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture4.html">
   4. SVM with RBF Kernel and Feature Preprocessing
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   5. Preprocessing Categorical Features and Column Transformer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture6.html">
   6. Naive Bayes and Hyperparameter Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture7.html">
   7. Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture8.html">
   8. Business Objectives/Statistical Questions and Feature Selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture9.html">
   9. Classification and Regression Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture10.html">
   10. Multi-Class, Pandas Profiling, Finale
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../things_to_know/attribution.html">
   Attribution
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/lecture5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/bait509-ubc/BAIT509"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/bait509-ubc/BAIT509/issues/new?title=Issue%20on%20page%20%2Flectures/lecture5.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/bait509-ubc/BAIT509/edit/master/lectures/lecture5.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/bait509-ubc/BAIT509/master?urlpath=tree/lectures/lecture5.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#house-keeping">
   5.1. House Keeping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-learning-objectives">
   5.2. Lecture Learning Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#five-minute-recap-lightning-questions">
   5.3. Five Minute Recap/ Lightning Questions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-lingering-questions">
     5.3.1. Some lingering questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introducing-categorical-feature-preprocessing">
   5.4. Introducing Categorical Feature Preprocessing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ordinal-encoding">
   5.5. Ordinal encoding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#one-hot-encoding">
   5.6. One-Hot Encoding
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-one-hot-encode">
     5.6.1. How to one-hot encode
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-happens-if-there-are-categories-in-the-test-data-that-are-not-in-the-training-data">
     5.6.2. What happens if there are categories in the test data, that are not in the training data?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cases-where-it-s-ok-to-break-the-golden-rule">
     5.6.3. Cases where it’s OK to break the golden rule
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#binary-features">
   5.7. Binary features
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#do-we-actually-want-to-use-certain-features-for-prediction">
   5.8. Do we actually want to use certain features for prediction?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-s-practice">
   5.9. Let’s Practice
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#columntransformer">
   5.10. ColumnTransformer
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#applying-columntransformer">
     5.10.1. Applying ColumnTransformer
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#do-we-need-to-preprocess-categorical-values-in-the-target-column">
       5.10.1.1. Do we need to preprocess categorical values in the target column?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-syntax">
   5.11. Make Syntax
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-pipeline">
     5.11.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       make_pipeline
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-column-transformer-syntax">
   5.12.
   <em>
    make_column_transformer
   </em>
   syntax
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   5.13. Let’s Practice
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#text-data">
   5.14. Text Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bag-of-words-bow-representation">
   5.15. Bag of words (BOW) representation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-bow-features-using-scikit-learn">
     5.15.1. Extracting BOW features using
     <em>
      scikit-learn
     </em>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#important-hyperparameters-of-countvectorizer">
     5.15.2. Important hyperparameters of
     <code class="docutils literal notranslate">
      <span class="pre">
       CountVectorizer
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#is-this-a-realistic-representation-of-text-data">
     5.15.3. Is this a realistic representation of text data?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   5.16. Let’s Practice
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-s-practice-coding">
   5.17. Let’s Practice - Coding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-we-ve-learned-today-a-id-9-a">
   5.18. What We’ve Learned Today
   <a id="9">
   </a>
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="preprocessing-categorical-features-and-column-transformer">
<h1><span class="section-number">5. </span>Preprocessing Categorical Features and Column Transformer<a class="headerlink" href="#preprocessing-categorical-features-and-column-transformer" title="Permalink to this headline">¶</a></h1>
<p><em>Hayley Boyce, May 3rd, 2021</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing our libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span><span class="p">,</span> <span class="n">DummyRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span><span class="p">,</span> <span class="n">SVC</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;code/&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">display_tree</span> <span class="kn">import</span> <span class="n">display_tree</span>
<span class="kn">from</span> <span class="nn">plot_classifier</span> <span class="kn">import</span> <span class="n">plot_classifier</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Preprocessing and pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">euclidean_distances</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="house-keeping">
<h2><span class="section-number">5.1. </span>House Keeping<a class="headerlink" href="#house-keeping" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Quiz on Wednesday</p></li>
<li><p>Grading issues contact these TAs:</p>
<ul>
<li><p>Question 1 and 2: Andy</p></li>
<li><p>Question 3: Daniel</p></li>
<li><p>Question 4: Ali</p></li>
</ul>
</li>
<li><p>Polls!</p></li>
<li><p>Assignment2 posted</p></li>
</ul>
</div>
<div class="section" id="lecture-learning-objectives">
<h2><span class="section-number">5.2. </span>Lecture Learning Objectives<a class="headerlink" href="#lecture-learning-objectives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Identify when it’s appropriate to apply ordinal encoding vs one-hot encoding.</p></li>
<li><p>Explain strategies to deal with categorical variables with too many categories.</p></li>
<li><p>Explain <code class="docutils literal notranslate"><span class="pre">handle_unknown=&quot;ignore&quot;</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code>.</p></li>
<li><p>Use the scikit-learn <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> function to implement preprocessing functions such as <code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code> and <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> to numeric and categorical features simultaneously.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> to build all our transformations together into one object and use it with <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> pipelines.</p></li>
<li><p>Explain why text data needs a different treatment than categorical variables.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> to encode text data.</p></li>
<li><p>Explain different hyperparameters of <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code>.</p></li>
</ul>
</div>
<div class="section" id="five-minute-recap-lightning-questions">
<h2><span class="section-number">5.3. </span>Five Minute Recap/ Lightning Questions<a class="headerlink" href="#five-minute-recap-lightning-questions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Where does most of the work happen in <span class="math notranslate nohighlight">\(k\)</span>-nn - <code class="docutils literal notranslate"><span class="pre">fit</span></code> or <code class="docutils literal notranslate"><span class="pre">predict</span></code>?</p></li>
<li><p>What are the 2 hyperparameters we looked at with Support Vector Machines with RBF kernel?</p></li>
<li><p>What is the range of values after Normalization?</p></li>
<li><p>Imputation will help data with missing values by removing which of the following; the column, the row or neither?</p></li>
<li><p>Pipelines help us not violate what?</p></li>
</ul>
<div class="section" id="some-lingering-questions">
<h3><span class="section-number">5.3.1. </span>Some lingering questions<a class="headerlink" href="#some-lingering-questions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>What about categorical features??!  How do we use them in our model!?</p></li>
<li><p>How do we combine everything?!</p></li>
<li><p>What about data with text?</p></li>
</ul>
</div>
</div>
<div class="section" id="introducing-categorical-feature-preprocessing">
<h2><span class="section-number">5.4. </span>Introducing Categorical Feature Preprocessing<a class="headerlink" href="#introducing-categorical-feature-preprocessing" title="Permalink to this headline">¶</a></h2>
<p>Let’s bring back our California housing dataset that we explored last class.
Remember we engineered some of the features in the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">housing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/housing.csv&quot;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">housing_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rooms_per_household</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;total_rooms&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">],</span>
                           <span class="n">bedrooms_per_household</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;total_bedrooms&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">],</span>
                           <span class="n">population_per_household</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">])</span>

<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rooms_per_household</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;total_rooms&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">],</span>
                         <span class="n">bedrooms_per_household</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;total_bedrooms&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">],</span>
                         <span class="n">population_per_household</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;households&quot;</span><span class="p">])</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;total_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;total_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">])</span>  
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;total_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;total_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">])</span> 

<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>113600.0</td>
      <td>INLAND</td>
      <td>4.897010</td>
      <td>1.056478</td>
      <td>4.318937</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>137500.0</td>
      <td>INLAND</td>
      <td>17.300000</td>
      <td>6.500000</td>
      <td>2.550000</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>170100.0</td>
      <td>NEAR OCEAN</td>
      <td>4.738701</td>
      <td>1.084746</td>
      <td>2.057910</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>129300.0</td>
      <td>INLAND</td>
      <td>5.733333</td>
      <td>0.961404</td>
      <td>3.154386</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>205000.0</td>
      <td>NEAR OCEAN</td>
      <td>3.817558</td>
      <td>1.004801</td>
      <td>4.323045</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Last class, we dropped the categorical feature <code class="docutils literal notranslate"><span class="pre">ocean_proximity</span></code> feature.</p>
<p>But it may help with our prediction! We’ve talked about how dropping columns is not always the best idea especially since we could be dropping potentially useful features.</p>
<p>Let’s create our <code class="docutils literal notranslate"><span class="pre">X_train</span></code> and <code class="docutils literal notranslate"><span class="pre">X_test</span></code> again but this time keeping the <code class="docutils literal notranslate"><span class="pre">ocean_proximity</span></code> feature in the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>

<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Can we make a pipeline and fit it with our <code class="docutils literal notranslate"><span class="pre">X_train</span></code> that has this column now?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
        <span class="p">(</span><span class="s2">&quot;reg&quot;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">()),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">62</span><span class="n">f05099a2d9</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.8/site-packages/sklearn/pipeline.py</span> in <span class="ni">fit</span><span class="nt">(self, X, y, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span><span class="sd">         fit_params_steps = self._check_fit_params(**fit_params)</span>
<span class="ne">--&gt; </span><span class="mi">330</span><span class="sd">         Xt = self._fit(X, y, **fit_params_steps)</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span><span class="sd">         with _print_elapsed_time(&#39;Pipeline&#39;,</span>
<span class="g g-Whitespace">    </span><span class="mi">332</span><span class="sd">                                  self._log_message(len(self.steps) - 1)):</span>

<span class="nn">/usr/local/lib/python3.8/site-packages/sklearn/pipeline.py</span> in <span class="ni">_fit</span><span class="nt">(self, X, y, **fit_params_steps)</span>
<span class="g g-Whitespace">    </span><span class="mi">290</span><span class="sd">                 cloned_transformer = clone(transformer)</span>
<span class="g g-Whitespace">    </span><span class="mi">291</span><span class="sd">             # Fit or load from cache the current transformer</span>
<span class="ne">--&gt; </span><span class="mi">292</span><span class="sd">             X, fitted_transformer = fit_transform_one_cached(</span>
<span class="g g-Whitespace">    </span><span class="mi">293</span><span class="sd">                 cloned_transformer, X, y, None,</span>
<span class="g g-Whitespace">    </span><span class="mi">294</span><span class="sd">                 message_clsname=&#39;Pipeline&#39;,</span>

<span class="nn">/usr/local/lib/python3.8/site-packages/joblib/memory.py</span> in <span class="ni">__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">350</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">351</span><span class="sd">     def __call__(self, *args, **kwargs):</span>
<span class="ne">--&gt; </span><span class="mi">352</span><span class="sd">         return self.func(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">354</span><span class="sd">     def call_and_shelve(self, *args, **kwargs):</span>

<span class="nn">/usr/local/lib/python3.8/site-packages/sklearn/pipeline.py</span> in <span class="ni">_fit_transform_one</span><span class="nt">(transformer, X, y, weight, message_clsname, message, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">738</span><span class="sd">     with _print_elapsed_time(message_clsname, message):</span>
<span class="g g-Whitespace">    </span><span class="mi">739</span><span class="sd">         if hasattr(transformer, &#39;fit_transform&#39;):</span>
<span class="ne">--&gt; </span><span class="mi">740</span><span class="sd">             res = transformer.fit_transform(X, y, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">741</span><span class="sd">         else:</span>
<span class="g g-Whitespace">    </span><span class="mi">742</span><span class="sd">             res = transformer.fit(X, y, **fit_params).transform(X)</span>

<span class="nn">/usr/local/lib/python3.8/site-packages/sklearn/base.py</span> in <span class="ni">fit_transform</span><span class="nt">(self, X, y, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">691</span><span class="sd">         else:</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span><span class="sd">             # fit method of arity 2 (supervised transformation)</span>
<span class="ne">--&gt; </span><span class="mi">693</span><span class="sd">             return self.fit(X, y, **fit_params).transform(X)</span>
<span class="g g-Whitespace">    </span><span class="mi">694</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">695</span><span class="sd"> </span>

<span class="nn">/usr/local/lib/python3.8/site-packages/sklearn/impute/_base.py</span> in <span class="ni">fit</span><span class="nt">(self, X, y)</span>
<span class="g g-Whitespace">    </span><span class="mi">275</span><span class="sd">         self : SimpleImputer</span>
<span class="g g-Whitespace">    </span><span class="mi">276</span><span class="sd">         &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">277</span>         <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_input</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">in_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">278</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fit_indicator</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">279</span> 

<span class="nn">/usr/local/lib/python3.8/site-packages/sklearn/impute/_base.py</span> in <span class="ni">_validate_input</span><span class="nt">(self, X, in_fit)</span>
<span class="g g-Whitespace">    </span><span class="mi">247</span>                 <span class="n">new_ve</span> <span class="o">=</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot use </span><span class="si">{}</span><span class="s2"> strategy with non-numeric &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">248</span>                                     <span class="s2">&quot;data:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strategy</span><span class="p">,</span> <span class="n">ve</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">249</span>                 <span class="k">raise</span> <span class="n">new_ve</span> <span class="kn">from</span> <span class="bp">None</span>
<span class="g g-Whitespace">    </span><span class="mi">250</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span>                 <span class="k">raise</span> <span class="n">ve</span>

<span class="ne">ValueError</span>: Cannot use median strategy with non-numeric data:
<span class="n">could</span> <span class="ow">not</span> <span class="n">convert</span> <span class="n">string</span> <span class="n">to</span> <span class="nb">float</span><span class="p">:</span> <span class="s1">&#39;INLAND&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Well, that was rude.</p>
<a class="reference internal image-reference" href="../_images/denied.png"><img alt="../_images/denied.png" src="../_images/denied.png" style="width: 40%;" /></a>
<p>It does not like the categorical column.</p>
<p><code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> only accepts numeric data as an input and it’s not sure how to handle the <code class="docutils literal notranslate"><span class="pre">ocean_proximity</span></code> feature.</p>
<p><strong>What now?</strong></p>
<p>We can:</p>
<ul class="simple">
<li><p>Drop the column (not recommended)</p></li>
<li><p>We can transform categorical features into numeric ones so that we can use them in the model.</p></li>
<li><p>There are two transformations we can do this with:</p>
<ul>
<li><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OrdinalEncoder.html" target="_blank">Ordinal encoding</a></p></li>
<li><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html" target="_blank">One-hot encoding</a> (recommended in most cases)</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="ordinal-encoding">
<h2><span class="section-number">5.5. </span>Ordinal encoding<a class="headerlink" href="#ordinal-encoding" title="Permalink to this headline">¶</a></h2>
<p>Ordinal encoding gives an ordinal numeric value to each unique value in the column.</p>
<p>Let’s take a look at a dummy dataframe to explain how to use ordinal encoding.</p>
<p>Here we have a categorical column specifying different movie ratings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_toy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;rating&#39;</span><span class="p">:[</span><span class="s1">&#39;Good&#39;</span><span class="p">,</span> <span class="s1">&#39;Bad&#39;</span><span class="p">,</span> <span class="s1">&#39;Good&#39;</span><span class="p">,</span> <span class="s1">&#39;Good&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;Bad&#39;</span><span class="p">,</span> <span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="s1">&#39;Good&#39;</span><span class="p">,</span> <span class="s1">&#39;Good&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="s1">&#39;Neutral&#39;</span><span class="p">,</span><span class="s1">&#39;Good&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;Bad&#39;</span><span class="p">,</span> <span class="s1">&#39;Good&#39;</span><span class="p">]})</span>
<span class="n">X_toy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Good</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bad</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Good</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Good</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bad</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Neutral</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Good</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Good</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Neutral</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Neutral</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Neutral</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Good</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Bad</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Good</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rating&#39;</span><span class="p">:</span> <span class="s1">&#39;frequency&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Good</th>
      <th>Neutral</th>
      <th>Bad</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>frequency</th>
      <td>7</td>
      <td>4</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Here we can simply assign an integer to each of our unique categorical labels.</p>
<p>We can use sklearn’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OrdinalEncoder.html"><code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code></a> transformer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oe</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">oe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">X_toy_ord</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>

<span class="n">X_toy_ord</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1],
       [0],
       [1],
       [1],
       [0],
       [2],
       [1],
       [1],
       [2],
       [2],
       [2],
       [1],
       [0],
       [1]])
</pre></div>
</div>
</div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>’s transformed output is an array, we can add it next to our original column to see what happened.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoding_view</span> <span class="o">=</span> <span class="n">X_toy</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rating_enc</span><span class="o">=</span><span class="n">X_toy_ord</span><span class="p">)</span>
<span class="n">encoding_view</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rating</th>
      <th>rating_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Good</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bad</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Good</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Good</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bad</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Neutral</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Good</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Good</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Neutral</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Neutral</td>
      <td>2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Neutral</td>
      <td>2</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Good</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Bad</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Good</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>we can see that each rating has been designated an integer value.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">Neutral</span></code> is represented by an encoded value of 2 and <code class="docutils literal notranslate"><span class="pre">Good</span></code> a value of 1. Shouldn’t <code class="docutils literal notranslate"><span class="pre">Good</span></code> have a higher value?</p>
<p>We can change that by setting the parameter <code class="docutils literal notranslate"><span class="pre">categories</span></code> within <code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bad&#39;</span><span class="p">,</span> <span class="s1">&#39;Neutral&#39;</span><span class="p">,</span> <span class="s1">&#39;Good&#39;</span><span class="p">]</span>

<span class="n">oe</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="n">ratings_order</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">oe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>
<span class="n">X_toy_ord</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>

<span class="n">encoding_view</span> <span class="o">=</span> <span class="n">X_toy</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rating_enc</span><span class="o">=</span><span class="n">X_toy_ord</span><span class="p">)</span>
<span class="n">encoding_view</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rating</th>
      <th>rating_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Good</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bad</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Good</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Good</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bad</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Neutral</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Good</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Good</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Neutral</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Neutral</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Neutral</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Good</td>
      <td>2</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Bad</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Good</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now our <code class="docutils literal notranslate"><span class="pre">Good</span></code> rating is given an ordinal value of 2 and the <code class="docutils literal notranslate"><span class="pre">Bad</span></code> rating is encoded as 0.</p>
<p>But let’s see what happens if we look at a different column now, for example, a categorical column specifying different languages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_toy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;language&#39;</span><span class="p">:[</span><span class="s1">&#39;English&#39;</span><span class="p">,</span> <span class="s1">&#39;Vietnamese&#39;</span><span class="p">,</span> <span class="s1">&#39;English&#39;</span><span class="p">,</span> <span class="s1">&#39;Mandarin&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;English&#39;</span><span class="p">,</span> <span class="s1">&#39;English&#39;</span><span class="p">,</span> <span class="s1">&#39;Mandarin&#39;</span><span class="p">,</span> <span class="s1">&#39;English&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;Vietnamese&#39;</span><span class="p">,</span> <span class="s1">&#39;Mandarin&#39;</span><span class="p">,</span> <span class="s1">&#39;French&#39;</span><span class="p">,</span><span class="s1">&#39;Spanish&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;Mandarin&#39;</span><span class="p">,</span> <span class="s1">&#39;Hindi&#39;</span><span class="p">]})</span>
<span class="n">X_toy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>language</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>English</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Vietnamese</td>
    </tr>
    <tr>
      <th>2</th>
      <td>English</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mandarin</td>
    </tr>
    <tr>
      <th>4</th>
      <td>English</td>
    </tr>
    <tr>
      <th>5</th>
      <td>English</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Mandarin</td>
    </tr>
    <tr>
      <th>7</th>
      <td>English</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Vietnamese</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Mandarin</td>
    </tr>
    <tr>
      <th>10</th>
      <td>French</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Spanish</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Mandarin</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Hindi</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_toy</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="s1">&#39;frequency&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>English</th>
      <th>Mandarin</th>
      <th>Vietnamese</th>
      <th>Hindi</th>
      <th>French</th>
      <th>Spanish</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>frequency</th>
      <td>5</td>
      <td>4</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">oe</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">oe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">);</span>
<span class="n">X_toy_ord</span> <span class="o">=</span> <span class="n">oe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>

<span class="n">encoding_view</span> <span class="o">=</span> <span class="n">X_toy</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">language_enc</span><span class="o">=</span><span class="n">X_toy_ord</span><span class="p">)</span>
<span class="n">encoding_view</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>language</th>
      <th>language_enc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>English</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Vietnamese</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>English</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mandarin</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>English</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>English</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Mandarin</td>
      <td>3</td>
    </tr>
    <tr>
      <th>7</th>
      <td>English</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Vietnamese</td>
      <td>5</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Mandarin</td>
      <td>3</td>
    </tr>
    <tr>
      <th>10</th>
      <td>French</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Spanish</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Mandarin</td>
      <td>3</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Hindi</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What’s the problem here though?</p>
<ul class="simple">
<li><p>We have imposed ordinality on the feature that is no ordinal in value.</p></li>
<li><p>For example, imagine when you are calculating distances. Is it fair to say that French and Hindi are closer than French and Spanish?</p></li>
<li><p>In general, label encoding is useful if there is ordinality in your data and capturing it is important for your problem, e.g., <code class="docutils literal notranslate"><span class="pre">[cold,</span> <span class="pre">warm,</span> <span class="pre">hot]</span></code>.</p></li>
</ul>
<p>So what do we do when our values are not truly ordinal categories?</p>
<p>We can do something called …</p>
</div>
<div class="section" id="one-hot-encoding">
<h2><span class="section-number">5.6. </span>One-Hot Encoding<a class="headerlink" href="#one-hot-encoding" title="Permalink to this headline">¶</a></h2>
<p>One-hot encoding (OHE) creates a new binary column for each category in a categorical column.</p>
<ul class="simple">
<li><p>If we have <span class="math notranslate nohighlight">\(c\)</span> categories in our column.</p>
<ul>
<li><p>We create <span class="math notranslate nohighlight">\(c\)</span> new binary columns to represent those categories.</p></li>
</ul>
</li>
</ul>
<div class="section" id="how-to-one-hot-encode">
<h3><span class="section-number">5.6.1. </span>How to one-hot encode<a class="headerlink" href="#how-to-one-hot-encode" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>

<span class="n">ohe</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="n">ohe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">);</span>
<span class="n">X_toy_ohe</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>

<span class="n">X_toy_ohe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 1],
       [1, 0, 0, 0, 0, 0],
       [0, 0, 0, 1, 0, 0],
       [1, 0, 0, 0, 0, 0],
       [1, 0, 0, 0, 0, 0],
       [0, 0, 0, 1, 0, 0],
       [1, 0, 0, 0, 0, 0],
       [0, 0, 0, 0, 0, 1],
       [0, 0, 0, 1, 0, 0],
       [0, 1, 0, 0, 0, 0],
       [0, 0, 0, 0, 1, 0],
       [0, 0, 0, 1, 0, 0],
       [0, 0, 1, 0, 0, 0]])
</pre></div>
</div>
</div>
</div>
<p>We can convert it to a Pandas dataframe and see that instead of 1 column, we have 6! (We don’t need to do this step we are just showing you how it works)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_toy_ohe</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">ohe</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">([</span><span class="s1">&#39;language&#39;</span><span class="p">]),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_toy</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>language_English</th>
      <th>language_French</th>
      <th>language_Hindi</th>
      <th>language_Mandarin</th>
      <th>language_Spanish</th>
      <th>language_Vietnamese</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s try this on our California housing dataset now.</p>
<p>Although <code class="docutils literal notranslate"><span class="pre">ocean_proximity</span></code> seems like an ordinal feature, let’s look at the possible categories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;INLAND&#39;, &#39;NEAR OCEAN&#39;, &#39;&lt;1H OCEAN&#39;, &#39;NEAR BAY&#39;, &#39;ISLAND&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<p>How would you order these?</p>
<p>Should <code class="docutils literal notranslate"><span class="pre">NEAR</span> <span class="pre">OCEAN</span></code> be higher in value than <code class="docutils literal notranslate"><span class="pre">NEAR</span> <span class="pre">BAY</span></code>?</p>
<p>In unsure times, maybe one-hot encoding is the better option.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
<span class="n">ohe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]])</span>
<span class="n">X_imp_ohe_train</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]])</span>

<span class="n">X_imp_ohe_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0, 1, 0, 0, 0],
       [0, 1, 0, 0, 0],
       [0, 0, 0, 0, 1],
       ...,
       [1, 0, 0, 0, 0],
       [0, 0, 0, 1, 0],
       [0, 1, 0, 0, 0]])
</pre></div>
</div>
</div>
</div>
<p>Ok great we’ve transformed our data, however, Just like before, the transformer outputs a NumPy array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_ohe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_imp_ohe_train</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">ohe</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">([</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">transformed_ohe</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ocean_proximity_&lt;1H OCEAN</th>
      <th>ocean_proximity_INLAND</th>
      <th>ocean_proximity_ISLAND</th>
      <th>ocean_proximity_NEAR BAY</th>
      <th>ocean_proximity_NEAR OCEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="what-happens-if-there-are-categories-in-the-test-data-that-are-not-in-the-training-data">
<h3><span class="section-number">5.6.2. </span>What happens if there are categories in the test data, that are not in the training data?<a class="headerlink" href="#what-happens-if-there-are-categories-in-the-test-data-that-are-not-in-the-training-data" title="Permalink to this headline">¶</a></h3>
<p>Usually, if this is the case, an error will occur. (Not buying it? Try one hot-encoding in the assignment without this argument!)</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> we can specify <code class="docutils literal notranslate"><span class="pre">handle_unknown=&quot;ignore&quot;</span></code> which will then create a row with all zeros.</p>
<p>That means that all categories that are not recognized to the transformer will appear the same for this feature.</p>
<p>You’ll get to use this in your assignment.</p>
<p>So our transformer above would then look like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="n">ohe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]])</span>
<span class="n">X_imp_ohe_train</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]])</span>

<span class="n">X_imp_ohe_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0, 1, 0, 0, 0],
       [0, 1, 0, 0, 0],
       [0, 0, 0, 0, 1],
       ...,
       [1, 0, 0, 0, 0],
       [0, 0, 0, 1, 0],
       [0, 1, 0, 0, 0]])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cases-where-it-s-ok-to-break-the-golden-rule">
<h3><span class="section-number">5.6.3. </span>Cases where it’s OK to break the golden rule<a class="headerlink" href="#cases-where-it-s-ok-to-break-the-golden-rule" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If it’s some fixed number of categories.</p></li>
</ul>
<p>For example, if the categories are provinces/territories of Canada, we know the possible values and we can just specify them.</p>
<p>If we know the categories, this might be a reasonable time to “violate the Golden Rule” (look at the test set) and just hard-code all the categories.</p>
<p>This syntax allows you to pre-define the categories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">provs_ters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AB&#39;</span><span class="p">,</span> <span class="s1">&#39;BC&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;NB&#39;</span><span class="p">,</span> <span class="s1">&#39;NL&#39;</span><span class="p">,</span> <span class="s1">&#39;NS&#39;</span><span class="p">,</span> <span class="s1">&#39;NT&#39;</span><span class="p">,</span> <span class="s1">&#39;NU&#39;</span><span class="p">,</span> <span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;PE&#39;</span><span class="p">,</span> <span class="s1">&#39;QC&#39;</span><span class="p">,</span> <span class="s1">&#39;SK&#39;</span><span class="p">,</span> <span class="s1">&#39;YT&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe_cat_example</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">provs_ters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="binary-features">
<h2><span class="section-number">5.7. </span>Binary features<a class="headerlink" href="#binary-features" title="Permalink to this headline">¶</a></h2>
<p>Let’s say we have the following toy feature, that contains information on if a beverage has caffeine in it or not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_toy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Caffeine&#39;</span><span class="p">:[</span><span class="s1">&#39;No&#39;</span><span class="p">,</span> <span class="s1">&#39;Yes&#39;</span><span class="p">,</span> <span class="s1">&#39;Yes&#39;</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;Yes&#39;</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;Yes&#39;</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">,</span> <span class="s1">&#39;Yes&#39;</span><span class="p">,</span><span class="s1">&#39;Yes&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;No&#39;</span><span class="p">,</span> <span class="s1">&#39;Yes&#39;</span><span class="p">]})</span>
<span class="n">X_toy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Caffeine</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>No</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Yes</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>No</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Yes</td>
    </tr>
    <tr>
      <th>5</th>
      <td>No</td>
    </tr>
    <tr>
      <th>6</th>
      <td>No</td>
    </tr>
    <tr>
      <th>7</th>
      <td>No</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Yes</td>
    </tr>
    <tr>
      <th>9</th>
      <td>No</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Yes</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Yes</td>
    </tr>
    <tr>
      <th>12</th>
      <td>No</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Yes</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>When we do one-hot encoding on this feature, we get 2 separate columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="n">ohe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">);</span>
<span class="n">X_toy_ohe</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>

<span class="n">X_toy_ohe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1, 0],
       [0, 1],
       [0, 1],
       [1, 0],
       [0, 1],
       [1, 0],
       [1, 0],
       [1, 0],
       [0, 1],
       [1, 0],
       [0, 1],
       [0, 1],
       [1, 0],
       [0, 1]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_toy_ohe</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">ohe</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">([</span><span class="s1">&#39;Caffeine&#39;</span><span class="p">]),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_toy</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Caffeine_No</th>
      <th>Caffeine_Yes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Do we really need 2 columns for this though?</p>
<p>Either something contains caffeine, or it does not. So we only really need 1 column for this.</p>
<p>So, for this feature with binary values, we can use an argument called <code class="docutils literal notranslate"><span class="pre">drop</span></code> within <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> and set it to <code class="docutils literal notranslate"><span class="pre">&quot;if_binary&quot;</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="s2">&quot;if_binary&quot;</span><span class="p">)</span>
<span class="n">ohe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_toy</span><span class="p">);</span>
<span class="n">X_toy_ohe</span> <span class="o">=</span> <span class="n">ohe</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_toy</span><span class="p">)</span>

<span class="n">X_toy_ohe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0],
       [1],
       [1],
       [0],
       [1],
       [0],
       [0],
       [0],
       [1],
       [0],
       [1],
       [1],
       [0],
       [1]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">X_toy_ohe</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">ohe</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">([</span><span class="s1">&#39;Caffeine&#39;</span><span class="p">]),</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X_toy</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Caffeine_Yes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we see that after one-hot encoding we only get a single column where the encoder has arbitrarily chosen one of the two categories based on the sorting.</p>
<p>In this case, alphabetically it was [<code class="docutils literal notranslate"><span class="pre">'No'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Yes'</span></code>] and it dropped the first category; <code class="docutils literal notranslate"><span class="pre">No</span></code>.</p>
</div>
<div class="section" id="do-we-actually-want-to-use-certain-features-for-prediction">
<h2><span class="section-number">5.8. </span>Do we actually want to use certain features for prediction?<a class="headerlink" href="#do-we-actually-want-to-use-certain-features-for-prediction" title="Permalink to this headline">¶</a></h2>
<p>Sometimes we may have column features like <code class="docutils literal notranslate"><span class="pre">race</span></code> or <code class="docutils literal notranslate"><span class="pre">sex</span></code> that may not be a good idea to include in your model.</p>
<p>The systems you build are going to be used in some applications.</p>
<p>It’s extremely important to be mindful of the consequences of including certain features in your predictive model.</p>
<p>Dropping the features like this to avoid racial and gender biases would be a strong suggestion.</p>
</div>
<div class="section" id="let-s-practice">
<h2><span class="section-number">5.9. </span>Let’s Practice<a class="headerlink" href="#let-s-practice" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>           <span class="n">name</span>    <span class="n">colour</span>    <span class="n">location</span>    <span class="n">seed</span>   <span class="n">shape</span>  <span class="n">sweetness</span>   <span class="n">water</span><span class="o">-</span><span class="n">content</span>  <span class="n">weight</span>  <span class="n">popularity</span>
<span class="mi">0</span>         <span class="n">apple</span>       <span class="n">red</span>     <span class="n">canada</span>    <span class="kc">True</span>   <span class="nb">round</span>     <span class="kc">True</span>          <span class="mi">84</span>         <span class="mi">100</span>      <span class="n">popular</span>
<span class="mi">1</span>        <span class="n">banana</span>    <span class="n">yellow</span>     <span class="n">mexico</span>   <span class="kc">False</span>    <span class="n">long</span>     <span class="kc">True</span>          <span class="mi">75</span>         <span class="mi">120</span>      <span class="n">popular</span>
<span class="mi">2</span>    <span class="n">cantaloupe</span>    <span class="n">orange</span>      <span class="n">spain</span>    <span class="kc">True</span>   <span class="nb">round</span>     <span class="kc">True</span>          <span class="mi">90</span>        <span class="mi">1360</span>      <span class="n">neutral</span>
<span class="mi">3</span>  <span class="n">dragon</span><span class="o">-</span><span class="n">fruit</span>   <span class="n">magenta</span>      <span class="n">china</span>    <span class="kc">True</span>   <span class="nb">round</span>    <span class="kc">False</span>          <span class="mi">96</span>         <span class="mi">600</span>      <span class="ow">not</span> <span class="n">popular</span>
<span class="mi">4</span>    <span class="n">elderberry</span>    <span class="n">purple</span>    <span class="n">austria</span>   <span class="kc">False</span>   <span class="nb">round</span>     <span class="kc">True</span>          <span class="mi">80</span>           <span class="mi">5</span>      <span class="ow">not</span> <span class="n">popular</span>
<span class="mi">5</span>           <span class="n">fig</span>    <span class="n">purple</span>     <span class="n">turkey</span>   <span class="kc">False</span>    <span class="n">oval</span>    <span class="kc">False</span>          <span class="mi">78</span>          <span class="mi">40</span>      <span class="n">neutral</span>
<span class="mi">6</span>         <span class="n">guava</span>     <span class="n">green</span>     <span class="n">mexico</span>    <span class="kc">True</span>    <span class="n">oval</span>     <span class="kc">True</span>          <span class="mi">83</span>         <span class="mi">450</span>      <span class="n">neutral</span>
<span class="mi">7</span>   <span class="n">huckleberry</span>      <span class="n">blue</span>     <span class="n">canada</span>    <span class="kc">True</span>   <span class="nb">round</span>     <span class="kc">True</span>          <span class="mi">73</span>           <span class="mi">5</span>      <span class="ow">not</span> <span class="n">popular</span>
<span class="mi">8</span>          <span class="n">kiwi</span>     <span class="n">brown</span>      <span class="n">china</span>    <span class="kc">True</span>   <span class="nb">round</span>     <span class="kc">True</span>          <span class="mi">80</span>          <span class="mi">76</span>      <span class="n">popular</span>
<span class="mi">9</span>         <span class="n">lemon</span>    <span class="n">yellow</span>     <span class="n">mexico</span>   <span class="kc">False</span>    <span class="n">oval</span>    <span class="kc">False</span>          <span class="mi">83</span>          <span class="mi">65</span>      <span class="n">popular</span>

</pre></div>
</div>
<p>1.  What would be the unique values given to the categories in the <code class="docutils literal notranslate"><span class="pre">popularity</span></code> column, if we transformed it with ordinal encoding?</p>
<p>a) <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4,</span> <span class="pre">5,</span> <span class="pre">6,</span> <span class="pre">7,</span> <span class="pre">8,</span> <span class="pre">9]</span></code><br />
b) <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">2]</span></code><br />
c) <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code><br />
d) <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code></p>
<p>2. Does it make sense to be doing ordinal transformations on the <code class="docutils literal notranslate"><span class="pre">colour</span></code> column?<br />
3. If we one hot encoded the <code class="docutils literal notranslate"><span class="pre">shape</span></code> column, what datatype would be the output after using <code class="docutils literal notranslate"><span class="pre">transform</span></code>?<br />
4. Which of the following outputs is the result of one-hot encoding the <code class="docutils literal notranslate"><span class="pre">shape</span></code> column?</p>
<p>a)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
<p>b)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
<p>c)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
<p>d)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">5</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">3</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">3</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">5</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">3</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">4</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">3</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

</pre></div>
</div>
<p>5. On which column(s) would you use <code class="docutils literal notranslate"><span class="pre">OneHotEncoder(sparse=False,</span> <span class="pre">dtype=int,</span> <span class="pre">drop=&quot;if_binary&quot;)</span></code>?</p>
<p><strong>True or False?</strong></p>
<p>6. Whenever we have categorical values, we should use ordinal encoding.<br />
7. If we include categorical values in our feature table, <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> will throw an error.<br />
8. One-hot encoding a column with 5 unique categories will produce 5 new transformed columns.<br />
9. The values in the new transformed columns after one-hot encoding, are all possible integer or float values.<br />
10. It’s important to be mindful of the consequences of including certain features in your predictive model.</p>
<div class="dropdown admonition">
<p class="admonition-title">Solutions!</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">2]</span></code></p></li>
<li><p>No</p></li>
<li><p>NumPy array</p></li>
<li><p>b)</p></li>
<li><p>seed, sweetness</p></li>
<li><p>False</p></li>
<li><p>True</p></li>
<li><p>True</p></li>
<li><p>False</p></li>
<li><p>True</p></li>
</ol>
</div>
<p><strong>But ….now what?</strong></p>
<p>How do we put this together with other columns in the data before fitting a regressor?</p>
<p>We want to apply different transformations to different columns.</p>
<p>Enter… <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code>.</p>
</div>
<div class="section" id="columntransformer">
<h2><span class="section-number">5.10. </span>ColumnTransformer<a class="headerlink" href="#columntransformer" title="Permalink to this headline">¶</a></h2>
<p>We left off wondering where to go after we transform our categorical features.</p>
<p>Problem: Different transformations on different columns.</p>
<p>Right now before we can even fit our regressor we have to apply different transformations on different columns:</p>
<ul class="simple">
<li><p>Numeric columns</p>
<ul>
<li><p>imputation</p></li>
<li><p>scaling</p></li>
</ul>
</li>
<li><p>Categorical columns</p>
<ul>
<li><p>imputation</p></li>
<li><p>one-hot encoding</p></li>
</ul>
</li>
</ul>
<p>What if we have features that are binary, features that are ordinal and features that need just standard one-hot encoding?</p>
<p>We can’t use a pipeline since not all the transformations are occurring on every feature.</p>
<p>We could do so without but then we would be violating the Golden Rule of Machine learning when we did cross-validation.</p>
<p>So we need a new tool and it’s called ColumnTransformer!</p>
<p>Sklearn’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html?highlight=columntransformer#sklearn.compose.ColumnTransformer"><code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code></a> makes this more manageable.</p>
<p>A big advantage here is that we build all our transformations together into one object, and that way we’re sure we do the same operations to all splits of the data.</p>
<p>Otherwise, we might, for example, do the OHE on both train and test but forget to scale the test data.</p>
<a class="reference internal image-reference" href="../_images/column-transformer.png"><img alt="../_images/column-transformer.png" src="../_images/column-transformer.png" style="width: 100%;" /></a>
<div class="section" id="applying-columntransformer">
<h3><span class="section-number">5.10.1. </span>Applying ColumnTransformer<a class="headerlink" href="#applying-columntransformer" title="Permalink to this headline">¶</a></h3>
<p>Let’s use this new tool on our California housing dataset.</p>
<p>Just like any new tool we use, we need to import it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
</pre></div>
</div>
</div>
</div>
<p>We must first identify the different feature types perhaps categorical and numeric columns in our feature table.</p>
<p>If we had binary values or ordinal features, we would split those up too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>households</th>
      <th>median_income</th>
      <th>ocean_proximity</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6051</th>
      <td>-117.75</td>
      <td>34.04</td>
      <td>22.0</td>
      <td>602.0</td>
      <td>3.1250</td>
      <td>INLAND</td>
      <td>4.897010</td>
      <td>1.056478</td>
      <td>4.318937</td>
    </tr>
    <tr>
      <th>20113</th>
      <td>-119.57</td>
      <td>37.94</td>
      <td>17.0</td>
      <td>20.0</td>
      <td>3.4861</td>
      <td>INLAND</td>
      <td>17.300000</td>
      <td>6.500000</td>
      <td>2.550000</td>
    </tr>
    <tr>
      <th>14289</th>
      <td>-117.13</td>
      <td>32.74</td>
      <td>46.0</td>
      <td>708.0</td>
      <td>2.6604</td>
      <td>NEAR OCEAN</td>
      <td>4.738701</td>
      <td>1.084746</td>
      <td>2.057910</td>
    </tr>
    <tr>
      <th>13665</th>
      <td>-117.31</td>
      <td>34.02</td>
      <td>18.0</td>
      <td>285.0</td>
      <td>5.2139</td>
      <td>INLAND</td>
      <td>5.733333</td>
      <td>0.961404</td>
      <td>3.154386</td>
    </tr>
    <tr>
      <th>14471</th>
      <td>-117.23</td>
      <td>32.88</td>
      <td>18.0</td>
      <td>1458.0</td>
      <td>1.8580</td>
      <td>NEAR OCEAN</td>
      <td>3.817558</td>
      <td>1.004801</td>
      <td>4.323045</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 18576 entries, 6051 to 19966
Data columns (total 9 columns):
 #   Column                    Non-Null Count  Dtype  
---  ------                    --------------  -----  
 0   longitude                 18576 non-null  float64
 1   latitude                  18576 non-null  float64
 2   housing_median_age        18576 non-null  float64
 3   households                18576 non-null  float64
 4   median_income             18576 non-null  float64
 5   ocean_proximity           18576 non-null  object 
 6   rooms_per_household       18576 non-null  float64
 7   bedrooms_per_household    18391 non-null  float64
 8   population_per_household  18576 non-null  float64
dtypes: float64(8), object(1)
memory usage: 1.4+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;housing_median_age&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;households&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;median_income&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;rooms_per_household&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;bedrooms_per_household&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;population_per_household&quot;</span><span class="p">]</span>
                     
<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we build a pipeline for our dataset.</p>
<p>This means we need to make at least 2 preprocessing pipelines; one for the categorical and one for the numeric features!</p>
<p>(If we needed to use the ordinal encoder for binary data or ordinal features then we would need a third or fourth.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)),</span> 
           <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())]</span>
<span class="p">)</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">)),</span>
           <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we can actually make our ColumnTransformer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col_transformer</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;numeric&quot;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;categorical&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">],</span> 
    <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span>    
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We call the numeric and categorical features with their respective pipelines (transformers)  in <code class="docutils literal notranslate"><span class="pre">ColumnTransformer()</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> syntax is somewhat similar to that of <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> in that you pass in a list of tuples.</p>
<p>But, this time, each tuple has 3 values instead of 2: (name of the step, transformer object, list of columns)</p>
<p>A big advantage here is that we build all our transformations together into one object, and that way we’re sure we do the same operations to all splits of the data.</p>
<p><strong>What does <code class="docutils literal notranslate"><span class="pre">remainder=&quot;passthrough&quot;</span></code> do?</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> will automatically remove columns that are not being transformed.</p>
<ul class="simple">
<li><p>AKA: the default value for <code class="docutils literal notranslate"><span class="pre">remainder</span></code> is <code class="docutils literal notranslate"><span class="pre">'drop'</span></code>.</p></li>
</ul>
<p>We can instead set  <code class="docutils literal notranslate"><span class="pre">remainder=&quot;passthrough&quot;</span></code> to keep the columns in our feature table which do not need any preprocessing.</p>
<p>We don’t have any columns that are being removed for this dataset, but this is important to know if we are only interested in a few features.</p>
<p>Now, you’ll start to foreshadow that just like we’ve seen with most syntax in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> we need to <code class="docutils literal notranslate"><span class="pre">fit</span></code> our ColumnTransformer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col_transformer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ColumnTransformer(remainder=&#39;passthrough&#39;,
                  transformers=[(&#39;numeric&#39;,
                                 Pipeline(steps=[(&#39;imputer&#39;,
                                                  SimpleImputer(strategy=&#39;median&#39;)),
                                                 (&#39;scaler&#39;, StandardScaler())]),
                                 [&#39;longitude&#39;, &#39;latitude&#39;, &#39;housing_median_age&#39;,
                                  &#39;households&#39;, &#39;median_income&#39;,
                                  &#39;rooms_per_household&#39;,
                                  &#39;bedrooms_per_household&#39;,
                                  &#39;population_per_household&#39;]),
                                (&#39;categorical&#39;,
                                 Pipeline(steps=[(&#39;imputer&#39;,
                                                  SimpleImputer(fill_value=&#39;missing&#39;,
                                                                strategy=&#39;constant&#39;)),
                                                 (&#39;onehot&#39;,
                                                  OneHotEncoder(handle_unknown=&#39;ignore&#39;))]),
                                 [&#39;ocean_proximity&#39;])])
</pre></div>
</div>
</div>
</div>
<p>When we <code class="docutils literal notranslate"><span class="pre">fit</span></code> with the <code class="docutils literal notranslate"><span class="pre">col_transformer</span></code>, it calls <code class="docutils literal notranslate"><span class="pre">fit</span></code> on <em><strong>all</strong></em> the transformers.</p>
<p>And when we transform with the preprocessor, it calls <code class="docutils literal notranslate"><span class="pre">transform</span></code> on <em><strong>all</strong></em> the transformers.</p>
<p>How do we access information from this now?
Let’s say I wanted to see the newly created columns from One-hot-encoding? How do I get those?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">onehot_cols</span> <span class="o">=</span> <span class="n">col_transformer</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;categorical&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;onehot&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">)</span>
<span class="n">onehot_cols</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;ocean_proximity_&lt;1H OCEAN&#39;, &#39;ocean_proximity_INLAND&#39;,
       &#39;ocean_proximity_ISLAND&#39;, &#39;ocean_proximity_NEAR BAY&#39;,
       &#39;ocean_proximity_NEAR OCEAN&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Combining this with the numeric feature names gives us all the column names.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="n">numeric_features</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">onehot_cols</span><span class="p">)</span>
<span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;longitude&#39;,
 &#39;latitude&#39;,
 &#39;housing_median_age&#39;,
 &#39;households&#39;,
 &#39;median_income&#39;,
 &#39;rooms_per_household&#39;,
 &#39;bedrooms_per_household&#39;,
 &#39;population_per_household&#39;,
 &#39;ocean_proximity_&lt;1H OCEAN&#39;,
 &#39;ocean_proximity_INLAND&#39;,
 &#39;ocean_proximity_ISLAND&#39;,
 &#39;ocean_proximity_NEAR BAY&#39;,
 &#39;ocean_proximity_NEAR OCEAN&#39;]
</pre></div>
</div>
</div>
</div>
<p>Or we can look at what our X_train looks like after transformation.</p>
<p><em>(Ignore this code, you’ll not have to use it in the future, this is just for learning)</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="k">del</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">X_train_pp</span> <span class="o">=</span> <span class="n">col_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_train_pp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span> <span class="p">(</span><span class="n">x</span>  <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">col_transformer</span><span class="o">.</span><span class="n">named_transformers_</span><span class="p">[</span><span class="s2">&quot;categorical&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s2">&quot;onehot&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">(</span><span class="n">categorical_features</span><span class="p">))))</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>households</th>
      <th>median_income</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_household</th>
      <th>population_per_household</th>
      <th>ocean_proximity_&lt;1H OCEAN</th>
      <th>ocean_proximity_INLAND</th>
      <th>ocean_proximity_ISLAND</th>
      <th>ocean_proximity_NEAR BAY</th>
      <th>ocean_proximity_NEAR OCEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.908140</td>
      <td>-0.743917</td>
      <td>-0.526078</td>
      <td>0.266135</td>
      <td>-0.389736</td>
      <td>-0.210591</td>
      <td>-0.083813</td>
      <td>0.126398</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.002057</td>
      <td>1.083123</td>
      <td>-0.923283</td>
      <td>-1.253312</td>
      <td>-0.198924</td>
      <td>4.726412</td>
      <td>11.166631</td>
      <td>-0.050132</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.218207</td>
      <td>-1.352930</td>
      <td>1.380504</td>
      <td>0.542873</td>
      <td>-0.635239</td>
      <td>-0.273606</td>
      <td>-0.025391</td>
      <td>-0.099240</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.128188</td>
      <td>-0.753286</td>
      <td>-0.843842</td>
      <td>-0.561467</td>
      <td>0.714077</td>
      <td>0.122307</td>
      <td>-0.280310</td>
      <td>0.010183</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.168196</td>
      <td>-1.287344</td>
      <td>-0.843842</td>
      <td>2.500924</td>
      <td>-1.059242</td>
      <td>-0.640266</td>
      <td>-0.190617</td>
      <td>0.126808</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now let’s make a pipeline with our column transformer and a <span class="math notranslate nohighlight">\(k\)</span>-nn regressor.</p>
<p>The first step in this pipeline is our <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and the second is our  <span class="math notranslate nohighlight">\(k\)</span>-nn regressor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">main_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">col_transformer</span><span class="p">),</span> <span class="c1"># &lt;-- this is the ColumnTransformer!</span>
        <span class="p">(</span><span class="s2">&quot;reg&quot;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">())])</span>
</pre></div>
</div>
</div>
</div>
<p>We can then use <code class="docutils literal notranslate"><span class="pre">cross_validate()</span></code> and find our mean training and validation scores!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">with_categorical_scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">main_pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">categorical_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">with_categorical_scores</span><span class="p">)</span>
<span class="n">categorical_score</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.057024</td>
      <td>0.410002</td>
      <td>0.695818</td>
      <td>0.801659</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.039643</td>
      <td>0.321133</td>
      <td>0.707483</td>
      <td>0.799575</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.043101</td>
      <td>0.346134</td>
      <td>0.713788</td>
      <td>0.795944</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.041929</td>
      <td>0.356720</td>
      <td>0.686938</td>
      <td>0.801232</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.038765</td>
      <td>0.286461</td>
      <td>0.724608</td>
      <td>0.832498</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categorical_score</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit_time       0.044092
score_time     0.344090
test_score     0.705727
train_score    0.806182
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>In lecture 4, when we did not include this column, we obtain training and test scores of test_score  0.692972 and   0.797033 respectively so we can see a small increase.</p>
<p>if we had more columns, we could improve our scores in a much more substantial way instead of throwing the information away which is what we have been doing!</p>
<p>There are a lot of steps happening in <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code>, we can use <code class="docutils literal notranslate"><span class="pre">set_config</span></code> from sklearn and it will display a diagram of what is going on in our main pipeline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s1">&#39;diagram&#39;</span><span class="p">)</span>
<span class="n">main_pipe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0b8e591f-8bbd-42b5-851b-dcc19d93c3c6" type="checkbox" ><label class="sk-toggleable__label" for="0b8e591f-8bbd-42b5-851b-dcc19d93c3c6">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(remainder='passthrough',
                                   transformers=[('numeric',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  ['longitude', 'latitude',
                                                   'housing_median_age',
                                                   'households',
                                                   'median_income',
                                                   'rooms_per_household',
                                                   'bedrooms_per_household',
                                                   'population_per_household']),
                                                 ('categorical',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  ['ocean_proximity'])])),
                ('reg', KNeighborsRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4f5099d7-586b-4809-b8b2-dbd2c0e7edff" type="checkbox" ><label class="sk-toggleable__label" for="4f5099d7-586b-4809-b8b2-dbd2c0e7edff">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(remainder='passthrough',
                  transformers=[('numeric',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 ['longitude', 'latitude', 'housing_median_age',
                                  'households', 'median_income',
                                  'rooms_per_household',
                                  'bedrooms_per_household',
                                  'population_per_household']),
                                ('categorical',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 ['ocean_proximity'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5d97e63e-89fe-4a26-8f77-64cc5ca05b1b" type="checkbox" ><label class="sk-toggleable__label" for="5d97e63e-89fe-4a26-8f77-64cc5ca05b1b">numeric</label><div class="sk-toggleable__content"><pre>['longitude', 'latitude', 'housing_median_age', 'households', 'median_income', 'rooms_per_household', 'bedrooms_per_household', 'population_per_household']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="db29e8d1-7d14-4713-a43c-8cc45c80cddc" type="checkbox" ><label class="sk-toggleable__label" for="db29e8d1-7d14-4713-a43c-8cc45c80cddc">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="becd2761-ef15-4957-a28a-641543c762b5" type="checkbox" ><label class="sk-toggleable__label" for="becd2761-ef15-4957-a28a-641543c762b5">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="83185967-323a-41a6-acbf-6031aa78bc4b" type="checkbox" ><label class="sk-toggleable__label" for="83185967-323a-41a6-acbf-6031aa78bc4b">categorical</label><div class="sk-toggleable__content"><pre>['ocean_proximity']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6ae8d01b-f33b-45ab-ba56-f00528faa39f" type="checkbox" ><label class="sk-toggleable__label" for="6ae8d01b-f33b-45ab-ba56-f00528faa39f">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c07de4df-ead3-4b78-b387-0d9419c79289" type="checkbox" ><label class="sk-toggleable__label" for="c07de4df-ead3-4b78-b387-0d9419c79289">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="54e2bff1-fc36-420a-adbb-3c8d8b05ad1b" type="checkbox" ><label class="sk-toggleable__label" for="54e2bff1-fc36-420a-adbb-3c8d8b05ad1b">KNeighborsRegressor</label><div class="sk-toggleable__content"><pre>KNeighborsRegressor()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">main_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pipeline(steps=[(&#39;preprocessor&#39;,
                 ColumnTransformer(remainder=&#39;passthrough&#39;,
                                   transformers=[(&#39;numeric&#39;,
                                                  Pipeline(steps=[(&#39;imputer&#39;,
                                                                   SimpleImputer(strategy=&#39;median&#39;)),
                                                                  (&#39;scaler&#39;,
                                                                   StandardScaler())]),
                                                  [&#39;longitude&#39;, &#39;latitude&#39;,
                                                   &#39;housing_median_age&#39;,
                                                   &#39;households&#39;,
                                                   &#39;median_income&#39;,
                                                   &#39;rooms_per_household&#39;,
                                                   &#39;bedrooms_per_household&#39;,
                                                   &#39;population_per_household&#39;]),
                                                 (&#39;categorical&#39;,
                                                  Pipeline(steps=[(&#39;imputer&#39;,
                                                                   SimpleImputer(fill_value=&#39;missing&#39;,
                                                                                 strategy=&#39;constant&#39;)),
                                                                  (&#39;onehot&#39;,
                                                                   OneHotEncoder(handle_unknown=&#39;ignore&#39;))]),
                                                  [&#39;ocean_proximity&#39;])])),
                (&#39;reg&#39;, KNeighborsRegressor())])
</pre></div>
</div>
</div>
</div>
<p>We can also look at this image which shows the more generic version of what happens in <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> and where it stands in our main pipeline.</p>
<a class="reference internal image-reference" href="../_images/pipeline.png"><img alt="404 image" src="../_images/pipeline.png" style="width: 90%;" /></a>
<div class="section" id="do-we-need-to-preprocess-categorical-values-in-the-target-column">
<h4><span class="section-number">5.10.1.1. </span>Do we need to preprocess categorical values in the target column?<a class="headerlink" href="#do-we-need-to-preprocess-categorical-values-in-the-target-column" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Generally, there is no need for this when doing classification.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sklearn</span></code> is fine with categorical labels (y-values) for classification problems.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="make-syntax">
<h2><span class="section-number">5.11. </span>Make Syntax<a class="headerlink" href="#make-syntax" title="Permalink to this headline">¶</a></h2>
<p>When we looked at our California housing dataset we had the following pipelines, ColumnTransformer and main pipeline with our model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)),</span> 
           <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())]</span>
<span class="p">)</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">)),</span>
           <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))]</span>
<span class="p">)</span>

<span class="n">col_transformer</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;numeric&quot;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;categorical&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">],</span> 
    <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;passthrough&#39;</span>    
<span class="p">)</span>

<span class="n">main_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">col_transformer</span><span class="p">),</span> 
        <span class="p">(</span><span class="s2">&quot;reg&quot;</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span><span class="p">())])</span>
</pre></div>
</div>
</div>
</div>
<p>This seems great but it seems quite a lot.</p>
<p>Well, luckily there is another method and tool that helps make our life easier.</p>
<p>It’s call <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code> and <code class="docutils literal notranslate"><span class="pre">make_column_transformer</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="make-pipeline">
<h3><span class="section-number">5.11.1. </span><code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code><a class="headerlink" href="#make-pipeline" title="Permalink to this headline">¶</a></h3>
<p>We can shorten our code when we use <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> from this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
        <span class="p">(</span><span class="s2">&quot;reg&quot;</span><span class="p">,</span> <span class="n">SVR</span><span class="p">())])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_pipeline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c91f50c7-a006-45ff-9906-5277837700a6" type="checkbox" ><label class="sk-toggleable__label" for="c91f50c7-a006-45ff-9906-5277837700a6">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('scaling', StandardScaler()), ('reg', SVR())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a4f22320-6c35-48d0-8c2d-bb73db841051" type="checkbox" ><label class="sk-toggleable__label" for="a4f22320-6c35-48d0-8c2d-bb73db841051">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f4b7f329-6937-46dc-be2a-0d38ad1bd40c" type="checkbox" ><label class="sk-toggleable__label" for="f4b7f329-6937-46dc-be2a-0d38ad1bd40c">SVR</label><div class="sk-toggleable__content"><pre>SVR()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">model_pipeline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pipeline(steps=[(&#39;scaling&#39;, StandardScaler()), (&#39;reg&#39;, SVR())])
</pre></div>
</div>
</div>
</div>
<p>to this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_pipeline</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
            <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">SVR</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_pipeline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="33c8976d-4c27-472c-b9a1-45ed0db3f621" type="checkbox" ><label class="sk-toggleable__label" for="33c8976d-4c27-472c-b9a1-45ed0db3f621">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('standardscaler', StandardScaler()), ('svr', SVR())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9716f61d-8a3d-4f5a-b5db-11fa9fe72f74" type="checkbox" ><label class="sk-toggleable__label" for="9716f61d-8a3d-4f5a-b5db-11fa9fe72f74">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fc342fda-93d3-43c2-8cc4-0cdc389e99f1" type="checkbox" ><label class="sk-toggleable__label" for="fc342fda-93d3-43c2-8cc4-0cdc389e99f1">SVR</label><div class="sk-toggleable__content"><pre>SVR()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">model_pipeline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()), (&#39;svr&#39;, SVR())])
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">make_pipeline()</span></code> is a shorthand for the <code class="docutils literal notranslate"><span class="pre">Pipeline()</span></code> constructor and does not permit, naming the steps.</p>
<p>Instead, their names will be set to the lowercase of their types automatically.</p>
<p>Now let’s adjust our code for our numeric and categoric pipelines for this data using <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code> instead of <code class="docutils literal notranslate"><span class="pre">Pipeline()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span>
                                    <span class="n">StandardScaler</span><span class="p">())</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
    <span class="n">OneHotEncoder</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">SVR</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Look how much less effort our pipeline took!</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code> may still have the same syntax but guess what?! We have a solution for that too!</p>
</div>
</div>
<div class="section" id="make-column-transformer-syntax">
<h2><span class="section-number">5.12. </span><em>make_column_transformer</em> syntax<a class="headerlink" href="#make-column-transformer-syntax" title="Permalink to this headline">¶</a></h2>
<p>Just like <code class="docutils literal notranslate"><span class="pre">make_pipeline()</span></code>,  we can make our column transformer with <code class="docutils literal notranslate"><span class="pre">make_column_transformer()</span></code>.</p>
<p>This eliminates the need to designate names for the numeric and categorical transformations.</p>
<p>Our code goes from this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span> <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="49b7fdf5-c75b-42c8-bccc-16baff1e6a20" type="checkbox" ><label class="sk-toggleable__label" for="49b7fdf5-c75b-42c8-bccc-16baff1e6a20">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 ['longitude', 'latitude', 'housing_median_age',
                                  'households', 'median_income',
                                  'rooms_per_household',
                                  'bedrooms_per_household',
                                  'population_per_household']),
                                ('cat',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['ocean_proximity'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4e6d14be-b3f0-44b1-a4f6-bc18f05f1307" type="checkbox" ><label class="sk-toggleable__label" for="4e6d14be-b3f0-44b1-a4f6-bc18f05f1307">num</label><div class="sk-toggleable__content"><pre>['longitude', 'latitude', 'housing_median_age', 'households', 'median_income', 'rooms_per_household', 'bedrooms_per_household', 'population_per_household']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4dc440f3-690c-42d9-af67-fb0e88d8e0bc" type="checkbox" ><label class="sk-toggleable__label" for="4dc440f3-690c-42d9-af67-fb0e88d8e0bc">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="664484b7-dd34-43ac-b501-9eb5c2bd3f6b" type="checkbox" ><label class="sk-toggleable__label" for="664484b7-dd34-43ac-b501-9eb5c2bd3f6b">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="01fb71d2-4f33-497d-b986-2596fe49c7a0" type="checkbox" ><label class="sk-toggleable__label" for="01fb71d2-4f33-497d-b986-2596fe49c7a0">cat</label><div class="sk-toggleable__content"><pre>['ocean_proximity']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e2fa4cae-19dd-4530-becd-95d50ccebc65" type="checkbox" ><label class="sk-toggleable__label" for="e2fa4cae-19dd-4530-becd-95d50ccebc65">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="04d70766-a4f5-4809-9cb7-99682a266583" type="checkbox" ><label class="sk-toggleable__label" for="04d70766-a4f5-4809-9cb7-99682a266583">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ColumnTransformer(transformers=[(&#39;num&#39;,
                                 Pipeline(steps=[(&#39;simpleimputer&#39;,
                                                  SimpleImputer(strategy=&#39;median&#39;)),
                                                 (&#39;standardscaler&#39;,
                                                  StandardScaler())]),
                                 [&#39;longitude&#39;, &#39;latitude&#39;, &#39;housing_median_age&#39;,
                                  &#39;households&#39;, &#39;median_income&#39;,
                                  &#39;rooms_per_household&#39;,
                                  &#39;bedrooms_per_household&#39;,
                                  &#39;population_per_household&#39;]),
                                (&#39;cat&#39;,
                                 Pipeline(steps=[(&#39;simpleimputer&#39;,
                                                  SimpleImputer(fill_value=&#39;missing&#39;,
                                                                strategy=&#39;constant&#39;)),
                                                 (&#39;onehotencoder&#39;,
                                                  OneHotEncoder())]),
                                 [&#39;ocean_proximity&#39;])])
</pre></div>
</div>
</div>
</div>
<p>to this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>div.sk-top-container {color: black;background-color: white;}div.sk-toggleable {background-color: white;}label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.2em 0.3em;box-sizing: border-box;text-align: center;}div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}div.sk-estimator {font-family: monospace;background-color: #f0f8ff;margin: 0.25em 0.25em;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;}div.sk-estimator:hover {background-color: #d4ebff;}div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;}div.sk-item {z-index: 1;}div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}div.sk-parallel-item:only-child::after {width: 0;}div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0.2em;box-sizing: border-box;padding-bottom: 0.1em;background-color: white;position: relative;}div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}div.sk-label-container {position: relative;z-index: 2;text-align: center;}div.sk-container {display: inline-block;position: relative;}</style><div class="sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="136a73f3-a779-434a-b515-3c653d7c8c47" type="checkbox" ><label class="sk-toggleable__label" for="136a73f3-a779-434a-b515-3c653d7c8c47">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('pipeline-1',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('standardscaler',
                                                  StandardScaler())]),
                                 ['longitude', 'latitude', 'housing_median_age',
                                  'households', 'median_income',
                                  'rooms_per_household',
                                  'bedrooms_per_household',
                                  'population_per_household']),
                                ('pipeline-2',
                                 Pipeline(steps=[('simpleimputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehotencoder',
                                                  OneHotEncoder())]),
                                 ['ocean_proximity'])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="55811df2-d3d2-451c-ba09-351aca53dbc9" type="checkbox" ><label class="sk-toggleable__label" for="55811df2-d3d2-451c-ba09-351aca53dbc9">pipeline-1</label><div class="sk-toggleable__content"><pre>['longitude', 'latitude', 'housing_median_age', 'households', 'median_income', 'rooms_per_household', 'bedrooms_per_household', 'population_per_household']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ad0a7b48-57c3-40d9-8570-0fd67f6fa937" type="checkbox" ><label class="sk-toggleable__label" for="ad0a7b48-57c3-40d9-8570-0fd67f6fa937">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3d757972-0386-47f4-9712-2e5b64183b01" type="checkbox" ><label class="sk-toggleable__label" for="3d757972-0386-47f4-9712-2e5b64183b01">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="058ef6e3-369b-4bd1-ba4d-7bd59267f777" type="checkbox" ><label class="sk-toggleable__label" for="058ef6e3-369b-4bd1-ba4d-7bd59267f777">pipeline-2</label><div class="sk-toggleable__content"><pre>['ocean_proximity']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="22b09333-5ec5-4d55-8160-4a2f6f68ee82" type="checkbox" ><label class="sk-toggleable__label" for="22b09333-5ec5-4d55-8160-4a2f6f68ee82">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8be41a07-d618-4086-b9ee-a27fd330e6fb" type="checkbox" ><label class="sk-toggleable__label" for="8be41a07-d618-4086-b9ee-a27fd330e6fb">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ColumnTransformer(transformers=[(&#39;pipeline-1&#39;,
                                 Pipeline(steps=[(&#39;simpleimputer&#39;,
                                                  SimpleImputer(strategy=&#39;median&#39;)),
                                                 (&#39;standardscaler&#39;,
                                                  StandardScaler())]),
                                 [&#39;longitude&#39;, &#39;latitude&#39;, &#39;housing_median_age&#39;,
                                  &#39;households&#39;, &#39;median_income&#39;,
                                  &#39;rooms_per_household&#39;,
                                  &#39;bedrooms_per_household&#39;,
                                  &#39;population_per_household&#39;]),
                                (&#39;pipeline-2&#39;,
                                 Pipeline(steps=[(&#39;simpleimputer&#39;,
                                                  SimpleImputer(fill_value=&#39;missing&#39;,
                                                                strategy=&#39;constant&#39;)),
                                                 (&#39;onehotencoder&#39;,
                                                  OneHotEncoder())]),
                                 [&#39;ocean_proximity&#39;])])
</pre></div>
</div>
</div>
</div>
<p>This eliminates the need to designate names for the numeric and categorical transformations.</p>
<p>So our whole thing becomes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span>
                                    <span class="n">StandardScaler</span><span class="p">())</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
                <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;missing&quot;</span><span class="p">),</span>
                <span class="n">OneHotEncoder</span><span class="p">())</span>
                
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
               <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span> 
               <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">))</span>
               
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">SVR</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9.149653</td>
      <td>1.284505</td>
      <td>-0.029288</td>
      <td>-0.048769</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.712222</td>
      <td>1.326230</td>
      <td>-0.060164</td>
      <td>-0.046902</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8.995087</td>
      <td>1.212516</td>
      <td>-0.057491</td>
      <td>-0.048523</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8.452476</td>
      <td>1.250952</td>
      <td>-0.046167</td>
      <td>-0.047366</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8.512399</td>
      <td>1.317137</td>
      <td>-0.050141</td>
      <td>-0.049123</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="id1">
<h2><span class="section-number">5.13. </span>Let’s Practice<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Refer to the dataframe to answer the following question.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="n">colour</span>   <span class="n">location</span>    <span class="n">shape</span>   <span class="n">water_content</span>  <span class="n">weight</span>
<span class="mi">0</span>       <span class="n">red</span>      <span class="n">canada</span>      <span class="n">NaN</span>         <span class="mi">84</span>          <span class="mi">100</span>
<span class="mi">1</span>     <span class="n">yellow</span>     <span class="n">mexico</span>     <span class="n">long</span>         <span class="mi">75</span>          <span class="mi">120</span>
<span class="mi">2</span>     <span class="n">orange</span>     <span class="n">spain</span>       <span class="n">NaN</span>         <span class="mi">90</span>          <span class="n">NaN</span>
<span class="mi">3</span>    <span class="n">magenta</span>     <span class="n">china</span>      <span class="nb">round</span>        <span class="n">NaN</span>         <span class="mi">600</span>
<span class="mi">4</span>     <span class="n">purple</span>    <span class="n">austria</span>      <span class="n">NaN</span>         <span class="mi">80</span>          <span class="mi">115</span>
<span class="mi">5</span>     <span class="n">purple</span>    <span class="n">turkey</span>      <span class="n">oval</span>         <span class="mi">78</span>          <span class="mi">340</span>
<span class="mi">6</span>     <span class="n">green</span>     <span class="n">mexico</span>      <span class="n">oval</span>         <span class="mi">83</span>          <span class="n">NaN</span>
<span class="mi">7</span>      <span class="n">blue</span>     <span class="n">canada</span>      <span class="nb">round</span>        <span class="mi">73</span>          <span class="mi">535</span>
<span class="mi">8</span>     <span class="n">brown</span>     <span class="n">china</span>        <span class="n">NaN</span>         <span class="n">NaN</span>        <span class="mi">1743</span>  
<span class="mi">9</span>     <span class="n">yellow</span>    <span class="n">mexico</span>      <span class="n">oval</span>         <span class="mi">83</span>          <span class="mi">265</span>
</pre></div>
</div>
<br>
<p>1. How many categorical columns are there and how many numeric?<br />
2. What transformations are being done to both numeric and categorical columns?</p>
<p>Use the diagram below to answer the following questions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;columntransformer&#39;</span><span class="p">,</span>
               <span class="n">ColumnTransformer</span><span class="p">(</span>
                  <span class="n">transformers</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;pipeline-1&#39;</span><span class="p">,</span>
                                  <span class="n">Pipeline</span><span class="p">(</span>
                                    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;simpleimputer&#39;</span><span class="p">,</span>
                                             <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)),</span>
                                           <span class="p">(</span><span class="s1">&#39;standardscaler&#39;</span><span class="p">,</span>
                                             <span class="n">StandardScaler</span><span class="p">())]),</span>
                      <span class="p">[</span><span class="s1">&#39;water_content&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;carbs&#39;</span><span class="p">]),</span>
                                <span class="p">(</span><span class="s1">&#39;pipeline-2&#39;</span><span class="p">,</span>
                                  <span class="n">Pipeline</span><span class="p">(</span>
                                    <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;simpleimputer&#39;</span><span class="p">,</span>
                                             <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;missing&#39;</span><span class="p">,</span>
                                                                <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)),</span>
                                           <span class="p">(</span><span class="s1">&#39;onehotencoder&#39;</span><span class="p">,</span>
                                             <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))]),</span>
                      <span class="p">[</span><span class="s1">&#39;colour&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="s1">&#39;sweetness&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;tropical&#39;</span><span class="p">])])),</span>
         <span class="p">(</span><span class="s1">&#39;decisiontreeclassifier&#39;</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">())])</span>
</pre></div>
</div>
<p>3. How many columns are being transformed in <code class="docutils literal notranslate"><span class="pre">pipeline-1</span></code>?<br />
4. Which pipeline is transforming the categorical columns?<br />
5. What model is the pipeline fitting on?</p>
<p><strong>True or False</strong></p>
<p>6. If there are missing values in both numeric and categorical columns, we can specify this in a single step in the main pipeline.<br />
7. If we do not specify <code class="docutils literal notranslate"><span class="pre">remainder=&quot;passthrough&quot;</span></code> as an argument in <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code>, the columns not being transformed will be dropped.<br />
8. <code class="docutils literal notranslate"><span class="pre">Pipeline()</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">make_pipeline()</span></code> but  <code class="docutils literal notranslate"><span class="pre">make_pipeline()</span></code> requires you to name the steps.</p>
<div class="dropdown admonition">
<p class="admonition-title">Solutions!</p>
<ol class="simple">
<li><p>3 categoric columns and 2 numeric columns</p></li>
<li><p>Imputation</p></li>
<li><p>3</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipeline-2</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DecisionTreeClassifier</span></code></p></li>
<li><p>False</p></li>
<li><p>True</p></li>
<li><p>False</p></li>
</ol>
</div>
</div>
<div class="section" id="text-data">
<h2><span class="section-number">5.14. </span>Text Data<a class="headerlink" href="#text-data" title="Permalink to this headline">¶</a></h2>
<p>Machine Learning algorithms that we have seen so far prefer numeric and fixed-length input that looks like this.</p>
<div class="math notranslate nohighlight">
\[\begin{split}X = \begin{bmatrix}1.0 &amp; 4.0 &amp; \ldots &amp; &amp; 3.0\\ 0.0 &amp; 2.0 &amp; \ldots &amp; &amp; 6.0\\ 1.0 &amp; 0.0 &amp; \ldots &amp; &amp; 0.0\\ \end{bmatrix}\end{split}\]</div>
<p>and
$<span class="math notranslate nohighlight">\(y = \begin{bmatrix}spam \\ non spam \\ spam \end{bmatrix}\)</span>$</p>
<p>But what if we are only given data in the form of raw text and associated labels?</p>
<p>How can we represent such data into a fixed number of features?</p>
<p>Spam/non-spam toy example</p>
<p>Would you be able to apply the algorithms we have seen so far on the data that looks like this?</p>
<div class="math notranslate nohighlight">
\[\begin{split}X = \begin{bmatrix}\text{&quot;URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!&quot;,}\\ \text{&quot;Lol your always so convincing.&quot;}\\ \text{&quot;Congrats! 1 year special cinema pass for 2 is yours. call 09061209465 now!&quot;}\\ \end{bmatrix}\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}y = \begin{bmatrix}spam \\ non spam \\ spam \end{bmatrix}\end{split}\]</div>
<br>
<ul class="simple">
<li><p>In categorical features or ordinal features, we have a fixed number of categories.</p></li>
<li><p>In text features such as above, each feature value (i.e., each text message) is going to be different.</p></li>
<li><p>How do we encode these features?</p></li>
</ul>
</div>
<div class="section" id="bag-of-words-bow-representation">
<h2><span class="section-number">5.15. </span>Bag of words (BOW) representation<a class="headerlink" href="#bag-of-words-bow-representation" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="../_images/bow.png"><img alt="404 image" src="../_images/bow.png" style="width: 85%;" /></a>
<p><a href="https://web.stanford.edu/~jurafsky/slp3/4.pdf" target="_blank">Attribution: Daniel Jurafsky &amp; James H. Martin</a></p>
<p>One way is to use a simple bag of words (BOW) representation which involves two components.</p>
<ul class="simple">
<li><p>The vocabulary (all unique words in all documents)</p></li>
<li><p>A value indicating either the presence or absence or the count of each word in the document.</p></li>
</ul>
<div class="section" id="extracting-bow-features-using-scikit-learn">
<h3><span class="section-number">5.15.1. </span>Extracting BOW features using <em>scikit-learn</em><a class="headerlink" href="#extracting-bow-features-using-scikit-learn" title="Permalink to this headline">¶</a></h3>
<p>Let’s say we have 1 feature in our <code class="docutils literal notranslate"><span class="pre">X</span></code> dataframe consisting of the following text messages.</p>
<p>In our target column, we have the classification of each message as either <code class="docutils literal notranslate"><span class="pre">spam</span></code> or <code class="docutils literal notranslate"><span class="pre">non</span> <span class="pre">spam</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Lol you are always so convincing.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Nah I don&#39;t think he goes to usf, he lives around here though&quot;</span><span class="p">,</span>
    <span class="s2">&quot;URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030&quot;</span><span class="p">,</span>
    <span class="s2">&quot;As per your request &#39;Melle Melle (Oru Minnaminunginte Nurungu Vettam)&#39; has been set as your callertune for all Callers. Press *9 to copy your friends Callertune&quot;</span><span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;non spam&quot;</span><span class="p">,</span> <span class="s2">&quot;non spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;non spam&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We import a tool called <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
</pre></div>
</div>
</div>
</div>
<p>We use <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> to convert text data into feature vectors where:</p>
<ul class="simple">
<li><p>Each row represents a “document” (e.g., a text message in our example).</p></li>
<li><p>Each feature is a unique word in the text</p></li>
<li><p>Each feature value represents the frequency or presence/absence of the word in the given message</p></li>
</ul>
<p>In the NLP community, a text data set is referred to as a <strong>corpus</strong> (plural: corpora).</p>
<p>The features should be a 1 dimension array as an input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">()</span>
<span class="n">X_counts</span> <span class="o">=</span> <span class="n">vec</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
<span class="n">bow_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_counts</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">vec</span><span class="o">.</span><span class="n">vocabulary_</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
<span class="n">bow_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>08002986030</th>
      <th>100000</th>
      <th>11</th>
      <th>900</th>
      <th>all</th>
      <th>always</th>
      <th>are</th>
      <th>around</th>
      <th>as</th>
      <th>been</th>
      <th>...</th>
      <th>update</th>
      <th>urgent</th>
      <th>usf</th>
      <th>valued</th>
      <th>vettam</th>
      <th>week</th>
      <th>with</th>
      <th>won</th>
      <th>you</th>
      <th>your</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Lol you are always so convincing.</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Nah I don't think he goes to usf, he lives around here though</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>As per your request 'Melle Melle (Oru Minnaminunginte Nurungu Vettam)' has been set as your callertune for all Callers. Press *9 to copy your friends Callertune</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 72 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="important-hyperparameters-of-countvectorizer">
<h3><span class="section-number">5.15.2. </span>Important hyperparameters of <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code><a class="headerlink" href="#important-hyperparameters-of-countvectorizer" title="Permalink to this headline">¶</a></h3>
<p>There are many useful and important hyperparameters of <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">binary</span></code>:</p>
<ul>
<li><p>Whether to use absence/presence feature values or counts.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_features</span></code>:</p>
<ul>
<li><p>Only considers top <code class="docutils literal notranslate"><span class="pre">max_features</span></code> ordered by frequency in the corpus.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_df</span></code>:</p>
<ul>
<li><p>When building the vocabulary ignore terms that have a document frequency strictly higher than the given threshold.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_df</span></code>:</p>
<ul>
<li><p>When building the vocabulary ignore terms that have a document frequency strictly lower than the given threshold.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ngram_range</span></code>:</p>
<ul>
<li><p>Consider word sequences in the given range.</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!&#39;,
 &#39;Lol you are always so convincing.&#39;,
 &quot;Nah I don&#39;t think he goes to usf, he lives around here though&quot;,
 &#39;URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!&#39;,
 &#39;Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030&#39;,
 &quot;As per your request &#39;Melle Melle (Oru Minnaminunginte Nurungu Vettam)&#39; has been set as your callertune for all Callers. Press *9 to copy your friends Callertune&quot;]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> is carrying out some preprocessing because of the default argument values.</p>
<ul class="simple">
<li><p>Converting words to lowercase (<code class="docutils literal notranslate"><span class="pre">lowercase=True</span></code>). Take a look at the word “urgent” In both cases.</p></li>
<li><p>getting rid of punctuation and special characters (<code class="docutils literal notranslate"><span class="pre">token_pattern</span> <span class="pre">='(?u)\\b\\w\\w+\\b'</span></code>)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;08002986030&#39;,
 &#39;100000&#39;,
 &#39;11&#39;,
 &#39;900&#39;,
 &#39;all&#39;,
 &#39;always&#39;,
 &#39;are&#39;,
 &#39;around&#39;,
 &#39;as&#39;,
 &#39;been&#39;,
 &#39;call&#39;,
 &#39;callers&#39;,
 &#39;callertune&#39;,
 &#39;camera&#39;,
 &#39;co&#39;,
 &#39;colour&#39;,
 &#39;convincing&#39;,
 &#39;copy&#39;,
 &#39;customer&#39;,
 &#39;don&#39;,
 &#39;entitled&#39;,
 &#39;for&#39;,
 &#39;free&#39;,
 &#39;friends&#39;,
 &#39;goes&#39;,
 &#39;had&#39;,
 &#39;has&#39;,
 &#39;have&#39;,
 &#39;he&#39;,
 &#39;here&#39;,
 &#39;in&#39;,
 &#39;jackpot&#39;,
 &#39;latest&#39;,
 &#39;lives&#39;,
 &#39;lol&#39;,
 &#39;melle&#39;,
 &#39;membership&#39;,
 &#39;minnaminunginte&#39;,
 &#39;mobile&#39;,
 &#39;mobiles&#39;,
 &#39;months&#39;,
 &#39;more&#39;,
 &#39;nah&#39;,
 &#39;network&#39;,
 &#39;nurungu&#39;,
 &#39;on&#39;,
 &#39;or&#39;,
 &#39;oru&#39;,
 &#39;our&#39;,
 &#39;per&#39;,
 &#39;press&#39;,
 &#39;prize&#39;,
 &#39;receive&#39;,
 &#39;request&#39;,
 &#39;reward&#39;,
 &#39;selected&#39;,
 &#39;set&#39;,
 &#39;so&#39;,
 &#39;the&#39;,
 &#39;think&#39;,
 &#39;though&#39;,
 &#39;to&#39;,
 &#39;update&#39;,
 &#39;urgent&#39;,
 &#39;usf&#39;,
 &#39;valued&#39;,
 &#39;vettam&#39;,
 &#39;week&#39;,
 &#39;with&#39;,
 &#39;won&#39;,
 &#39;you&#39;,
 &#39;your&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bow_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>08002986030</th>
      <th>100000</th>
      <th>11</th>
      <th>900</th>
      <th>all</th>
      <th>always</th>
      <th>are</th>
      <th>around</th>
      <th>as</th>
      <th>been</th>
      <th>...</th>
      <th>update</th>
      <th>urgent</th>
      <th>usf</th>
      <th>valued</th>
      <th>vettam</th>
      <th>week</th>
      <th>with</th>
      <th>won</th>
      <th>you</th>
      <th>your</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>URGENT!! As a valued network customer you have been selected to receive a £900 prize reward!</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Lol you are always so convincing.</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Nah I don't think he goes to usf, he lives around here though</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>URGENT! You have won a 1 week FREE membership in our £100000 prize Jackpot!</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Had your mobile 11 months or more? U R entitled to Update to the latest colour mobiles with camera for Free! Call The Mobile Update Co FREE on 08002986030</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>As per your request 'Melle Melle (Oru Minnaminunginte Nurungu Vettam)' has been set as your callertune for all Callers. Press *9 to copy your friends Callertune</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 72 columns</p>
</div></div></div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">CountVectorizer()</span></code> in a pipeline just like any other transformer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">CountVectorizer</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">())</span>

<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;spam&#39;, &#39;non spam&#39;, &#39;non spam&#39;, &#39;spam&#39;, &#39;spam&#39;, &#39;non spam&#39;],
      dtype=&#39;&lt;U8&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
<p>Here we get a perfect score on our toy dataset data that it’s seen already.</p>
<p>How well does it do on unseen data?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_new</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Congratulations! You have been awarded $1000!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mom, can you pick me up from soccer practice?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;I&#39;m trying to bake a cake and I forgot to put sugar in it smh. &quot;</span><span class="p">,</span>
    <span class="s2">&quot;URGENT: please pick up your car at 2pm from servicing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Call 234950323 for a FREE consultation. It&#39;s your lucky day!&quot;</span> <span class="p">]</span>
    
<span class="n">y_new</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;non spam&quot;</span><span class="p">,</span> <span class="s2">&quot;non spam&quot;</span><span class="p">,</span> <span class="s2">&quot;non spam&quot;</span><span class="p">,</span> <span class="s2">&quot;spam&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span><span class="n">y_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8
</pre></div>
</div>
</div>
</div>
<p>It’s not perfect but it seems to do well on this data too.</p>
</div>
<div class="section" id="is-this-a-realistic-representation-of-text-data">
<h3><span class="section-number">5.15.3. </span>Is this a realistic representation of text data?<a class="headerlink" href="#is-this-a-realistic-representation-of-text-data" title="Permalink to this headline">¶</a></h3>
<p>Of course, this is not a great representation of language.</p>
<ul class="simple">
<li><p>We are throwing out everything we know about language and losing a lot of information.</p></li>
<li><p>It assumes that there is no syntax and compositional meaning in language.</p></li>
</ul>
<p>…But it works surprisingly well for many tasks.</p>
</div>
</div>
<div class="section" id="id2">
<h2><span class="section-number">5.16. </span>Let’s Practice<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>1. What is the size of the vocabulary for the examples below?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;Take me to the river&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Drop me in the water&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Push me in the river&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dip me in the water&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>2. Which of the following is not a hyperparameter of <code class="docutils literal notranslate"><span class="pre">CountVectorizer()</span></code>?</p>
<p>a) <code class="docutils literal notranslate"><span class="pre">binary</span></code><br />
b) <code class="docutils literal notranslate"><span class="pre">max_features</span></code><br />
c) <code class="docutils literal notranslate"><span class="pre">vocab</span></code><br />
d) <code class="docutils literal notranslate"><span class="pre">ngram_range</span></code></p>
<p>3. What kind of representation do we use for our vocabulary?</p>
<p><strong>True or False</strong></p>
<p>4. As you increase the value for the <code class="docutils literal notranslate"><span class="pre">max_features</span></code> hyperparameter of <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code>, the training score is likely to go up.<br />
5. If we encounter a word in the validation or the test split that’s not available in the training data, we’ll get an error.</p>
<div class="dropdown admonition">
<p class="admonition-title">Solutions!</p>
<ol class="simple">
<li><p>10</p></li>
<li><p>c) <code class="docutils literal notranslate"><span class="pre">vocab</span></code></p></li>
<li><p>Bag of Words</p></li>
<li><p>True</p></li>
<li><p>False</p></li>
</ol>
</div>
</div>
<div class="section" id="let-s-practice-coding">
<h2><span class="section-number">5.17. </span>Let’s Practice - Coding<a class="headerlink" href="#let-s-practice-coding" title="Permalink to this headline">¶</a></h2>
<p>We are going to bring in a new dataset for you to practice on. (Make sure you’ve downloaded it from the <code class="docutils literal notranslate"><span class="pre">data</span></code> folder from the <code class="docutils literal notranslate"><span class="pre">lectures</span></code> section in Canvas - we’ve named it <code class="docutils literal notranslate"><span class="pre">balanced_tweets.csv</span></code>).</p>
<p>This dataset contains a text column containing tweets associated with disaster keywords and a target column denoting whether a tweet is about a real disaster (1) or not (0). [<a class="reference external" href="https://www.kaggle.com/vstepanenko/disaster-tweets">Source</a>]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loading in the data</span>
<span class="n">tweets_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/balanced_tweets.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>

<span class="c1"># Split the dataset into the feature table `X` and the target value `y`</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">tweets_df</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tweets_df</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>

<span class="c1"># Split the dataset into X_train, X_test, y_train, y_test </span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>Make a pipeline with <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> as the first step and <code class="docutils literal notranslate"><span class="pre">SVC()</span></code> as the second.</p></li>
<li><p>Perform 5 fold cross-validation using your pipeline and return the training score.</p></li>
<li><p>Convert the results into a dataframe.</p></li>
<li><p>What are the mean training and validation scores?</p></li>
<li><p>Train your pipeline on the training set.</p></li>
<li><p>Score the pipeline  on the test set.</p></li>
</ol>
</div>
<div class="section" id="what-we-ve-learned-today-a-id-9-a">
<h2><span class="section-number">5.18. </span>What We’ve Learned Today<a id="9"></a><a class="headerlink" href="#what-we-ve-learned-today-a-id-9-a" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>How to process categorical features.</p></li>
<li><p>How to apply ordinal encoding vs one-hot encoding.</p></li>
<li><p>How to use <code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code>, <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code> <code class="docutils literal notranslate"><span class="pre">make_column_transformer</span></code>.</p></li>
<li><p>How to work with text data.</p></li>
<li><p>How to use <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> to encode text data.</p></li>
<li><p>What the different hyperparameters of <code class="docutils literal notranslate"><span class="pre">CountVectorizer</span></code> are.</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "bait509-ubc/BAIT509",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="lecture4.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title"><span class="section-number">4. </span>SVM with RBF Kernel and Feature Preprocessing</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="lecture6.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title"><span class="section-number">6. </span>Naive Bayes and Hyperparameter Optimization</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Hayley Boyce<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>