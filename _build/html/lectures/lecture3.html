
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3. Baseline, k-Nearest Neighbours &#8212; BAIT 509 - Business Applications of Machine Learning</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.37f24b989f4638ff9c27c22dc7559d4f.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="canonical" href="https://bait509-ubc.github.io/BAIT509/intro.html/lectures/lecture3.html" />
    <link rel="shortcut icon" href="../_static/bait_logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. SVM with RBF Kernel and Feature Preprocessing" href="lecture4.html" />
    <link rel="prev" title="2. Splitting and Cross-validation" href="lecture2.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://bait509-ubc.github.io/BAIT509/intro.html/lectures/lecture3.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Baseline, k-Nearest Neighbours" />
<meta property="og:description" content="Baseline, k-Nearest Neighbours  Hayley Boyce, April 26th, 2021  # Importing our libraries  import pandas as pd import altair as alt import numpy as np from skle" />
<meta property="og:image"       content="https://bait509-ubc.github.io/BAIT509/intro.html/_static/bait_logo.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/bait_logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">BAIT 509 - Business Applications of Machine Learning</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Things You Should Know
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../things_to_know/who.html">
   Who: Hayley Boyce
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../things_to_know/how.html">
   How: The Course Structure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../things_to_know/what.html">
   What: Learning Outcomes
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lecture1.html">
   1. Intro to ML &amp;  Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture2.html">
   2. Splitting and Cross-validation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3. Baseline, k-Nearest Neighbours
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture4.html">
   4. SVM with RBF Kernel and Feature Preprocessing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture5.html">
   5. Preprocessing Categorical Features and Column Transformer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture6.html">
   6. Naive Bayes and Hyperparameter Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture7.html">
   7. Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture8.html">
   8. Forming good ML questions from business objectives and Feature Selection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture9.html">
   9. Classification and Regression Metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lecture10.html">
   10. Multi-Class, Pandas Profiling, Finale
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../things_to_know/attribution.html">
   Attribution
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/lectures/lecture3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/bait509-ubc/BAIT509"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/bait509-ubc/BAIT509/issues/new?title=Issue%20on%20page%20%2Flectures/lecture3.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/bait509-ubc/BAIT509/edit/master/lectures/lecture3.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/bait509-ubc/BAIT509/master?urlpath=tree/lectures/lecture3.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lecture-learning-objectives">
   3.1. Lecture Learning Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#house-keeping">
   3.2. House Keeping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#five-minute-recap-lightning-questions">
   3.3. Five Minute Recap/ Lightning Questions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-lingering-questions">
     3.3.1. Some lingering questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#baseline-models">
   3.4. Baseline Models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dummy-classifier">
     3.4.1. Dummy Classifier
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dummy-regressor">
     3.4.2. Dummy Regressor
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-s-practice">
   3.5. Let’s Practice
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analogy-based-models">
   3.6. Analogy-based models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     3.6.1. Example:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analogy-based-models-in-real-life">
     3.6.2. Analogy-based models in real life
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#terminology">
   3.7. Terminology
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-vectors">
     3.7.1. Feature Vectors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#distance">
   3.8. Distance
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#euclidean-distance">
     3.8.1. Euclidean distance
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculating-euclidean-distance-by-hand">
       3.8.1.1. Calculating Euclidean distance “by hand”
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculating-euclidean-distance-with-sklearn">
       3.8.1.2. Calculating Euclidean distance  with
       <code class="docutils literal notranslate">
        <span class="pre">
         sklearn
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-the-nearest-neighbour">
   3.9. Finding the Nearest Neighbour
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nearest-city-to-a-query-point">
     3.9.1. Nearest city to a query point
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   3.10. Let’s Practice
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#k-nearest-neighbours-k-nns-classifier">
   3.11.
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -Nearest Neighbours (
   <span class="math notranslate nohighlight">
    \(k\)
   </span>
   -NNs) Classifier
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choosing-k">
   3.12. Choosing K
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-choose-k-n-neighbors">
     3.12.1. How to choose
     <span class="math notranslate nohighlight">
      \(K\)
     </span>
     (
     <code class="docutils literal notranslate">
      <span class="pre">
       n_neighbors
      </span>
     </code>
     )?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#curse-of-dimensionality">
   3.13. Curse of Dimensionality
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   3.14. Let’s Practice
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-we-ve-learned-today-a-id-9-a">
   3.15. What We’ve Learned Today
   <a id="9">
   </a>
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="baseline-k-nearest-neighbours">
<h1><span class="section-number">3. </span>Baseline, k-Nearest Neighbours<a class="headerlink" href="#baseline-k-nearest-neighbours" title="Permalink to this headline">¶</a></h1>
<p><em>Hayley Boyce, April 26th, 2021</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing our libraries</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span><span class="p">,</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;code/&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">display_tree</span> <span class="kn">import</span> <span class="n">display_tree</span>
<span class="kn">from</span> <span class="nn">plot_classifier</span> <span class="kn">import</span> <span class="n">plot_classifier</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lecture-learning-objectives">
<h2><span class="section-number">3.1. </span>Lecture Learning Objectives<a class="headerlink" href="#lecture-learning-objectives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code> and <code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code> as baselines for machine learning problems.</p></li>
<li><p>Explain the notion of similarity-based algorithms .</p></li>
<li><p>Broadly describe how KNNs use distances.</p></li>
<li><p>Discuss the effect of using a small/large value of the hyperparameter <span class="math notranslate nohighlight">\(K\)</span> when using the KNN algorithm</p></li>
<li><p>Explain the general idea of SVMs with RBF kernel.</p></li>
<li><p>Describe the problem of the curse of dimensionality.</p></li>
<li><p>Broadly describe the relation of <code class="docutils literal notranslate"><span class="pre">gamma</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> hyperparameters and the fundamental tradeoff.</p></li>
</ul>
</div>
<div class="section" id="house-keeping">
<h2><span class="section-number">3.2. </span>House Keeping<a class="headerlink" href="#house-keeping" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Assignment due Wednesday April 28th</p></li>
<li><p>1.7 on Assignment</p></li>
<li><p>rounding for Spotify</p></li>
<li><p>Next Assignment release (either Thursday or Monday depending on how far we get today)</p></li>
<li><p>Technical issues, <a class="reference external" href="https://bait509-ubc.github.io/BAIT509/intro.html">Online resource</a>, reaching out!</p></li>
</ul>
</div>
<div class="section" id="five-minute-recap-lightning-questions">
<h2><span class="section-number">3.3. </span>Five Minute Recap/ Lightning Questions<a class="headerlink" href="#five-minute-recap-lightning-questions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>What are the 4 types of data/splits that we discussed last class?</p></li>
<li><p>What is the “Golden Rule of Machine Learning”?</p></li>
<li><p>What do we use to split our data?</p></li>
<li><p>If we have 6-fold cross-validation, how many times is <code class="docutils literal notranslate"><span class="pre">.fit()</span></code> being called?</p></li>
<li><p>What is overfitting?</p></li>
</ul>
<div class="section" id="some-lingering-questions">
<h3><span class="section-number">3.3.1. </span>Some lingering questions<a class="headerlink" href="#some-lingering-questions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Are decision trees the most basic model?</p></li>
<li><p>What other models can we build?</p></li>
</ul>
</div>
</div>
<div class="section" id="baseline-models">
<h2><span class="section-number">3.4. </span>Baseline Models<a class="headerlink" href="#baseline-models" title="Permalink to this headline">¶</a></h2>
<p>We saw in the last 2 lectures how to build decision tree models which are based on rules (if-else statements), but how can we be sure that these models are doing a good job besides just accuracy?</p>
<p>Back in high school in chemistry or biology, we’ve all likely seen and heard of the “control group” where we have an experimental group, does not receive any experimental treatment.  This control group increases the reliability of the results, often through a comparison between control measurements and the other measurements.</p>
<p>Our baseline model is something like a control group in the sense that it provides a way to sanity-check your machine learning model. We make baseline models not to use for prediction purposes, but as a reference point when we are building other more sophisticated models.</p>
<p>So what is a baseline model then?</p>
<ul class="simple">
<li><p>Baseline: A simple machine learning algorithm based on simple rules of thumb. For example,</p>
<ul>
<li><p>most frequent baseline: always predicts the most frequent label in the training set.</p></li>
</ul>
</li>
</ul>
<div class="section" id="dummy-classifier">
<h3><span class="section-number">3.4.1. </span>Dummy Classifier<a class="headerlink" href="#dummy-classifier" title="Permalink to this headline">¶</a></h3>
<p>We are going to build a most frequent baseline model which always predicts the most frequently labelled in the training set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">voting_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/cities_USA.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">voting_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lon</th>
      <th>lat</th>
      <th>vote</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>-80.162475</td>
      <td>25.692104</td>
      <td>blue</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-80.214360</td>
      <td>25.944083</td>
      <td>blue</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-80.094133</td>
      <td>26.234314</td>
      <td>blue</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-80.248086</td>
      <td>26.291902</td>
      <td>blue</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-81.789963</td>
      <td>26.348035</td>
      <td>blue</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># feature table</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">voting_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;vote&#39;</span><span class="p">)</span> 

<span class="c1"># the target variable</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">voting_df</span><span class="p">[[</span><span class="s1">&#39;vote&#39;</span><span class="p">]]</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We build our model, in the same way as we built a decision tree model but this time using <code class="docutils literal notranslate"><span class="pre">DummyClassifier</span></code>.</p>
<p>Since we are using a “most frequent” baseline model, we specify the argument <code class="docutils literal notranslate"><span class="pre">strategy</span></code> as <code class="docutils literal notranslate"><span class="pre">&quot;most_frequent&quot;</span></code></p>
<p>Other options include: <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.dummy.DummyClassifier.html">“stratified”, “prior”, “uniform”, “constant”</a> but you just need to know <code class="docutils literal notranslate"><span class="pre">most_frequent</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_clf</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the last lecture, we stated that it’s at this point that we would usually perform cross-validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">dummy_clf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">scores_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
<span class="n">scores_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.001024</td>
      <td>0.000662</td>
      <td>0.59375</td>
      <td>0.576389</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000727</td>
      <td>0.000334</td>
      <td>0.59375</td>
      <td>0.576389</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.000992</td>
      <td>0.000309</td>
      <td>0.59375</td>
      <td>0.576389</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000725</td>
      <td>0.000321</td>
      <td>0.59375</td>
      <td>0.576389</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000698</td>
      <td>0.000371</td>
      <td>0.59375</td>
      <td>0.576389</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.000685</td>
      <td>0.000400</td>
      <td>0.56250</td>
      <td>0.579861</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.000634</td>
      <td>0.000299</td>
      <td>0.56250</td>
      <td>0.579861</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.000651</td>
      <td>0.000293</td>
      <td>0.56250</td>
      <td>0.579861</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.000696</td>
      <td>0.000294</td>
      <td>0.56250</td>
      <td>0.579861</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.000794</td>
      <td>0.000303</td>
      <td>0.56250</td>
      <td>0.579861</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit_time       0.000763
score_time     0.000359
test_score     0.578125
train_score    0.578125
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>With Dummy Classifiers, we won’t need to because we are not hyperparameter tuning. We are using this just to get a base training score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">dummy_clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.578125
</pre></div>
</div>
</div>
</div>
<p>If we see what our model predicts on the feature table for our training split <code class="docutils literal notranslate"><span class="pre">X_train</span></code>, our model will predict the most occurring class from our training data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vote
blue    185
red     135
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;,
       &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;],
      dtype=&#39;&lt;U4&#39;)
</pre></div>
</div>
</div>
</div>
<p>We can also now take the test score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6125
</pre></div>
</div>
</div>
</div>
<p>Here is a good example of when we occasionally have test scores better than the training scores.</p>
<p>In this case, it’s higher because our test split has a higher proportion of observations that are of class blue and so more of them will be predicted correctly.</p>
<p>Now if we do a decision tree, we can say that this algorithm is doing better than a model build on this simple “most frequently” occurring model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt_clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>

<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">dt_clf</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">scores_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
<span class="n">scores_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.004151</td>
      <td>0.001439</td>
      <td>0.84375</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.003474</td>
      <td>0.001532</td>
      <td>0.93750</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.004101</td>
      <td>0.001669</td>
      <td>0.75000</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.003502</td>
      <td>0.001916</td>
      <td>0.90625</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.004955</td>
      <td>0.001465</td>
      <td>0.96875</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.003908</td>
      <td>0.001457</td>
      <td>0.90625</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.004922</td>
      <td>0.001558</td>
      <td>0.87500</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.004069</td>
      <td>0.001401</td>
      <td>0.87500</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.004004</td>
      <td>0.001888</td>
      <td>0.87500</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.003664</td>
      <td>0.001884</td>
      <td>0.90625</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit_time       0.004075
score_time     0.001621
test_score     0.884375
train_score    1.000000
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">dt_clf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9125
</pre></div>
</div>
</div>
</div>
<p>This makes us trust our model a little more.</p>
</div>
<div class="section" id="dummy-regressor">
<h3><span class="section-number">3.4.2. </span>Dummy Regressor<a class="headerlink" href="#dummy-regressor" title="Permalink to this headline">¶</a></h3>
<p>For a Dummy regressor, the same principles can be applied but by using different strategies.</p>
<p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.dummy.DummyRegressor.html?highlight=dummyregressor">“mean”, “median”, “quantile”, “constant”</a></p>
<p>The one we are going to become most familiar with is:</p>
<p><strong>Average (mean) target value:</strong> always predicts the mean of the training set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">house_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/kc_house_data.csv&quot;</span><span class="p">)</span>
<span class="n">house_df</span> <span class="o">=</span> <span class="n">house_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">])</span>
<span class="n">house_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>condition</th>
      <th>grade</th>
      <th>sqft_above</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>221900.0</td>
      <td>3</td>
      <td>1.00</td>
      <td>1180</td>
      <td>5650</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>1180</td>
      <td>0</td>
      <td>1955</td>
      <td>0</td>
      <td>98178</td>
      <td>47.5112</td>
      <td>-122.257</td>
      <td>1340</td>
      <td>5650</td>
    </tr>
    <tr>
      <th>1</th>
      <td>538000.0</td>
      <td>3</td>
      <td>2.25</td>
      <td>2570</td>
      <td>7242</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>2170</td>
      <td>400</td>
      <td>1951</td>
      <td>1991</td>
      <td>98125</td>
      <td>47.7210</td>
      <td>-122.319</td>
      <td>1690</td>
      <td>7639</td>
    </tr>
    <tr>
      <th>2</th>
      <td>180000.0</td>
      <td>2</td>
      <td>1.00</td>
      <td>770</td>
      <td>10000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>6</td>
      <td>770</td>
      <td>0</td>
      <td>1933</td>
      <td>0</td>
      <td>98028</td>
      <td>47.7379</td>
      <td>-122.233</td>
      <td>2720</td>
      <td>8062</td>
    </tr>
    <tr>
      <th>3</th>
      <td>604000.0</td>
      <td>4</td>
      <td>3.00</td>
      <td>1960</td>
      <td>5000</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>7</td>
      <td>1050</td>
      <td>910</td>
      <td>1965</td>
      <td>0</td>
      <td>98136</td>
      <td>47.5208</td>
      <td>-122.393</td>
      <td>1360</td>
      <td>5000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>510000.0</td>
      <td>3</td>
      <td>2.00</td>
      <td>1680</td>
      <td>8080</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>1680</td>
      <td>0</td>
      <td>1987</td>
      <td>0</td>
      <td>98074</td>
      <td>47.6168</td>
      <td>-122.045</td>
      <td>1800</td>
      <td>7503</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let get our <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> objects and split our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">house_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">house_df</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We still need to make sure we split our data with baseline models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>we need to import <code class="docutils literal notranslate"><span class="pre">DummyRegressor</span></code> and construct our model.</p>
<p>We specify <code class="docutils literal notranslate"><span class="pre">strategy=&quot;mean&quot;</span></code> however this is the default value so technically we don’t need to specify this.</p>
<p>We train our model and again, it’s not needed to cross-validate for this type of algorithm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyRegressor</span>

<span class="n">dummy_reg</span> <span class="o">=</span> <span class="n">DummyRegressor</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="n">dummy_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DummyRegressor()
</pre></div>
</div>
</div>
</div>
<p>If we predict on our training data, we see it’s making the same prediction for each observation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([539306.46784268, 539306.46784268, 539306.46784268, ...,
       539306.46784268, 539306.46784268, 539306.46784268])
</pre></div>
</div>
</div>
</div>
<p>if we compare the mean value of the target, we see that our model is simply predicting the average of the training data which is exactly what we expect.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>539306.4678426837
</pre></div>
</div>
</div>
</div>
<p>How well does it do?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>We get an <span class="math notranslate nohighlight">\(R^2\)</span> value of 0.0.</p>
<p>When a model has an  <span class="math notranslate nohighlight">\(R^2\)</span>=0 that means that the model is doing no better than a model that using the mean which is exactly the case here.</p>
<p>Looking at the test score we see that our model get’s a negative value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.00010814646015933072
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="let-s-practice">
<h2><span class="section-number">3.5. </span>Let’s Practice<a class="headerlink" href="#let-s-practice" title="Permalink to this headline">¶</a></h2>
<p>1. Below we have the output of <code class="docutils literal notranslate"><span class="pre">y_train.value_counts()</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Position</span>
<span class="n">Forward</span>     <span class="mi">13</span>
<span class="n">Defense</span>      <span class="mi">7</span>
<span class="n">Goalie</span>       <span class="mi">2</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>In this scenario, what would a <code class="docutils literal notranslate"><span class="pre">DummyClassifier(strategy='most_frequent')</span></code> model predict on the following observation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">No</span><span class="o">.</span>  <span class="n">Age</span>  <span class="n">Height</span>  <span class="n">Weight</span>  <span class="n">Experience</span>     <span class="n">Salary</span>
<span class="mi">1</span>   <span class="mi">83</span>   <span class="mi">34</span>     <span class="mi">191</span>     <span class="mi">210</span>          <span class="mi">11</span>  <span class="mf">3200000.0</span>
</pre></div>
</div>
<p>2. When using a regression model, which of the following is not a possible return value from .score(X,y) ?</p>
<p>a) 0.0<br />
b) 1.0<br />
c) -0.1<br />
d) 1.5</p>
<p>3.  Below are the values for <code class="docutils literal notranslate"><span class="pre">y</span></code> that were used to train  <code class="docutils literal notranslate"><span class="pre">DummyRegressor(strategy='mean')</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Grade</span>
<span class="mi">0</span>     <span class="mi">75</span>
<span class="mi">1</span>     <span class="mi">80</span>
<span class="mi">2</span>     <span class="mi">90</span>
<span class="mi">3</span>     <span class="mi">95</span>
<span class="mi">4</span>     <span class="mi">85</span>
<span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<p>What value will the model predict for every example?</p>
<div class="dropdown admonition">
<p class="admonition-title">Solutions!</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Forward</span></code></p></li>
<li><p>d) 1.5</p></li>
<li><p>85</p></li>
</ol>
</div>
</div>
<div class="section" id="analogy-based-models">
<h2><span class="section-number">3.6. </span>Analogy-based models<a class="headerlink" href="#analogy-based-models" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Suppose you are given the following training examples with corresponding labels and are asked to label a given test example.</p></li>
</ul>
<p>An intuitive way to classify the test example is by finding the most “similar” example(s) from the training set and using that label for the test example.</p>
<a class="reference internal image-reference" href="../_images/knn-motivation.png"><img alt="../_images/knn-motivation.png" src="../_images/knn-motivation.png" style="width: 100%;" /></a>
<p>In ML, we are given <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> next, we learn a mapping function from this training data then, given a new unseen example, we predict the target of this new example using our learn-mapping function.</p>
<p>In the case of decision trees, we did this by asking a series of questions on some features and some thresholds on future values.</p>
<p>But, another intuitive way to do this is by using the notion of analogy.</p>
<div class="section" id="example">
<h3><span class="section-number">3.6.1. </span>Example:<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Suppose we are given many images and their labels.</p>
<p><code class="docutils literal notranslate"><span class="pre">X</span></code> = set of pictures</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> = names associated with those pictures.</p>
<p>Then we are given a new unseen test example, a picture in this particular case.</p>
<a class="reference internal image-reference" href="../_images/test_pic.png"><img alt="../_images/test_pic.png" src="../_images/test_pic.png" style="width: 5%;" /></a>
<p>We want to find out the label for this new test picture.</p>
<p>Naturally, we would try and find the most similar picture in our training set and using the label of the most similar picture as the label of this new test example.</p>
<p>That’s the basic idea behind analogy-based algorithms.</p>
</div>
<div class="section" id="analogy-based-models-in-real-life">
<h3><span class="section-number">3.6.2. </span>Analogy-based models in real life<a class="headerlink" href="#analogy-based-models-in-real-life" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a href="https://www.hertasecurity.com/en" target="_blank">Herta’s High-tech Facial Recognition</a></p></li>
</ul>
<a class="reference internal image-reference" href="../_images/face_rec.png"><img alt="404 image" src="../_images/face_rec.png" style="width: 20%;" /></a>
<ul class="simple">
<li><p>Recommendation systems</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/book_rec.png"><img alt="404 image" src="../_images/book_rec.png" style="width: 90%;" /></a>
</div>
</div>
<div class="section" id="terminology">
<h2><span class="section-number">3.7. </span>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<p>In analogy-based algorithms, our goal is to come up with a way to find similarities between examples.
“similarity” is a bit ambiguous so we need some terminology.</p>
<ul class="simple">
<li><p>data: think of observations (rows) as points in a high dimensional space.</p></li>
<li><p>Each feature: Additional dimension.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/3d-table.png"><img alt="404 image" src="../_images/3d-table.png" style="width: 60%;" /></a>
<p>Above we have:</p>
<ul class="simple">
<li><p>Three features; speed attack and defense.</p></li>
<li><p>7 points in this three-dimensional space.</p></li>
</ul>
<p>Let’s go back to our Canada/USA cities dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/canada_usa_cities.csv&quot;</span><span class="p">)</span>
<span class="n">cities_train_df</span><span class="p">,</span> <span class="n">cities_test_df</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">cities_df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">cities_train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>160</th>
      <td>-76.4813</td>
      <td>44.2307</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>127</th>
      <td>-81.2496</td>
      <td>42.9837</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>169</th>
      <td>-66.0580</td>
      <td>45.2788</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>188</th>
      <td>-73.2533</td>
      <td>45.3057</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>187</th>
      <td>-67.9245</td>
      <td>47.1652</td>
      <td>Canada</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_train_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(167, 3)
</pre></div>
</div>
</div>
</div>
<p>We have 2 features, so 2 dimensions (<code class="docutils literal notranslate"><span class="pre">longitude</span></code> and <code class="docutils literal notranslate"><span class="pre">latitude</span></code>)  and 167 points.
Visualizing this in 2 dimensions gives us the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_viz</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">cities_train_df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;longitude:Q&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">140</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">])),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;latitude:Q&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">])),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;country:N&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Canada&#39;</span><span class="p">,</span> <span class="s1">&#39;USA&#39;</span><span class="p">],</span>
                                           <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">]))</span>
<span class="p">)</span>
<span class="n">cities_viz</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-e3104f65a0ad4120b69715033b568310"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-e3104f65a0ad4120b69715033b568310") {
      outputDiv = document.getElementById("altair-viz-e3104f65a0ad4120b69715033b568310");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-2c4b8116a5ba02671a69ae33b802cc1c"}, "mark": {"type": "circle", "opacity": 0.6, "size": 20}, "encoding": {"color": {"type": "nominal", "field": "country", "scale": {"domain": ["Canada", "USA"], "range": ["red", "blue"]}}, "x": {"type": "quantitative", "field": "longitude", "scale": {"domain": [-140, -40]}}, "y": {"type": "quantitative", "field": "latitude", "scale": {"domain": [20, 60]}}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-2c4b8116a5ba02671a69ae33b802cc1c": [{"longitude": -76.4813, "latitude": 44.2307, "country": "Canada"}, {"longitude": -81.2496, "latitude": 42.9837, "country": "Canada"}, {"longitude": -66.058, "latitude": 45.2788, "country": "Canada"}, {"longitude": -73.2533, "latitude": 45.3057, "country": "Canada"}, {"longitude": -67.9245, "latitude": 47.1652, "country": "Canada"}, {"longitude": -120.3394, "latitude": 50.6758, "country": "Canada"}, {"longitude": -106.65100000000001, "latitude": 35.0841, "country": "USA"}, {"longitude": -79.6902, "latitude": 44.3893, "country": "Canada"}, {"longitude": -84.3201, "latitude": 46.5239, "country": "Canada"}, {"longitude": -98.4951, "latitude": 29.4246, "country": "USA"}, {"longitude": -77.0366, "latitude": 38.895, "country": "USA"}, {"longitude": -93.3968, "latitude": 48.6114, "country": "Canada"}, {"longitude": -67.2799, "latitude": 45.2004, "country": "Canada"}, {"longitude": -122.8565, "latitude": 49.3144, "country": "Canada"}, {"longitude": -63.571999999999996, "latitude": 44.68, "country": "Canada"}, {"longitude": -68.3219, "latitude": 47.3556, "country": "USA"}, {"longitude": -97.1385, "latitude": 49.8955, "country": "Canada"}, {"longitude": -122.3295, "latitude": 49.0521, "country": "Canada"}, {"longitude": -87.6244, "latitude": 41.8756, "country": "USA"}, {"longitude": -68.5897, "latitude": 47.2587, "country": "USA"}, {"longitude": -73.4467, "latitude": 45.5172, "country": "Canada"}, {"longitude": -63.5859, "latitude": 44.6486, "country": "Canada"}, {"longitude": -97.7437, "latitude": 30.2711, "country": "USA"}, {"longitude": -79.0247, "latitude": 43.8504, "country": "Canada"}, {"longitude": -111.9639, "latitude": 49.0017, "country": "Canada"}, {"longitude": -129.9912, "latitude": 55.9383, "country": "Canada"}, {"longitude": -78.9186, "latitude": 42.9131, "country": "Canada"}, {"longitude": -71.7985, "latitude": 45.0126, "country": "Canada"}, {"longitude": -95.9929, "latitude": 36.1557, "country": "USA"}, {"longitude": -123.0833, "latitude": 49.0167, "country": "Canada"}, {"longitude": -94.5648, "latitude": 48.7227, "country": "Canada"}, {"longitude": -118.7148, "latitude": 50.4165, "country": "Canada"}, {"longitude": -97.2049, "latitude": 48.9988, "country": "USA"}, {"longitude": -122.7933, "latitude": 49.2843, "country": "Canada"}, {"longitude": -97.1056, "latitude": 32.7019, "country": "USA"}, {"longitude": -72.5565, "latitude": 46.3327, "country": "Canada"}, {"longitude": -75.1635, "latitude": 39.9527, "country": "USA"}, {"longitude": -110.9748, "latitude": 32.2229, "country": "USA"}, {"longitude": -67.2781, "latitude": 45.18899999999999, "country": "USA"}, {"longitude": -83.0466, "latitude": 42.3316, "country": "USA"}, {"longitude": -79.7599, "latitude": 43.6858, "country": "Canada"}, {"longitude": -84.3201, "latitude": 46.5239, "country": "Canada"}, {"longitude": -106.6608, "latitude": 52.1318, "country": "Canada"}, {"longitude": -83.0007, "latitude": 39.9623, "country": "USA"}, {"longitude": -75.7106, "latitude": 45.4284, "country": "Canada"}, {"longitude": -52.7151, "latitude": 47.5617, "country": "Canada"}, {"longitude": -113.508, "latitude": 53.5354, "country": "Canada"}, {"longitude": -76.6108, "latitude": 39.2909, "country": "USA"}, {"longitude": -97.5533, "latitude": 48.7531, "country": "USA"}, {"longitude": -66.9843, "latitude": 44.8607, "country": "USA"}, {"longitude": -113.8184, "latitude": 52.2698, "country": "Canada"}, {"longitude": -113.2966, "latitude": 53.5257, "country": "Canada"}, {"longitude": -79.4394, "latitude": 43.8801, "country": "Canada"}, {"longitude": -66.9905, "latitude": 44.9065, "country": "USA"}, {"longitude": -112.0741, "latitude": 33.4484, "country": "USA"}, {"longitude": -130.0437, "latitude": 55.9773, "country": "USA"}, {"longitude": -75.7887, "latitude": 45.3113, "country": "Canada"}, {"longitude": -80.8431, "latitude": 35.2272, "country": "USA"}, {"longitude": -79.6667, "latitude": 43.4474, "country": "Canada"}, {"longitude": -121.8906, "latitude": 37.3362, "country": "USA"}, {"longitude": -85.7039, "latitude": 38.2092, "country": "USA"}, {"longitude": -73.6515, "latitude": 45.7081, "country": "Canada"}, {"longitude": -122.4199, "latitude": 37.779, "country": "USA"}, {"longitude": -79.4109, "latitude": 43.7615, "country": "Canada"}, {"longitude": -67.9245, "latitude": 47.1652, "country": "Canada"}, {"longitude": -111.9626, "latitude": 48.9971, "country": "USA"}, {"longitude": -79.0359, "latitude": 43.1726, "country": "USA"}, {"longitude": -73.6875, "latitude": 45.5089, "country": "Canada"}, {"longitude": -111.8315, "latitude": 33.4151, "country": "USA"}, {"longitude": -114.0626, "latitude": 51.0534, "country": "Canada"}, {"longitude": -73.6289, "latitude": 45.468, "country": "Canada"}, {"longitude": -75.9774, "latitude": 36.853, "country": "USA"}, {"longitude": -79.3839, "latitude": 43.6535, "country": "Canada"}, {"longitude": -87.9225, "latitude": 43.035, "country": "USA"}, {"longitude": -72.7218, "latitude": 45.398999999999994, "country": "Canada"}, {"longitude": -117.1628, "latitude": 32.7174, "country": "USA"}, {"longitude": -67.4297, "latitude": 45.5634, "country": "USA"}, {"longitude": -83.0466, "latitude": 42.3316, "country": "USA"}, {"longitude": -123.1374, "latitude": 49.1632, "country": "Canada"}, {"longitude": -119.4983, "latitude": 49.8893, "country": "Canada"}, {"longitude": -79.8729, "latitude": 43.2561, "country": "Canada"}, {"longitude": -122.5997, "latitude": 49.2197, "country": "Canada"}, {"longitude": -80.2632, "latitude": 43.1408, "country": "Canada"}, {"longitude": -79.2441, "latitude": 43.158, "country": "Canada"}, {"longitude": -97.2089, "latitude": 49.0061, "country": "Canada"}, {"longitude": -94.6002, "latitude": 48.7124, "country": "USA"}, {"longitude": -102.5496, "latitude": 48.9959, "country": "USA"}, {"longitude": -83.0353, "latitude": 42.3171, "country": "Canada"}, {"longitude": -71.889, "latitude": 45.4033, "country": "Canada"}, {"longitude": -66.6458, "latitude": 45.9664, "country": "Canada"}, {"longitude": -71.0692, "latitude": 48.406000000000006, "country": "Canada"}, {"longitude": -84.3902, "latitude": 33.7491, "country": "USA"}, {"longitude": -122.7436, "latitude": 48.9881, "country": "USA"}, {"longitude": -102.54799999999999, "latitude": 49.0014, "country": "Canada"}, {"longitude": -104.6173, "latitude": 50.4488, "country": "Canada"}, {"longitude": -122.3301, "latitude": 47.6038, "country": "USA"}, {"longitude": -123.11399999999999, "latitude": 49.2609, "country": "Canada"}, {"longitude": -71.0583, "latitude": 42.3603, "country": "USA"}, {"longitude": -134.4197, "latitude": 58.3019, "country": "USA"}, {"longitude": -75.4864, "latitude": 44.6943, "country": "USA"}, {"longitude": -82.4405, "latitude": 42.9816, "country": "USA"}, {"longitude": -71.3998, "latitude": 46.8884, "country": "Canada"}, {"longitude": -122.6742, "latitude": 45.5202, "country": "USA"}, {"longitude": -67.9353, "latitude": 47.1575, "country": "USA"}, {"longitude": -69.265, "latitude": 47.5052, "country": "Canada"}, {"longitude": -97.3327, "latitude": 32.7532, "country": "USA"}, {"longitude": -123.365, "latitude": 48.4283, "country": "Canada"}, {"longitude": -68.3281, "latitude": 47.3644, "country": "Canada"}, {"longitude": -78.8784, "latitude": 42.8867, "country": "USA"}, {"longitude": -79.5268, "latitude": 43.7942, "country": "Canada"}, {"longitude": -79.6457, "latitude": 43.5903, "country": "Canada"}, {"longitude": -79.4608, "latitude": 46.3092, "country": "Canada"}, {"longitude": -95.9384, "latitude": 41.2587, "country": "USA"}, {"longitude": -79.0615, "latitude": 43.0844, "country": "USA"}, {"longitude": -79.7967, "latitude": 43.3249, "country": "Canada"}, {"longitude": -69.2275, "latitude": 47.4562, "country": "USA"}, {"longitude": -123.0833, "latitude": 49.0833, "country": "Canada"}, {"longitude": -90.0516, "latitude": 35.149, "country": "USA"}, {"longitude": -122.2714, "latitude": 37.8045, "country": "USA"}, {"longitude": -119.7848, "latitude": 36.7394, "country": "USA"}, {"longitude": -104.8253, "latitude": 38.834, "country": "USA"}, {"longitude": -74.0132, "latitude": 45.7754, "country": "Canada"}, {"longitude": -79.3377, "latitude": 43.8564, "country": "Canada"}, {"longitude": -93.2655, "latitude": 44.9773, "country": "USA"}, {"longitude": -95.3677, "latitude": 29.7589, "country": "USA"}, {"longitude": -80.3123, "latitude": 43.3601, "country": "Canada"}, {"longitude": -79.1153, "latitude": 43.101000000000006, "country": "Canada"}, {"longitude": -79.7599, "latitude": 43.6858, "country": "Canada"}, {"longitude": -75.5192, "latitude": 44.7184, "country": "Canada"}, {"longitude": -68.6034, "latitude": 47.2527, "country": "Canada"}, {"longitude": -83.0353, "latitude": 42.3171, "country": "Canada"}, {"longitude": -73.7344, "latitude": 45.6056, "country": "Canada"}, {"longitude": -72.0968, "latitude": 45.0072, "country": "Canada"}, {"longitude": -67.5735, "latitude": 46.1503, "country": "Canada"}, {"longitude": -80.4944, "latitude": 43.4532, "country": "Canada"}, {"longitude": -79.1153, "latitude": 43.101000000000006, "country": "Canada"}, {"longitude": -110.679, "latitude": 50.043, "country": "Canada"}, {"longitude": -78.3199, "latitude": 44.3048, "country": "Canada"}, {"longitude": -79.2506, "latitude": 42.9931, "country": "Canada"}, {"longitude": -96.7969, "latitude": 32.7763, "country": "USA"}, {"longitude": -122.3295, "latitude": 49.0521, "country": "Canada"}, {"longitude": -123.07799999999999, "latitude": 48.9854, "country": "USA"}, {"longitude": -97.5171, "latitude": 35.473, "country": "USA"}, {"longitude": -104.9849, "latitude": 39.7392, "country": "USA"}, {"longitude": -94.5781, "latitude": 39.1001, "country": "USA"}, {"longitude": -122.9109, "latitude": 49.2068, "country": "Canada"}, {"longitude": -89.2598, "latitude": 48.4064, "country": "Canada"}, {"longitude": -82.4584, "latitude": 27.9478, "country": "USA"}, {"longitude": -71.1473, "latitude": 48.382, "country": "Canada"}, {"longitude": -71.1753, "latitude": 46.791000000000004, "country": "Canada"}, {"longitude": -73.6104, "latitude": 45.4972, "country": "Canada"}, {"longitude": -79.8828, "latitude": 43.5137, "country": "Canada"}, {"longitude": -118.2428, "latitude": 34.0537, "country": "USA"}, {"longitude": -118.1916, "latitude": 33.769, "country": "USA"}, {"longitude": -86.1584, "latitude": 39.7683, "country": "USA"}, {"longitude": -72.9406, "latitude": 45.6275, "country": "Canada"}, {"longitude": -75.6903, "latitude": 45.4211, "country": "Canada"}, {"longitude": -76.3019, "latitude": 44.211000000000006, "country": "Canada"}, {"longitude": -115.1485, "latitude": 36.1673, "country": "USA"}, {"longitude": -122.8491, "latitude": 49.1913, "country": "Canada"}, {"longitude": -67.4253, "latitude": 45.5672, "country": "Canada"}, {"longitude": -122.8491, "latitude": 49.1913, "country": "Canada"}, {"longitude": -76.3305, "latitude": 44.1255, "country": "USA"}, {"longitude": -74.7287, "latitude": 45.0184, "country": "Canada"}, {"longitude": -121.4944, "latitude": 38.5816, "country": "USA"}, {"longitude": -79.5656, "latitude": 43.6436, "country": "Canada"}, {"longitude": -66.9195, "latitude": 44.8938, "country": "Canada"}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>What about the housing training dataset we saw?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">house_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/kc_house_data.csv&quot;</span><span class="p">)</span>
<span class="n">house_df</span> <span class="o">=</span> <span class="n">house_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">])</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">house_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">house_df</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>


<span class="n">house_X_train</span><span class="p">,</span> <span class="n">house_X_test</span><span class="p">,</span> <span class="n">house_y_train</span><span class="p">,</span> <span class="n">house_y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">house_X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bedrooms</th>
      <th>bathrooms</th>
      <th>sqft_living</th>
      <th>sqft_lot</th>
      <th>floors</th>
      <th>waterfront</th>
      <th>view</th>
      <th>condition</th>
      <th>grade</th>
      <th>sqft_above</th>
      <th>sqft_basement</th>
      <th>yr_built</th>
      <th>yr_renovated</th>
      <th>zipcode</th>
      <th>lat</th>
      <th>long</th>
      <th>sqft_living15</th>
      <th>sqft_lot15</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14305</th>
      <td>3</td>
      <td>2.75</td>
      <td>2170</td>
      <td>2738</td>
      <td>1.5</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>9</td>
      <td>1550</td>
      <td>620</td>
      <td>1930</td>
      <td>0</td>
      <td>98109</td>
      <td>47.6389</td>
      <td>-122.349</td>
      <td>1170</td>
      <td>1062</td>
    </tr>
    <tr>
      <th>19844</th>
      <td>4</td>
      <td>2.75</td>
      <td>3550</td>
      <td>9400</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>9</td>
      <td>3550</td>
      <td>0</td>
      <td>2014</td>
      <td>0</td>
      <td>98059</td>
      <td>47.4827</td>
      <td>-122.131</td>
      <td>3550</td>
      <td>9421</td>
    </tr>
    <tr>
      <th>2686</th>
      <td>3</td>
      <td>3.25</td>
      <td>1210</td>
      <td>1173</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>1000</td>
      <td>210</td>
      <td>2002</td>
      <td>0</td>
      <td>98133</td>
      <td>47.7114</td>
      <td>-122.356</td>
      <td>1650</td>
      <td>1493</td>
    </tr>
    <tr>
      <th>11926</th>
      <td>3</td>
      <td>2.50</td>
      <td>2370</td>
      <td>7875</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>9</td>
      <td>2370</td>
      <td>0</td>
      <td>2003</td>
      <td>0</td>
      <td>98065</td>
      <td>47.5427</td>
      <td>-121.863</td>
      <td>2660</td>
      <td>7752</td>
    </tr>
    <tr>
      <th>13873</th>
      <td>5</td>
      <td>1.75</td>
      <td>2250</td>
      <td>8970</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>7</td>
      <td>1500</td>
      <td>750</td>
      <td>1966</td>
      <td>0</td>
      <td>98034</td>
      <td>47.7217</td>
      <td>-122.188</td>
      <td>1940</td>
      <td>8710</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>15377</th>
      <td>4</td>
      <td>2.50</td>
      <td>3440</td>
      <td>14554</td>
      <td>2.0</td>
      <td>1</td>
      <td>4</td>
      <td>3</td>
      <td>8</td>
      <td>2170</td>
      <td>1270</td>
      <td>2012</td>
      <td>0</td>
      <td>98155</td>
      <td>47.7364</td>
      <td>-122.286</td>
      <td>3170</td>
      <td>11810</td>
    </tr>
    <tr>
      <th>21602</th>
      <td>3</td>
      <td>1.75</td>
      <td>1500</td>
      <td>11968</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>6</td>
      <td>1500</td>
      <td>0</td>
      <td>2014</td>
      <td>0</td>
      <td>98010</td>
      <td>47.3095</td>
      <td>-122.002</td>
      <td>1320</td>
      <td>11303</td>
    </tr>
    <tr>
      <th>17730</th>
      <td>2</td>
      <td>1.00</td>
      <td>1640</td>
      <td>5200</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>7</td>
      <td>1040</td>
      <td>600</td>
      <td>1937</td>
      <td>0</td>
      <td>98199</td>
      <td>47.6426</td>
      <td>-122.403</td>
      <td>1780</td>
      <td>5040</td>
    </tr>
    <tr>
      <th>15725</th>
      <td>3</td>
      <td>3.00</td>
      <td>1560</td>
      <td>1466</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>8</td>
      <td>1560</td>
      <td>0</td>
      <td>2006</td>
      <td>0</td>
      <td>98103</td>
      <td>47.6604</td>
      <td>-122.352</td>
      <td>1530</td>
      <td>2975</td>
    </tr>
    <tr>
      <th>19966</th>
      <td>4</td>
      <td>2.50</td>
      <td>2300</td>
      <td>3825</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>7</td>
      <td>2300</td>
      <td>0</td>
      <td>2012</td>
      <td>0</td>
      <td>98042</td>
      <td>47.3594</td>
      <td>-122.082</td>
      <td>2110</td>
      <td>3825</td>
    </tr>
  </tbody>
</table>
<p>17290 rows × 18 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">house_X_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(17290, 18)
</pre></div>
</div>
</div>
</div>
<p>Notice a problem?!</p>
<p>We can only visualize data when the dimensions &lt;= 3.</p>
<p>BUT, in ML, we usually deal with high-dimensional problems where examples are hard to visualize.</p>
<ul class="simple">
<li><p>Dimensions≈20: Low dimensional</p></li>
<li><p>Dimensions≈1000: Medium dimensional</p></li>
<li><p>Dimensions≈100,000: High dimensional</p></li>
</ul>
<div class="section" id="feature-vectors">
<h3><span class="section-number">3.7.1. </span>Feature Vectors<a class="headerlink" href="#feature-vectors" title="Permalink to this headline">¶</a></h3>
<p><strong>Feature vector</strong>: a vector composed of feature values associated with an example.</p>
<p>An example feature vector from the cities dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-76.48,  44.23])
</pre></div>
</div>
</div>
</div>
<p>An example feature vector from the housing dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">house_X_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 3.0000e+00,  2.7500e+00,  2.1700e+03,  2.7380e+03,  1.5000e+00,
        0.0000e+00,  0.0000e+00,  4.0000e+00,  9.0000e+00,  1.5500e+03,
        6.2000e+02,  1.9300e+03,  0.0000e+00,  9.8109e+04,  4.7640e+01,
       -1.2235e+02,  1.1700e+03,  1.0620e+03])
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="distance">
<h2><span class="section-number">3.8. </span>Distance<a class="headerlink" href="#distance" title="Permalink to this headline">¶</a></h2>
<p>We have our feature vectors, one for each observation, but how we calculate the similarity between these feature vectors?</p>
<p>One way to calculate the similarity between two points in high-dimensional space is by calculating the distance between them.</p>
<p>So, if the distance is higher, that means that the points are less similar and when the distance is smaller, that means that the points are more similar.</p>
<div class="section" id="euclidean-distance">
<h3><span class="section-number">3.8.1. </span>Euclidean distance<a class="headerlink" href="#euclidean-distance" title="Permalink to this headline">¶</a></h3>
<p>There are different ways to calculate distance but we are going to focus on Euclidean distance.</p>
<p><strong>Euclidean distance:</strong> Euclidean distance is a measure of the true straight line distance between two points in Euclidean space. (<a class="reference external" href="https://hlab.stanford.edu/brian/euclidean_distance_in.html">source</a>)</p>
<p>The Euclidean distance between vectors</p>
<p><span class="math notranslate nohighlight">\(u = &lt;u_1, u_2, \dots, u_n&gt;\)</span> and</p>
<p><span class="math notranslate nohighlight">\(v = &lt;v_1, v_2, \dots, v_n&gt;\)</span> is defined as:</p>
<br>
<p><span class="math notranslate nohighlight">\(distance(u, v) = \sqrt{\sum_{i =1}^{n} (u_i - v_i)^2}\)</span></p>
<p>Because that equation can look a bit intimidating, let’s use it in an example, particularly our Canadian/US cities data.</p>
<div class="section" id="calculating-euclidean-distance-by-hand">
<h4><span class="section-number">3.8.1.1. </span>Calculating Euclidean distance “by hand”<a class="headerlink" href="#calculating-euclidean-distance-by-hand" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>160</th>
      <td>-76.4813</td>
      <td>44.2307</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>127</th>
      <td>-81.2496</td>
      <td>42.9837</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>169</th>
      <td>-66.0580</td>
      <td>45.2788</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>188</th>
      <td>-73.2533</td>
      <td>45.3057</td>
      <td>Canada</td>
    </tr>
    <tr>
      <th>187</th>
      <td>-67.9245</td>
      <td>47.1652</td>
      <td>Canada</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And here is our 2-dimensional space with the observations as points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_viz</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-80fa34aa22e14d8ea3e8fac82888f3c1"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-80fa34aa22e14d8ea3e8fac82888f3c1") {
      outputDiv = document.getElementById("altair-viz-80fa34aa22e14d8ea3e8fac82888f3c1");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-2c4b8116a5ba02671a69ae33b802cc1c"}, "mark": {"type": "circle", "opacity": 0.6, "size": 20}, "encoding": {"color": {"type": "nominal", "field": "country", "scale": {"domain": ["Canada", "USA"], "range": ["red", "blue"]}}, "x": {"type": "quantitative", "field": "longitude", "scale": {"domain": [-140, -40]}}, "y": {"type": "quantitative", "field": "latitude", "scale": {"domain": [20, 60]}}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-2c4b8116a5ba02671a69ae33b802cc1c": [{"longitude": -76.4813, "latitude": 44.2307, "country": "Canada"}, {"longitude": -81.2496, "latitude": 42.9837, "country": "Canada"}, {"longitude": -66.058, "latitude": 45.2788, "country": "Canada"}, {"longitude": -73.2533, "latitude": 45.3057, "country": "Canada"}, {"longitude": -67.9245, "latitude": 47.1652, "country": "Canada"}, {"longitude": -120.3394, "latitude": 50.6758, "country": "Canada"}, {"longitude": -106.65100000000001, "latitude": 35.0841, "country": "USA"}, {"longitude": -79.6902, "latitude": 44.3893, "country": "Canada"}, {"longitude": -84.3201, "latitude": 46.5239, "country": "Canada"}, {"longitude": -98.4951, "latitude": 29.4246, "country": "USA"}, {"longitude": -77.0366, "latitude": 38.895, "country": "USA"}, {"longitude": -93.3968, "latitude": 48.6114, "country": "Canada"}, {"longitude": -67.2799, "latitude": 45.2004, "country": "Canada"}, {"longitude": -122.8565, "latitude": 49.3144, "country": "Canada"}, {"longitude": -63.571999999999996, "latitude": 44.68, "country": "Canada"}, {"longitude": -68.3219, "latitude": 47.3556, "country": "USA"}, {"longitude": -97.1385, "latitude": 49.8955, "country": "Canada"}, {"longitude": -122.3295, "latitude": 49.0521, "country": "Canada"}, {"longitude": -87.6244, "latitude": 41.8756, "country": "USA"}, {"longitude": -68.5897, "latitude": 47.2587, "country": "USA"}, {"longitude": -73.4467, "latitude": 45.5172, "country": "Canada"}, {"longitude": -63.5859, "latitude": 44.6486, "country": "Canada"}, {"longitude": -97.7437, "latitude": 30.2711, "country": "USA"}, {"longitude": -79.0247, "latitude": 43.8504, "country": "Canada"}, {"longitude": -111.9639, "latitude": 49.0017, "country": "Canada"}, {"longitude": -129.9912, "latitude": 55.9383, "country": "Canada"}, {"longitude": -78.9186, "latitude": 42.9131, "country": "Canada"}, {"longitude": -71.7985, "latitude": 45.0126, "country": "Canada"}, {"longitude": -95.9929, "latitude": 36.1557, "country": "USA"}, {"longitude": -123.0833, "latitude": 49.0167, "country": "Canada"}, {"longitude": -94.5648, "latitude": 48.7227, "country": "Canada"}, {"longitude": -118.7148, "latitude": 50.4165, "country": "Canada"}, {"longitude": -97.2049, "latitude": 48.9988, "country": "USA"}, {"longitude": -122.7933, "latitude": 49.2843, "country": "Canada"}, {"longitude": -97.1056, "latitude": 32.7019, "country": "USA"}, {"longitude": -72.5565, "latitude": 46.3327, "country": "Canada"}, {"longitude": -75.1635, "latitude": 39.9527, "country": "USA"}, {"longitude": -110.9748, "latitude": 32.2229, "country": "USA"}, {"longitude": -67.2781, "latitude": 45.18899999999999, "country": "USA"}, {"longitude": -83.0466, "latitude": 42.3316, "country": "USA"}, {"longitude": -79.7599, "latitude": 43.6858, "country": "Canada"}, {"longitude": -84.3201, "latitude": 46.5239, "country": "Canada"}, {"longitude": -106.6608, "latitude": 52.1318, "country": "Canada"}, {"longitude": -83.0007, "latitude": 39.9623, "country": "USA"}, {"longitude": -75.7106, "latitude": 45.4284, "country": "Canada"}, {"longitude": -52.7151, "latitude": 47.5617, "country": "Canada"}, {"longitude": -113.508, "latitude": 53.5354, "country": "Canada"}, {"longitude": -76.6108, "latitude": 39.2909, "country": "USA"}, {"longitude": -97.5533, "latitude": 48.7531, "country": "USA"}, {"longitude": -66.9843, "latitude": 44.8607, "country": "USA"}, {"longitude": -113.8184, "latitude": 52.2698, "country": "Canada"}, {"longitude": -113.2966, "latitude": 53.5257, "country": "Canada"}, {"longitude": -79.4394, "latitude": 43.8801, "country": "Canada"}, {"longitude": -66.9905, "latitude": 44.9065, "country": "USA"}, {"longitude": -112.0741, "latitude": 33.4484, "country": "USA"}, {"longitude": -130.0437, "latitude": 55.9773, "country": "USA"}, {"longitude": -75.7887, "latitude": 45.3113, "country": "Canada"}, {"longitude": -80.8431, "latitude": 35.2272, "country": "USA"}, {"longitude": -79.6667, "latitude": 43.4474, "country": "Canada"}, {"longitude": -121.8906, "latitude": 37.3362, "country": "USA"}, {"longitude": -85.7039, "latitude": 38.2092, "country": "USA"}, {"longitude": -73.6515, "latitude": 45.7081, "country": "Canada"}, {"longitude": -122.4199, "latitude": 37.779, "country": "USA"}, {"longitude": -79.4109, "latitude": 43.7615, "country": "Canada"}, {"longitude": -67.9245, "latitude": 47.1652, "country": "Canada"}, {"longitude": -111.9626, "latitude": 48.9971, "country": "USA"}, {"longitude": -79.0359, "latitude": 43.1726, "country": "USA"}, {"longitude": -73.6875, "latitude": 45.5089, "country": "Canada"}, {"longitude": -111.8315, "latitude": 33.4151, "country": "USA"}, {"longitude": -114.0626, "latitude": 51.0534, "country": "Canada"}, {"longitude": -73.6289, "latitude": 45.468, "country": "Canada"}, {"longitude": -75.9774, "latitude": 36.853, "country": "USA"}, {"longitude": -79.3839, "latitude": 43.6535, "country": "Canada"}, {"longitude": -87.9225, "latitude": 43.035, "country": "USA"}, {"longitude": -72.7218, "latitude": 45.398999999999994, "country": "Canada"}, {"longitude": -117.1628, "latitude": 32.7174, "country": "USA"}, {"longitude": -67.4297, "latitude": 45.5634, "country": "USA"}, {"longitude": -83.0466, "latitude": 42.3316, "country": "USA"}, {"longitude": -123.1374, "latitude": 49.1632, "country": "Canada"}, {"longitude": -119.4983, "latitude": 49.8893, "country": "Canada"}, {"longitude": -79.8729, "latitude": 43.2561, "country": "Canada"}, {"longitude": -122.5997, "latitude": 49.2197, "country": "Canada"}, {"longitude": -80.2632, "latitude": 43.1408, "country": "Canada"}, {"longitude": -79.2441, "latitude": 43.158, "country": "Canada"}, {"longitude": -97.2089, "latitude": 49.0061, "country": "Canada"}, {"longitude": -94.6002, "latitude": 48.7124, "country": "USA"}, {"longitude": -102.5496, "latitude": 48.9959, "country": "USA"}, {"longitude": -83.0353, "latitude": 42.3171, "country": "Canada"}, {"longitude": -71.889, "latitude": 45.4033, "country": "Canada"}, {"longitude": -66.6458, "latitude": 45.9664, "country": "Canada"}, {"longitude": -71.0692, "latitude": 48.406000000000006, "country": "Canada"}, {"longitude": -84.3902, "latitude": 33.7491, "country": "USA"}, {"longitude": -122.7436, "latitude": 48.9881, "country": "USA"}, {"longitude": -102.54799999999999, "latitude": 49.0014, "country": "Canada"}, {"longitude": -104.6173, "latitude": 50.4488, "country": "Canada"}, {"longitude": -122.3301, "latitude": 47.6038, "country": "USA"}, {"longitude": -123.11399999999999, "latitude": 49.2609, "country": "Canada"}, {"longitude": -71.0583, "latitude": 42.3603, "country": "USA"}, {"longitude": -134.4197, "latitude": 58.3019, "country": "USA"}, {"longitude": -75.4864, "latitude": 44.6943, "country": "USA"}, {"longitude": -82.4405, "latitude": 42.9816, "country": "USA"}, {"longitude": -71.3998, "latitude": 46.8884, "country": "Canada"}, {"longitude": -122.6742, "latitude": 45.5202, "country": "USA"}, {"longitude": -67.9353, "latitude": 47.1575, "country": "USA"}, {"longitude": -69.265, "latitude": 47.5052, "country": "Canada"}, {"longitude": -97.3327, "latitude": 32.7532, "country": "USA"}, {"longitude": -123.365, "latitude": 48.4283, "country": "Canada"}, {"longitude": -68.3281, "latitude": 47.3644, "country": "Canada"}, {"longitude": -78.8784, "latitude": 42.8867, "country": "USA"}, {"longitude": -79.5268, "latitude": 43.7942, "country": "Canada"}, {"longitude": -79.6457, "latitude": 43.5903, "country": "Canada"}, {"longitude": -79.4608, "latitude": 46.3092, "country": "Canada"}, {"longitude": -95.9384, "latitude": 41.2587, "country": "USA"}, {"longitude": -79.0615, "latitude": 43.0844, "country": "USA"}, {"longitude": -79.7967, "latitude": 43.3249, "country": "Canada"}, {"longitude": -69.2275, "latitude": 47.4562, "country": "USA"}, {"longitude": -123.0833, "latitude": 49.0833, "country": "Canada"}, {"longitude": -90.0516, "latitude": 35.149, "country": "USA"}, {"longitude": -122.2714, "latitude": 37.8045, "country": "USA"}, {"longitude": -119.7848, "latitude": 36.7394, "country": "USA"}, {"longitude": -104.8253, "latitude": 38.834, "country": "USA"}, {"longitude": -74.0132, "latitude": 45.7754, "country": "Canada"}, {"longitude": -79.3377, "latitude": 43.8564, "country": "Canada"}, {"longitude": -93.2655, "latitude": 44.9773, "country": "USA"}, {"longitude": -95.3677, "latitude": 29.7589, "country": "USA"}, {"longitude": -80.3123, "latitude": 43.3601, "country": "Canada"}, {"longitude": -79.1153, "latitude": 43.101000000000006, "country": "Canada"}, {"longitude": -79.7599, "latitude": 43.6858, "country": "Canada"}, {"longitude": -75.5192, "latitude": 44.7184, "country": "Canada"}, {"longitude": -68.6034, "latitude": 47.2527, "country": "Canada"}, {"longitude": -83.0353, "latitude": 42.3171, "country": "Canada"}, {"longitude": -73.7344, "latitude": 45.6056, "country": "Canada"}, {"longitude": -72.0968, "latitude": 45.0072, "country": "Canada"}, {"longitude": -67.5735, "latitude": 46.1503, "country": "Canada"}, {"longitude": -80.4944, "latitude": 43.4532, "country": "Canada"}, {"longitude": -79.1153, "latitude": 43.101000000000006, "country": "Canada"}, {"longitude": -110.679, "latitude": 50.043, "country": "Canada"}, {"longitude": -78.3199, "latitude": 44.3048, "country": "Canada"}, {"longitude": -79.2506, "latitude": 42.9931, "country": "Canada"}, {"longitude": -96.7969, "latitude": 32.7763, "country": "USA"}, {"longitude": -122.3295, "latitude": 49.0521, "country": "Canada"}, {"longitude": -123.07799999999999, "latitude": 48.9854, "country": "USA"}, {"longitude": -97.5171, "latitude": 35.473, "country": "USA"}, {"longitude": -104.9849, "latitude": 39.7392, "country": "USA"}, {"longitude": -94.5781, "latitude": 39.1001, "country": "USA"}, {"longitude": -122.9109, "latitude": 49.2068, "country": "Canada"}, {"longitude": -89.2598, "latitude": 48.4064, "country": "Canada"}, {"longitude": -82.4584, "latitude": 27.9478, "country": "USA"}, {"longitude": -71.1473, "latitude": 48.382, "country": "Canada"}, {"longitude": -71.1753, "latitude": 46.791000000000004, "country": "Canada"}, {"longitude": -73.6104, "latitude": 45.4972, "country": "Canada"}, {"longitude": -79.8828, "latitude": 43.5137, "country": "Canada"}, {"longitude": -118.2428, "latitude": 34.0537, "country": "USA"}, {"longitude": -118.1916, "latitude": 33.769, "country": "USA"}, {"longitude": -86.1584, "latitude": 39.7683, "country": "USA"}, {"longitude": -72.9406, "latitude": 45.6275, "country": "Canada"}, {"longitude": -75.6903, "latitude": 45.4211, "country": "Canada"}, {"longitude": -76.3019, "latitude": 44.211000000000006, "country": "Canada"}, {"longitude": -115.1485, "latitude": 36.1673, "country": "USA"}, {"longitude": -122.8491, "latitude": 49.1913, "country": "Canada"}, {"longitude": -67.4253, "latitude": 45.5672, "country": "Canada"}, {"longitude": -122.8491, "latitude": 49.1913, "country": "Canada"}, {"longitude": -76.3305, "latitude": 44.1255, "country": "USA"}, {"longitude": -74.7287, "latitude": 45.0184, "country": "Canada"}, {"longitude": -121.4944, "latitude": 38.5816, "country": "USA"}, {"longitude": -79.5656, "latitude": 43.6436, "country": "Canada"}, {"longitude": -66.9195, "latitude": 44.8938, "country": "Canada"}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Let’s take 2 points (two feature vectors) from the cities dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">two_cities</span> <span class="o">=</span> <span class="n">cities_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span>
<span class="n">two_cities</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>30</th>
      <td>-66.9843</td>
      <td>44.8607</td>
    </tr>
    <tr>
      <th>171</th>
      <td>-80.2632</td>
      <td>43.1408</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The two sampled points are shown as black circles.</p>
<p>Our goal is to find how similar these two points are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_viz</span> <span class="o">+</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">two_cities</span><span class="p">)</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-66b63214559641d8997c9a7f1670dd44"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-66b63214559641d8997c9a7f1670dd44") {
      outputDiv = document.getElementById("altair-viz-66b63214559641d8997c9a7f1670dd44");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"data": {"name": "data-2c4b8116a5ba02671a69ae33b802cc1c"}, "mark": {"type": "circle", "opacity": 0.6, "size": 20}, "encoding": {"color": {"type": "nominal", "field": "country", "scale": {"domain": ["Canada", "USA"], "range": ["red", "blue"]}}, "x": {"type": "quantitative", "field": "longitude", "scale": {"domain": [-140, -40]}}, "y": {"type": "quantitative", "field": "latitude", "scale": {"domain": [20, 60]}}}}, {"data": {"name": "data-7c144ccbe61beb3e29b101c8ca59a046"}, "mark": {"type": "circle", "color": "black", "size": 130}, "encoding": {"x": {"type": "quantitative", "field": "longitude"}, "y": {"type": "quantitative", "field": "latitude"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-2c4b8116a5ba02671a69ae33b802cc1c": [{"longitude": -76.4813, "latitude": 44.2307, "country": "Canada"}, {"longitude": -81.2496, "latitude": 42.9837, "country": "Canada"}, {"longitude": -66.058, "latitude": 45.2788, "country": "Canada"}, {"longitude": -73.2533, "latitude": 45.3057, "country": "Canada"}, {"longitude": -67.9245, "latitude": 47.1652, "country": "Canada"}, {"longitude": -120.3394, "latitude": 50.6758, "country": "Canada"}, {"longitude": -106.65100000000001, "latitude": 35.0841, "country": "USA"}, {"longitude": -79.6902, "latitude": 44.3893, "country": "Canada"}, {"longitude": -84.3201, "latitude": 46.5239, "country": "Canada"}, {"longitude": -98.4951, "latitude": 29.4246, "country": "USA"}, {"longitude": -77.0366, "latitude": 38.895, "country": "USA"}, {"longitude": -93.3968, "latitude": 48.6114, "country": "Canada"}, {"longitude": -67.2799, "latitude": 45.2004, "country": "Canada"}, {"longitude": -122.8565, "latitude": 49.3144, "country": "Canada"}, {"longitude": -63.571999999999996, "latitude": 44.68, "country": "Canada"}, {"longitude": -68.3219, "latitude": 47.3556, "country": "USA"}, {"longitude": -97.1385, "latitude": 49.8955, "country": "Canada"}, {"longitude": -122.3295, "latitude": 49.0521, "country": "Canada"}, {"longitude": -87.6244, "latitude": 41.8756, "country": "USA"}, {"longitude": -68.5897, "latitude": 47.2587, "country": "USA"}, {"longitude": -73.4467, "latitude": 45.5172, "country": "Canada"}, {"longitude": -63.5859, "latitude": 44.6486, "country": "Canada"}, {"longitude": -97.7437, "latitude": 30.2711, "country": "USA"}, {"longitude": -79.0247, "latitude": 43.8504, "country": "Canada"}, {"longitude": -111.9639, "latitude": 49.0017, "country": "Canada"}, {"longitude": -129.9912, "latitude": 55.9383, "country": "Canada"}, {"longitude": -78.9186, "latitude": 42.9131, "country": "Canada"}, {"longitude": -71.7985, "latitude": 45.0126, "country": "Canada"}, {"longitude": -95.9929, "latitude": 36.1557, "country": "USA"}, {"longitude": -123.0833, "latitude": 49.0167, "country": "Canada"}, {"longitude": -94.5648, "latitude": 48.7227, "country": "Canada"}, {"longitude": -118.7148, "latitude": 50.4165, "country": "Canada"}, {"longitude": -97.2049, "latitude": 48.9988, "country": "USA"}, {"longitude": -122.7933, "latitude": 49.2843, "country": "Canada"}, {"longitude": -97.1056, "latitude": 32.7019, "country": "USA"}, {"longitude": -72.5565, "latitude": 46.3327, "country": "Canada"}, {"longitude": -75.1635, "latitude": 39.9527, "country": "USA"}, {"longitude": -110.9748, "latitude": 32.2229, "country": "USA"}, {"longitude": -67.2781, "latitude": 45.18899999999999, "country": "USA"}, {"longitude": -83.0466, "latitude": 42.3316, "country": "USA"}, {"longitude": -79.7599, "latitude": 43.6858, "country": "Canada"}, {"longitude": -84.3201, "latitude": 46.5239, "country": "Canada"}, {"longitude": -106.6608, "latitude": 52.1318, "country": "Canada"}, {"longitude": -83.0007, "latitude": 39.9623, "country": "USA"}, {"longitude": -75.7106, "latitude": 45.4284, "country": "Canada"}, {"longitude": -52.7151, "latitude": 47.5617, "country": "Canada"}, {"longitude": -113.508, "latitude": 53.5354, "country": "Canada"}, {"longitude": -76.6108, "latitude": 39.2909, "country": "USA"}, {"longitude": -97.5533, "latitude": 48.7531, "country": "USA"}, {"longitude": -66.9843, "latitude": 44.8607, "country": "USA"}, {"longitude": -113.8184, "latitude": 52.2698, "country": "Canada"}, {"longitude": -113.2966, "latitude": 53.5257, "country": "Canada"}, {"longitude": -79.4394, "latitude": 43.8801, "country": "Canada"}, {"longitude": -66.9905, "latitude": 44.9065, "country": "USA"}, {"longitude": -112.0741, "latitude": 33.4484, "country": "USA"}, {"longitude": -130.0437, "latitude": 55.9773, "country": "USA"}, {"longitude": -75.7887, "latitude": 45.3113, "country": "Canada"}, {"longitude": -80.8431, "latitude": 35.2272, "country": "USA"}, {"longitude": -79.6667, "latitude": 43.4474, "country": "Canada"}, {"longitude": -121.8906, "latitude": 37.3362, "country": "USA"}, {"longitude": -85.7039, "latitude": 38.2092, "country": "USA"}, {"longitude": -73.6515, "latitude": 45.7081, "country": "Canada"}, {"longitude": -122.4199, "latitude": 37.779, "country": "USA"}, {"longitude": -79.4109, "latitude": 43.7615, "country": "Canada"}, {"longitude": -67.9245, "latitude": 47.1652, "country": "Canada"}, {"longitude": -111.9626, "latitude": 48.9971, "country": "USA"}, {"longitude": -79.0359, "latitude": 43.1726, "country": "USA"}, {"longitude": -73.6875, "latitude": 45.5089, "country": "Canada"}, {"longitude": -111.8315, "latitude": 33.4151, "country": "USA"}, {"longitude": -114.0626, "latitude": 51.0534, "country": "Canada"}, {"longitude": -73.6289, "latitude": 45.468, "country": "Canada"}, {"longitude": -75.9774, "latitude": 36.853, "country": "USA"}, {"longitude": -79.3839, "latitude": 43.6535, "country": "Canada"}, {"longitude": -87.9225, "latitude": 43.035, "country": "USA"}, {"longitude": -72.7218, "latitude": 45.398999999999994, "country": "Canada"}, {"longitude": -117.1628, "latitude": 32.7174, "country": "USA"}, {"longitude": -67.4297, "latitude": 45.5634, "country": "USA"}, {"longitude": -83.0466, "latitude": 42.3316, "country": "USA"}, {"longitude": -123.1374, "latitude": 49.1632, "country": "Canada"}, {"longitude": -119.4983, "latitude": 49.8893, "country": "Canada"}, {"longitude": -79.8729, "latitude": 43.2561, "country": "Canada"}, {"longitude": -122.5997, "latitude": 49.2197, "country": "Canada"}, {"longitude": -80.2632, "latitude": 43.1408, "country": "Canada"}, {"longitude": -79.2441, "latitude": 43.158, "country": "Canada"}, {"longitude": -97.2089, "latitude": 49.0061, "country": "Canada"}, {"longitude": -94.6002, "latitude": 48.7124, "country": "USA"}, {"longitude": -102.5496, "latitude": 48.9959, "country": "USA"}, {"longitude": -83.0353, "latitude": 42.3171, "country": "Canada"}, {"longitude": -71.889, "latitude": 45.4033, "country": "Canada"}, {"longitude": -66.6458, "latitude": 45.9664, "country": "Canada"}, {"longitude": -71.0692, "latitude": 48.406000000000006, "country": "Canada"}, {"longitude": -84.3902, "latitude": 33.7491, "country": "USA"}, {"longitude": -122.7436, "latitude": 48.9881, "country": "USA"}, {"longitude": -102.54799999999999, "latitude": 49.0014, "country": "Canada"}, {"longitude": -104.6173, "latitude": 50.4488, "country": "Canada"}, {"longitude": -122.3301, "latitude": 47.6038, "country": "USA"}, {"longitude": -123.11399999999999, "latitude": 49.2609, "country": "Canada"}, {"longitude": -71.0583, "latitude": 42.3603, "country": "USA"}, {"longitude": -134.4197, "latitude": 58.3019, "country": "USA"}, {"longitude": -75.4864, "latitude": 44.6943, "country": "USA"}, {"longitude": -82.4405, "latitude": 42.9816, "country": "USA"}, {"longitude": -71.3998, "latitude": 46.8884, "country": "Canada"}, {"longitude": -122.6742, "latitude": 45.5202, "country": "USA"}, {"longitude": -67.9353, "latitude": 47.1575, "country": "USA"}, {"longitude": -69.265, "latitude": 47.5052, "country": "Canada"}, {"longitude": -97.3327, "latitude": 32.7532, "country": "USA"}, {"longitude": -123.365, "latitude": 48.4283, "country": "Canada"}, {"longitude": -68.3281, "latitude": 47.3644, "country": "Canada"}, {"longitude": -78.8784, "latitude": 42.8867, "country": "USA"}, {"longitude": -79.5268, "latitude": 43.7942, "country": "Canada"}, {"longitude": -79.6457, "latitude": 43.5903, "country": "Canada"}, {"longitude": -79.4608, "latitude": 46.3092, "country": "Canada"}, {"longitude": -95.9384, "latitude": 41.2587, "country": "USA"}, {"longitude": -79.0615, "latitude": 43.0844, "country": "USA"}, {"longitude": -79.7967, "latitude": 43.3249, "country": "Canada"}, {"longitude": -69.2275, "latitude": 47.4562, "country": "USA"}, {"longitude": -123.0833, "latitude": 49.0833, "country": "Canada"}, {"longitude": -90.0516, "latitude": 35.149, "country": "USA"}, {"longitude": -122.2714, "latitude": 37.8045, "country": "USA"}, {"longitude": -119.7848, "latitude": 36.7394, "country": "USA"}, {"longitude": -104.8253, "latitude": 38.834, "country": "USA"}, {"longitude": -74.0132, "latitude": 45.7754, "country": "Canada"}, {"longitude": -79.3377, "latitude": 43.8564, "country": "Canada"}, {"longitude": -93.2655, "latitude": 44.9773, "country": "USA"}, {"longitude": -95.3677, "latitude": 29.7589, "country": "USA"}, {"longitude": -80.3123, "latitude": 43.3601, "country": "Canada"}, {"longitude": -79.1153, "latitude": 43.101000000000006, "country": "Canada"}, {"longitude": -79.7599, "latitude": 43.6858, "country": "Canada"}, {"longitude": -75.5192, "latitude": 44.7184, "country": "Canada"}, {"longitude": -68.6034, "latitude": 47.2527, "country": "Canada"}, {"longitude": -83.0353, "latitude": 42.3171, "country": "Canada"}, {"longitude": -73.7344, "latitude": 45.6056, "country": "Canada"}, {"longitude": -72.0968, "latitude": 45.0072, "country": "Canada"}, {"longitude": -67.5735, "latitude": 46.1503, "country": "Canada"}, {"longitude": -80.4944, "latitude": 43.4532, "country": "Canada"}, {"longitude": -79.1153, "latitude": 43.101000000000006, "country": "Canada"}, {"longitude": -110.679, "latitude": 50.043, "country": "Canada"}, {"longitude": -78.3199, "latitude": 44.3048, "country": "Canada"}, {"longitude": -79.2506, "latitude": 42.9931, "country": "Canada"}, {"longitude": -96.7969, "latitude": 32.7763, "country": "USA"}, {"longitude": -122.3295, "latitude": 49.0521, "country": "Canada"}, {"longitude": -123.07799999999999, "latitude": 48.9854, "country": "USA"}, {"longitude": -97.5171, "latitude": 35.473, "country": "USA"}, {"longitude": -104.9849, "latitude": 39.7392, "country": "USA"}, {"longitude": -94.5781, "latitude": 39.1001, "country": "USA"}, {"longitude": -122.9109, "latitude": 49.2068, "country": "Canada"}, {"longitude": -89.2598, "latitude": 48.4064, "country": "Canada"}, {"longitude": -82.4584, "latitude": 27.9478, "country": "USA"}, {"longitude": -71.1473, "latitude": 48.382, "country": "Canada"}, {"longitude": -71.1753, "latitude": 46.791000000000004, "country": "Canada"}, {"longitude": -73.6104, "latitude": 45.4972, "country": "Canada"}, {"longitude": -79.8828, "latitude": 43.5137, "country": "Canada"}, {"longitude": -118.2428, "latitude": 34.0537, "country": "USA"}, {"longitude": -118.1916, "latitude": 33.769, "country": "USA"}, {"longitude": -86.1584, "latitude": 39.7683, "country": "USA"}, {"longitude": -72.9406, "latitude": 45.6275, "country": "Canada"}, {"longitude": -75.6903, "latitude": 45.4211, "country": "Canada"}, {"longitude": -76.3019, "latitude": 44.211000000000006, "country": "Canada"}, {"longitude": -115.1485, "latitude": 36.1673, "country": "USA"}, {"longitude": -122.8491, "latitude": 49.1913, "country": "Canada"}, {"longitude": -67.4253, "latitude": 45.5672, "country": "Canada"}, {"longitude": -122.8491, "latitude": 49.1913, "country": "Canada"}, {"longitude": -76.3305, "latitude": 44.1255, "country": "USA"}, {"longitude": -74.7287, "latitude": 45.0184, "country": "Canada"}, {"longitude": -121.4944, "latitude": 38.5816, "country": "USA"}, {"longitude": -79.5656, "latitude": 43.6436, "country": "Canada"}, {"longitude": -66.9195, "latitude": 44.8938, "country": "Canada"}], "data-7c144ccbe61beb3e29b101c8ca59a046": [{"longitude": -66.9843, "latitude": 44.8607}, {"longitude": -80.2632, "latitude": 43.1408}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>First, we subtract these two cities. We are subtracting the city at index 0 from the city at index 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">two_cities</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">two_cities</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>longitude   -13.2789
latitude     -1.7199
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Next, we square the differences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">two_cities</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">two_cities</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>longitude    176.329185
latitude       2.958056
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Then we sum up the squared differences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">two_cities</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">two_cities</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>179.28724121999983
</pre></div>
</div>
</div>
</div>
<p>And then take the square root of the value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">two_cities</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">two_cities</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13.389818565611703
</pre></div>
</div>
</div>
</div>
<p>We end with a value of 13.3898 which is the distance between the two cities.</p>
</div>
<div class="section" id="calculating-euclidean-distance-with-sklearn">
<h4><span class="section-number">3.8.1.2. </span>Calculating Euclidean distance  with <code class="docutils literal notranslate"><span class="pre">sklearn</span></code><a class="headerlink" href="#calculating-euclidean-distance-with-sklearn" title="Permalink to this headline">¶</a></h4>
<p>That’s more work than we really have time for and since <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> knows we are very busy people, they have a function that does this for us.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Euclidean distance using sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">euclidean_distances</span>
<span class="n">euclidean_distances</span><span class="p">(</span><span class="n">two_cities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0.        , 13.38981857],
       [13.38981857,  0.        ]])
</pre></div>
</div>
</div>
</div>
<p>When we call this function on our two cities data, it outputs this matrix with four values.</p>
<ul class="simple">
<li><p>Our first value is the distance between city 0 and itself.</p></li>
<li><p>Our second value is the distance between city 0 and city1.</p></li>
<li><p>Our third value is the distance between city 1and city 0.</p></li>
<li><p>Our fourth value is the distance between city 1 and itself.</p></li>
</ul>
<p>As we can see, the distances are symmetric. If we calculate the distance between city 0 and city1, it’s going to have the same value as if we calculated the distance between city 1 and city 0.</p>
<p>This isn’t always the case if we use a different metric to calculate distances.</p>
</div>
</div>
</div>
<div class="section" id="finding-the-nearest-neighbour">
<h2><span class="section-number">3.9. </span>Finding the Nearest Neighbour<a class="headerlink" href="#finding-the-nearest-neighbour" title="Permalink to this headline">¶</a></h2>
<p>Now that we know how to calculate the distance between two points, we are ready to find the most similar examples.</p>
<p>Let’s find the closest cities to City 0 from our <code class="docutils literal notranslate"><span class="pre">cities_train_df</span></code> dataframe.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">euclidean_distances</span></code> on the entire dataset will calculate the distances from all the cities to all other cities in our dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">cities_train_df</span><span class="p">[[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">]])</span>
<span class="n">dists</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 0.        ,  4.92866046, 10.47586257, ..., 45.36619339,
         3.13968038,  9.58476504],
       [ 4.92866046,  0.        , 15.36399019, ..., 40.48484175,
         1.80868018, 14.45684087],
       [10.47586257, 15.36399019,  0.        , ..., 55.83947468,
        13.60621684,  0.94361393],
       ...,
       [45.36619339, 40.48484175, 55.83947468, ...,  0.        ,
        42.23325838, 54.93872568],
       [ 3.13968038,  1.80868018, 13.60621684, ..., 42.23325838,
         0.        , 12.70774745],
       [ 9.58476504, 14.45684087,  0.94361393, ..., 54.93872568,
        12.70774745,  0.        ]])
</pre></div>
</div>
</div>
</div>
<p>This is going to be of shape 167 by 167 as this was the number of examples in our training portion.</p>
<p>Each row here gives us the distance of that particular city to all other cities in the training data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(167, 167)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>157</th>
      <th>158</th>
      <th>159</th>
      <th>160</th>
      <th>161</th>
      <th>162</th>
      <th>163</th>
      <th>164</th>
      <th>165</th>
      <th>166</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.000000</td>
      <td>4.928660</td>
      <td>10.475863</td>
      <td>3.402295</td>
      <td>9.046000</td>
      <td>44.329135</td>
      <td>31.525721</td>
      <td>3.212817</td>
      <td>8.167347</td>
      <td>26.529757</td>
      <td>...</td>
      <td>0.180478</td>
      <td>39.498997</td>
      <td>46.632397</td>
      <td>9.154090</td>
      <td>46.632397</td>
      <td>0.183869</td>
      <td>1.921478</td>
      <td>45.366193</td>
      <td>3.139680</td>
      <td>9.584765</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.928660</td>
      <td>0.000000</td>
      <td>15.363990</td>
      <td>8.326614</td>
      <td>13.965788</td>
      <td>39.839439</td>
      <td>26.601406</td>
      <td>2.099390</td>
      <td>4.686255</td>
      <td>21.937558</td>
      <td>...</td>
      <td>5.097647</td>
      <td>34.577431</td>
      <td>42.060108</td>
      <td>14.063632</td>
      <td>42.060108</td>
      <td>5.049876</td>
      <td>6.830969</td>
      <td>40.484842</td>
      <td>1.808680</td>
      <td>14.456841</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10.475863</td>
      <td>15.363990</td>
      <td>0.000000</td>
      <td>7.195350</td>
      <td>2.653738</td>
      <td>54.549042</td>
      <td>41.853597</td>
      <td>13.661189</td>
      <td>18.304496</td>
      <td>36.104309</td>
      <td>...</td>
      <td>10.299402</td>
      <td>49.928916</td>
      <td>56.925712</td>
      <td>1.397385</td>
      <td>56.925712</td>
      <td>10.337038</td>
      <td>8.674609</td>
      <td>55.839475</td>
      <td>13.606217</td>
      <td>0.943614</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.402295</td>
      <td>8.326614</td>
      <td>7.195350</td>
      <td>0.000000</td>
      <td>5.643921</td>
      <td>47.391337</td>
      <td>34.926888</td>
      <td>6.501805</td>
      <td>11.133646</td>
      <td>29.822103</td>
      <td>...</td>
      <td>3.239187</td>
      <td>42.880277</td>
      <td>49.747776</td>
      <td>5.833864</td>
      <td>49.747776</td>
      <td>3.295760</td>
      <td>1.503112</td>
      <td>48.707466</td>
      <td>6.527458</td>
      <td>6.347179</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9.046000</td>
      <td>13.965788</td>
      <td>2.653738</td>
      <td>5.643921</td>
      <td>0.000000</td>
      <td>52.532333</td>
      <td>40.567164</td>
      <td>12.088727</td>
      <td>16.408137</td>
      <td>35.345303</td>
      <td>...</td>
      <td>8.883025</td>
      <td>48.487730</td>
      <td>54.961957</td>
      <td>1.674158</td>
      <td>54.961957</td>
      <td>8.938714</td>
      <td>7.134836</td>
      <td>54.253225</td>
      <td>12.162108</td>
      <td>2.483804</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>162</th>
      <td>0.183869</td>
      <td>5.049876</td>
      <td>10.337038</td>
      <td>3.295760</td>
      <td>8.938714</td>
      <td>44.493704</td>
      <td>31.639843</td>
      <td>3.370041</td>
      <td>8.341824</td>
      <td>26.596728</td>
      <td>...</td>
      <td>0.090157</td>
      <td>39.625372</td>
      <td>46.793616</td>
      <td>9.021147</td>
      <td>46.793616</td>
      <td>0.000000</td>
      <td>1.833858</td>
      <td>45.502887</td>
      <td>3.270795</td>
      <td>9.442309</td>
    </tr>
    <tr>
      <th>163</th>
      <td>1.921478</td>
      <td>6.830969</td>
      <td>8.674609</td>
      <td>1.503112</td>
      <td>7.134836</td>
      <td>45.960223</td>
      <td>33.432373</td>
      <td>5.001225</td>
      <td>9.708835</td>
      <td>28.425488</td>
      <td>...</td>
      <td>1.768291</td>
      <td>41.377557</td>
      <td>48.300994</td>
      <td>7.323990</td>
      <td>48.300994</td>
      <td>1.833858</td>
      <td>0.000000</td>
      <td>47.206600</td>
      <td>5.028487</td>
      <td>7.810194</td>
    </tr>
    <tr>
      <th>164</th>
      <td>45.366193</td>
      <td>40.484842</td>
      <td>55.839475</td>
      <td>48.707466</td>
      <td>54.253225</td>
      <td>12.149226</td>
      <td>15.249886</td>
      <td>42.205693</td>
      <td>38.013270</td>
      <td>24.755170</td>
      <td>...</td>
      <td>45.541763</td>
      <td>6.789646</td>
      <td>10.695838</td>
      <td>54.518494</td>
      <td>10.695838</td>
      <td>45.502887</td>
      <td>47.206600</td>
      <td>0.000000</td>
      <td>42.233258</td>
      <td>54.938726</td>
    </tr>
    <tr>
      <th>165</th>
      <td>3.139680</td>
      <td>1.808680</td>
      <td>13.606217</td>
      <td>6.527458</td>
      <td>12.162108</td>
      <td>41.375773</td>
      <td>28.405702</td>
      <td>0.756038</td>
      <td>5.558903</td>
      <td>23.675006</td>
      <td>...</td>
      <td>3.312655</td>
      <td>36.359838</td>
      <td>43.637580</td>
      <td>12.291750</td>
      <td>43.637580</td>
      <td>3.270795</td>
      <td>5.028487</td>
      <td>42.233258</td>
      <td>0.000000</td>
      <td>12.707747</td>
    </tr>
    <tr>
      <th>166</th>
      <td>9.584765</td>
      <td>14.456841</td>
      <td>0.943614</td>
      <td>6.347179</td>
      <td>2.483804</td>
      <td>53.731902</td>
      <td>40.924593</td>
      <td>12.780661</td>
      <td>17.476788</td>
      <td>35.161267</td>
      <td>...</td>
      <td>9.407212</td>
      <td>49.012123</td>
      <td>56.094462</td>
      <td>0.842200</td>
      <td>56.094462</td>
      <td>9.442309</td>
      <td>7.810194</td>
      <td>54.938726</td>
      <td>12.707747</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>167 rows × 167 columns</p>
</div></div></div>
</div>
<p>The distance of each city to itself is going to be zero.</p>
<p>If we don’t replace 0 with infinity, each city’s most similar city is going to be itself which is not useful.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>157</th>
      <th>158</th>
      <th>159</th>
      <th>160</th>
      <th>161</th>
      <th>162</th>
      <th>163</th>
      <th>164</th>
      <th>165</th>
      <th>166</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>inf</td>
      <td>4.928660</td>
      <td>10.475863</td>
      <td>3.402295</td>
      <td>9.046000</td>
      <td>44.329135</td>
      <td>31.525721</td>
      <td>3.212817</td>
      <td>8.167347</td>
      <td>26.529757</td>
      <td>...</td>
      <td>0.180478</td>
      <td>39.498997</td>
      <td>46.632397</td>
      <td>9.154090</td>
      <td>46.632397</td>
      <td>0.183869</td>
      <td>1.921478</td>
      <td>45.366193</td>
      <td>3.139680</td>
      <td>9.584765</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.928660</td>
      <td>inf</td>
      <td>15.363990</td>
      <td>8.326614</td>
      <td>13.965788</td>
      <td>39.839439</td>
      <td>26.601406</td>
      <td>2.099390</td>
      <td>4.686255</td>
      <td>21.937558</td>
      <td>...</td>
      <td>5.097647</td>
      <td>34.577431</td>
      <td>42.060108</td>
      <td>14.063632</td>
      <td>42.060108</td>
      <td>5.049876</td>
      <td>6.830969</td>
      <td>40.484842</td>
      <td>1.808680</td>
      <td>14.456841</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10.475863</td>
      <td>15.363990</td>
      <td>inf</td>
      <td>7.195350</td>
      <td>2.653738</td>
      <td>54.549042</td>
      <td>41.853597</td>
      <td>13.661189</td>
      <td>18.304496</td>
      <td>36.104309</td>
      <td>...</td>
      <td>10.299402</td>
      <td>49.928916</td>
      <td>56.925712</td>
      <td>1.397385</td>
      <td>56.925712</td>
      <td>10.337038</td>
      <td>8.674609</td>
      <td>55.839475</td>
      <td>13.606217</td>
      <td>0.943614</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.402295</td>
      <td>8.326614</td>
      <td>7.195350</td>
      <td>inf</td>
      <td>5.643921</td>
      <td>47.391337</td>
      <td>34.926888</td>
      <td>6.501805</td>
      <td>11.133646</td>
      <td>29.822103</td>
      <td>...</td>
      <td>3.239187</td>
      <td>42.880277</td>
      <td>49.747776</td>
      <td>5.833864</td>
      <td>49.747776</td>
      <td>3.295760</td>
      <td>1.503112</td>
      <td>48.707466</td>
      <td>6.527458</td>
      <td>6.347179</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9.046000</td>
      <td>13.965788</td>
      <td>2.653738</td>
      <td>5.643921</td>
      <td>inf</td>
      <td>52.532333</td>
      <td>40.567164</td>
      <td>12.088727</td>
      <td>16.408137</td>
      <td>35.345303</td>
      <td>...</td>
      <td>8.883025</td>
      <td>48.487730</td>
      <td>54.961957</td>
      <td>1.674158</td>
      <td>54.961957</td>
      <td>8.938714</td>
      <td>7.134836</td>
      <td>54.253225</td>
      <td>12.162108</td>
      <td>2.483804</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>162</th>
      <td>0.183869</td>
      <td>5.049876</td>
      <td>10.337038</td>
      <td>3.295760</td>
      <td>8.938714</td>
      <td>44.493704</td>
      <td>31.639843</td>
      <td>3.370041</td>
      <td>8.341824</td>
      <td>26.596728</td>
      <td>...</td>
      <td>0.090157</td>
      <td>39.625372</td>
      <td>46.793616</td>
      <td>9.021147</td>
      <td>46.793616</td>
      <td>inf</td>
      <td>1.833858</td>
      <td>45.502887</td>
      <td>3.270795</td>
      <td>9.442309</td>
    </tr>
    <tr>
      <th>163</th>
      <td>1.921478</td>
      <td>6.830969</td>
      <td>8.674609</td>
      <td>1.503112</td>
      <td>7.134836</td>
      <td>45.960223</td>
      <td>33.432373</td>
      <td>5.001225</td>
      <td>9.708835</td>
      <td>28.425488</td>
      <td>...</td>
      <td>1.768291</td>
      <td>41.377557</td>
      <td>48.300994</td>
      <td>7.323990</td>
      <td>48.300994</td>
      <td>1.833858</td>
      <td>inf</td>
      <td>47.206600</td>
      <td>5.028487</td>
      <td>7.810194</td>
    </tr>
    <tr>
      <th>164</th>
      <td>45.366193</td>
      <td>40.484842</td>
      <td>55.839475</td>
      <td>48.707466</td>
      <td>54.253225</td>
      <td>12.149226</td>
      <td>15.249886</td>
      <td>42.205693</td>
      <td>38.013270</td>
      <td>24.755170</td>
      <td>...</td>
      <td>45.541763</td>
      <td>6.789646</td>
      <td>10.695838</td>
      <td>54.518494</td>
      <td>10.695838</td>
      <td>45.502887</td>
      <td>47.206600</td>
      <td>inf</td>
      <td>42.233258</td>
      <td>54.938726</td>
    </tr>
    <tr>
      <th>165</th>
      <td>3.139680</td>
      <td>1.808680</td>
      <td>13.606217</td>
      <td>6.527458</td>
      <td>12.162108</td>
      <td>41.375773</td>
      <td>28.405702</td>
      <td>0.756038</td>
      <td>5.558903</td>
      <td>23.675006</td>
      <td>...</td>
      <td>3.312655</td>
      <td>36.359838</td>
      <td>43.637580</td>
      <td>12.291750</td>
      <td>43.637580</td>
      <td>3.270795</td>
      <td>5.028487</td>
      <td>42.233258</td>
      <td>inf</td>
      <td>12.707747</td>
    </tr>
    <tr>
      <th>166</th>
      <td>9.584765</td>
      <td>14.456841</td>
      <td>0.943614</td>
      <td>6.347179</td>
      <td>2.483804</td>
      <td>53.731902</td>
      <td>40.924593</td>
      <td>12.780661</td>
      <td>17.476788</td>
      <td>35.161267</td>
      <td>...</td>
      <td>9.407212</td>
      <td>49.012123</td>
      <td>56.094462</td>
      <td>0.842200</td>
      <td>56.094462</td>
      <td>9.442309</td>
      <td>7.810194</td>
      <td>54.938726</td>
      <td>12.707747</td>
      <td>inf</td>
    </tr>
  </tbody>
</table>
<p>167 rows × 167 columns</p>
</div></div></div>
</div>
<p>Now let’s look at the distance between city 0 and some other cities.</p>
<p>We can look at city 0 with its respective <code class="docutils literal notranslate"><span class="pre">longitude</span></code> and <code class="docutils literal notranslate"><span class="pre">latitude</span></code> values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_train_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>160</th>
      <td>-76.4813</td>
      <td>44.2307</td>
      <td>Canada</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And the distances from city 0 to the other cities in the training dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([        inf,  4.92866046, 10.47586257,  3.40229467,  9.04600003,
       44.32913545, 31.52572108,  3.21281701,  8.16734667, 26.52975665,
        5.36451793, 17.47354208,  9.25235538, 46.65300827, 12.91711643,
        8.73732272, 21.41984759, 46.10101237, 11.38925694,  8.45258153,
        3.29603996, 12.90216965, 25.43541008,  2.57167487, 35.80191816,
       54.77569987,  2.77064993,  4.74762925, 21.11653758, 46.84711517,
       18.63306299, 42.68410294, 21.26505054, 46.58691036, 23.62784332,
        4.45224202,  4.47636916, 36.52381145,  9.25295786,  6.83445279,
        3.32357247,  8.16734667, 31.19662805,  7.79242035,  1.42424148,
       23.99849627, 38.17792497,  4.94149717, 21.5518279 ,  9.51787313,
       38.19275017, 37.97055885,  2.97880445,  9.51483002, 37.1901251 ,
       54.83532899,  1.28350735, 10.0044146 ,  3.28029451, 45.92971431,
       11.01430039,  3.19225293, 46.38943202,  2.96693525,  9.04600003,
       35.80001702,  2.76505999,  3.07231406, 36.96774058, 38.19559327,
        3.10919556,  7.39488827,  2.95943349, 11.50351059,  3.93684711,
       42.2793155 ,  9.14918312,  6.83445279, 46.91610836, 43.38757936,
        3.5288519 , 46.38746533,  3.93581626,  2.96373905, 21.27058643,
       18.66494501, 26.50025275,  6.82764827,  4.7396424 ,  9.9874779 ,
        6.83549241, 13.13067545, 46.50627115, 26.49966844, 28.81491391,
       45.97271218, 46.90321547,  5.73649067, 59.62262041,  1.09761148,
        6.08870392,  5.73454545, 46.21089504,  9.03328701,  7.92447701,
       23.80155222, 47.07123507,  8.73468637,  2.74816746,  3.07662193,
        3.22855068,  3.63284771, 19.68277227,  2.82337311,  3.43691007,
        7.93860597, 46.85396601, 16.3288186 , 46.23882897, 43.94670281,
       28.85319232,  2.91163454,  2.88081958, 16.80079704, 23.7934676 ,
        3.9286773 ,  2.86603875,  3.32357247,  1.07865087,  8.4376414 ,
        6.82764827,  3.0717763 ,  4.45272866,  9.11228649,  4.08772282,
        2.86603875, 34.6881178 ,  1.8400926 ,  3.03326165, 23.32224009,
       46.10101237, 46.83865522, 22.78600867, 28.85530775, 18.81002995,
       46.69549579, 13.44345687, 17.34527477,  6.75905672,  5.89141512,
        3.13784784,  3.47624672, 42.98365051, 43.00228242, 10.65641958,
        3.80625889,  1.42924216,  0.18047839, 39.49899714, 46.63239678,
        9.15409025, 46.63239678,  0.18386865,  1.92147809, 45.36619339,
        3.13968038,  9.58476504])
</pre></div>
</div>
</div>
</div>
<p>Remember that our goal is to find the closest example to city 0.</p>
<p>We can find the closest city to city 0 by finding the city with the minimum distance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dists</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>157
</pre></div>
</div>
</div>
</div>
<p>The closest city in the training dataset is the city with index 157.</p>
<p>This corresponds to index 96 from the original dataset before shuffling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_train_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">157</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>96</th>
      <td>-76.3019</td>
      <td>44.211</td>
      <td>Canada</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we look at the <code class="docutils literal notranslate"><span class="pre">longitude</span></code> and <code class="docutils literal notranslate"><span class="pre">latitude</span></code> values for the city at index 157 (labelled 96), they look pretty close to those of city 0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_train_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>160</th>
      <td>-76.4813</td>
      <td>44.2307</td>
      <td>Canada</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">157</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.1804783920605758
</pre></div>
</div>
</div>
</div>
<p>So, in this case, the closest city to city 0 is city 157 and the Euclidean distance between the two cities is 0.184.</p>
<div class="section" id="nearest-city-to-a-query-point">
<h3><span class="section-number">3.9.1. </span>Nearest city to a query point<a class="headerlink" href="#nearest-city-to-a-query-point" title="Permalink to this headline">¶</a></h3>
<p>We can also find the distances to a new “test” or “query” city:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query_point</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">25</span><span class="p">]]</span>


<span class="n">dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">cities_train_df</span><span class="p">[[</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">]],</span> <span class="n">query_point</span><span class="p">)</span>
<span class="n">dists</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[19.54996348],
       [18.02706204],
       [24.60912622],
       [21.39718237],
       [25.24111312],
       [47.81750619],
       [28.49499735],
       [19.39177482],
       [21.95316686],
       [19.01698738]])
</pre></div>
</div>
</div>
</div>
<p>We can find the city closest to the query point (-80, 25) using:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>147
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dists</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([3.83839229])
</pre></div>
</div>
</div>
</div>
<p>So the city at index 147 is the closest point to (-80, 25) with the Euclidean distance between the two equal to 3.838</p>
<p>We can also use Sklearn’s <code class="docutils literal notranslate"><span class="pre">NearestNeighbors</span></code> function to get the closest example and the distance between the query point and the closest example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cities_train_df</span><span class="p">[[</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">]]);</span>
<span class="n">nn</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">([[</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">25</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([[3.83839229]]), array([[147]]))
</pre></div>
</div>
</div>
</div>
<p>We can also use <code class="docutils literal notranslate"><span class="pre">kneighbors</span></code> to find the 5 nearest cities in the training split to one of the cities in the test split.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_test_X</span> <span class="o">=</span> <span class="n">cities_test_df</span><span class="p">[[</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">]]</span>

<span class="n">nn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">nn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cities_train_df</span><span class="p">[[</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">]]);</span>
<span class="n">nn</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">cities_test_X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">55</span><span class="o">-</span><span class="n">aa1385389c22</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">nn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">nn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cities_train_df</span><span class="p">[[</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">]]);</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">nn</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">cities_test_X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nn">/usr/local/lib/python3.8/site-packages/sklearn/neighbors/_base.py</span> in <span class="ni">kneighbors</span><span class="nt">(self, X, n_neighbors, return_distance)</span>
<span class="g g-Whitespace">    </span><span class="mi">604</span>                 <span class="n">X</span> <span class="o">=</span> <span class="n">_check_precomputed</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">605</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">606</span>                 <span class="n">X</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">accept_sparse</span><span class="o">=</span><span class="s1">&#39;csr&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">607</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span>             <span class="n">query_is_train</span> <span class="o">=</span> <span class="kc">True</span>

<span class="nn">/usr/local/lib/python3.8/site-packages/sklearn/utils/validation.py</span> in <span class="ni">inner_f</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>                           <span class="ne">FutureWarning</span><span class="p">)</span>
<span class="nn">     71         kwargs.update({k: arg for k, arg</span> in <span class="ni">zip</span><span class="nt">(sig.parameters, args)})</span>
<span class="ne">---&gt; </span><span class="mi">72</span>         <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span>     <span class="k">return</span> <span class="n">inner_f</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> 

<span class="nn">/usr/local/lib/python3.8/site-packages/sklearn/utils/validation.py</span> in <span class="ni">check_array</span><span class="nt">(array, accept_sparse, accept_large_sparse, dtype, order, copy, force_all_finite, ensure_2d, allow_nd, ensure_min_samples, ensure_min_features, estimator)</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span>             <span class="c1"># If input is 1D raise error</span>
<span class="g g-Whitespace">    </span><span class="mi">618</span>             <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">619</span>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">620</span>                     <span class="s2">&quot;Expected 2D array, got 1D array instead:</span><span class="se">\n</span><span class="s2">array=</span><span class="si">{}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">621</span>                     <span class="s2">&quot;Reshape your data either using array.reshape(-1, 1) if &quot;</span>

<span class="ne">ValueError</span>: Expected 2D array, got 1D array instead:
<span class="n">array</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">82.4066</span>  <span class="mf">42.9746</span><span class="p">]</span><span class="o">.</span>
<span class="n">Reshape</span> <span class="n">your</span> <span class="n">data</span> <span class="n">either</span> <span class="n">using</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">your</span> <span class="n">data</span> <span class="n">has</span> <span class="n">a</span> <span class="n">single</span> <span class="n">feature</span> <span class="ow">or</span> <span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">it</span> <span class="n">contains</span> <span class="n">a</span> <span class="n">single</span> <span class="n">sample</span><span class="o">.</span>
</pre></div>
</div>
</div>
</div>
<p>We need to be careful here though because we need to make sure we pass in a 2D NumPy array as an input.
This can be fixed using 2 sets of square brackets with our city.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nn</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">cities_test_X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">1</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([[0.03461517, 0.90722048, 0.90722048, 0.90970871, 0.90970871]]),
 array([[100,  77,  39, 130,  87]]))
</pre></div>
</div>
</div>
</div>
<p>This now shows us the 5 distances to the 5 closest cities and their index.</p>
</div>
</div>
<div class="section" id="id1">
<h2><span class="section-number">3.10. </span>Let’s Practice<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       <span class="n">seeds</span>   <span class="n">shape</span>  <span class="n">sweetness</span>   <span class="n">water</span><span class="o">-</span><span class="n">content</span>      <span class="n">weight</span>    <span class="n">fruit_veg</span>
<span class="mi">0</span>      <span class="mi">1</span>        <span class="mi">0</span>        <span class="mi">35</span>          <span class="mi">84</span>               <span class="mi">100</span>        <span class="n">fruit</span>
<span class="mi">1</span>      <span class="mi">0</span>        <span class="mi">0</span>        <span class="mi">23</span>          <span class="mi">75</span>               <span class="mi">120</span>        <span class="n">fruit</span>
<span class="mi">2</span>      <span class="mi">1</span>        <span class="mi">1</span>        <span class="mi">15</span>          <span class="mi">90</span>              <span class="mi">1360</span>         <span class="n">veg</span>
<span class="mi">3</span>      <span class="mi">1</span>        <span class="mi">1</span>         <span class="mi">7</span>          <span class="mi">96</span>               <span class="mi">600</span>         <span class="n">veg</span>
<span class="mi">4</span>      <span class="mi">0</span>        <span class="mi">0</span>        <span class="mi">37</span>          <span class="mi">80</span>                 <span class="mi">5</span>        <span class="n">fruit</span>
<span class="mi">5</span>      <span class="mi">0</span>        <span class="mi">0</span>        <span class="mi">45</span>          <span class="mi">78</span>                <span class="mi">40</span>        <span class="n">fruit</span>  
<span class="mi">6</span>      <span class="mi">1</span>        <span class="mi">0</span>        <span class="mi">27</span>          <span class="mi">83</span>               <span class="mi">450</span>         <span class="n">veg</span>
<span class="mi">7</span>      <span class="mi">1</span>        <span class="mi">1</span>        <span class="mi">18</span>          <span class="mi">73</span>                 <span class="mi">5</span>         <span class="n">veg</span>
<span class="mi">8</span>      <span class="mi">1</span>        <span class="mi">1</span>        <span class="mi">32</span>          <span class="mi">80</span>                <span class="mi">76</span>         <span class="n">veg</span>
<span class="mi">9</span>      <span class="mi">0</span>        <span class="mi">0</span>        <span class="mi">40</span>          <span class="mi">83</span>                <span class="mi">65</span>        <span class="n">fruit</span>
</pre></div>
</div>
<p>1. Giving the table above and that we are trying to predict if each example is either a fruit or a vegetable, what would be the dimension of feature vectors in this problem?</p>
<p>2. Which of the following would be the feature vector for example 0.</p>
<p>a) <code class="docutils literal notranslate"><span class="pre">array([1,</span>&#160; <span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">1,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">1,</span> <span class="pre">1,</span> <span class="pre">0])</span></code><br />
b) <code class="docutils literal notranslate"><span class="pre">array([fruit,</span>&#160; <span class="pre">fruit,</span> <span class="pre">veg,</span> <span class="pre">veg,</span> <span class="pre">fruit,</span> <span class="pre">fruit,</span> <span class="pre">veg,</span> <span class="pre">veg,</span> <span class="pre">veg,</span> <span class="pre">fruit])</span></code><br />
c) <code class="docutils literal notranslate"><span class="pre">array([1,</span> <span class="pre">0,</span> <span class="pre">35,</span> <span class="pre">84,</span> <span class="pre">100])</span></code><br />
d) <code class="docutils literal notranslate"><span class="pre">array([1,</span> <span class="pre">0,</span> <span class="pre">35,</span> <span class="pre">84,</span> <span class="pre">100,</span>&#160; <span class="pre">fruit])</span></code></p>
<p>3. Given the following 2 feature vectors, what is the Euclidean distance between the following two feature vectors?</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="o">-</span><span class="mi">11</span><span class="p">])</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">])</span>
</pre></div>
</div>
<p><strong>True or False</strong></p>
<p>4. Analogy-based models find examples from the test set that are most similar to the test example we are predicting.<br />
5. Feature vectors can only be of length 3 since we cannot visualize past that.<br />
6. A dataset with 10 dimensions is considered low dimensional.<br />
7. Euclidean distance will always have a positive value.<br />
8. When finding the nearest neighbour in a dataset using <code class="docutils literal notranslate"><span class="pre">kneighbors()</span></code> from the <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> library, we must <code class="docutils literal notranslate"><span class="pre">fit</span></code>  the data first.<br />
9. Calculating the distances between an example and a query point takes twice as long as calculating the distances between two examples.</p>
<div class="dropdown admonition">
<p class="admonition-title">Solutions!</p>
<ol class="simple">
<li><p>5 dimensions.</p></li>
<li><p>c) <code class="docutils literal notranslate"><span class="pre">array([1,</span> <span class="pre">0,</span> <span class="pre">35,</span> <span class="pre">84,</span> <span class="pre">100])</span></code></p></li>
<li><p>7</p></li>
<li><p>False</p></li>
<li><p>False</p></li>
<li><p>True</p></li>
<li><p>True</p></li>
<li><p>True (0 and positive)</p></li>
<li><p>False</p></li>
</ol>
</div>
</div>
<div class="section" id="k-nearest-neighbours-k-nns-classifier">
<h2><span class="section-number">3.11. </span><span class="math notranslate nohighlight">\(k\)</span> -Nearest Neighbours (<span class="math notranslate nohighlight">\(k\)</span>-NNs) Classifier<a class="headerlink" href="#k-nearest-neighbours-k-nns-classifier" title="Permalink to this headline">¶</a></h2>
<p>Now that we have learned how to find similar examples, can we use this idea in a predictive model?</p>
<ul class="simple">
<li><p>Yes! The k Nearest Neighbors (kNN) algorithm</p></li>
<li><p>This is a fairly simple algorithm that is best understood by example</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/scatter.png"><img alt="404 image" src="../_images/scatter.png" style="width: 30%;" /></a>
<p>We have two features in our toy example; feature 1 and feature 2.</p>
<p>We have two targets; 0 represented with  <font color="blue">blue</font> points and 1 represented with  <font color="orange">orange</font> points.</p>
<p>We want to predict the point in gray.</p>
<p>Based on what we have been doing so far, we can find the closest example (<span class="math notranslate nohighlight">\(k\)</span>=1) to this gray point and use its class as the class for our grey point.</p>
<p>In this particular case, we will predict orange as the class for our query point.</p>
<a class="reference internal image-reference" href="../_images/scatter_k1.png"><img alt="404 image" src="../_images/scatter_k1.png" style="width: 30%;" /></a>
<p>What if we consider more than one nearest example and let them vote on the target of the query example.</p>
<p>Let’s consider the nearest 3 neighbours and let them vote.</p>
<a class="reference internal image-reference" href="../_images/scatter_k3.png"><img alt="404 image" src="../_images/scatter_k3.png" style="width: 30%;" /></a>
<p>Let’s try this with a smaller set of our data and <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">small_train_df</span> <span class="o">=</span> <span class="n">cities_train_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1223</span><span class="p">)</span>
<span class="n">small_X_train</span> <span class="o">=</span> <span class="n">small_train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">])</span>
<span class="n">small_y_train</span> <span class="o">=</span> <span class="n">small_train_df</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">one_city</span> <span class="o">=</span> <span class="n">cities_test_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">33</span><span class="p">)</span>
<span class="n">one_city</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>195</th>
      <td>-122.7454</td>
      <td>53.9129</td>
      <td>Canada</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chart_knn</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">small_train_df</span><span class="p">)</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">140</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">])),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">])),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Canada&#39;</span><span class="p">,</span> <span class="s1">&#39;USA&#39;</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">])))</span>

<span class="n">one_city_point</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">one_city</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">(</span>
    <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;triangle-up&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">chart_knn</span> <span class="o">+</span>  <span class="n">one_city_point</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-66cce99210e344fba91d2863232f9cc7"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-66cce99210e344fba91d2863232f9cc7") {
      outputDiv = document.getElementById("altair-viz-66cce99210e344fba91d2863232f9cc7");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"data": {"name": "data-615c3b712bf8c90518c486c9e85be698"}, "mark": "circle", "encoding": {"color": {"type": "nominal", "field": "country", "scale": {"domain": ["Canada", "USA"], "range": ["red", "blue"]}}, "x": {"type": "quantitative", "field": "longitude", "scale": {"domain": [-140, -40]}}, "y": {"type": "quantitative", "field": "latitude", "scale": {"domain": [20, 60]}}}}, {"data": {"name": "data-d0ae25a3f6b392271f284534b330ba9e"}, "mark": {"type": "point", "fill": "darkgreen", "opacity": 1, "shape": "triangle-up", "size": 400}, "encoding": {"x": {"type": "quantitative", "field": "longitude"}, "y": {"type": "quantitative", "field": "latitude"}}}], "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-615c3b712bf8c90518c486c9e85be698": [{"longitude": -79.4608, "latitude": 46.3092, "country": "Canada"}, {"longitude": -84.3902, "latitude": 33.7491, "country": "USA"}, {"longitude": -67.4253, "latitude": 45.5672, "country": "Canada"}, {"longitude": -97.7437, "latitude": 30.2711, "country": "USA"}, {"longitude": -97.1385, "latitude": 49.8955, "country": "Canada"}, {"longitude": -82.4584, "latitude": 27.9478, "country": "USA"}, {"longitude": -71.1473, "latitude": 48.382, "country": "Canada"}, {"longitude": -104.9849, "latitude": 39.7392, "country": "USA"}, {"longitude": -76.3305, "latitude": 44.1255, "country": "USA"}, {"longitude": -76.4813, "latitude": 44.2307, "country": "Canada"}, {"longitude": -111.8315, "latitude": 33.4151, "country": "USA"}, {"longitude": -115.1485, "latitude": 36.1673, "country": "USA"}, {"longitude": -102.5496, "latitude": 48.9959, "country": "USA"}, {"longitude": -68.5897, "latitude": 47.2587, "country": "USA"}, {"longitude": -71.0692, "latitude": 48.406000000000006, "country": "Canada"}, {"longitude": -66.9905, "latitude": 44.9065, "country": "USA"}, {"longitude": -122.8491, "latitude": 49.1913, "country": "Canada"}, {"longitude": -84.3201, "latitude": 46.5239, "country": "Canada"}, {"longitude": -79.1153, "latitude": 43.101000000000006, "country": "Canada"}, {"longitude": -122.4199, "latitude": 37.779, "country": "USA"}, {"longitude": -122.6742, "latitude": 45.5202, "country": "USA"}, {"longitude": -66.9843, "latitude": 44.8607, "country": "USA"}, {"longitude": -71.3998, "latitude": 46.8884, "country": "Canada"}, {"longitude": -95.9384, "latitude": 41.2587, "country": "USA"}, {"longitude": -98.4951, "latitude": 29.4246, "country": "USA"}, {"longitude": -82.4405, "latitude": 42.9816, "country": "USA"}, {"longitude": -79.2506, "latitude": 42.9931, "country": "Canada"}, {"longitude": -118.1916, "latitude": 33.769, "country": "USA"}, {"longitude": -86.1584, "latitude": 39.7683, "country": "USA"}, {"longitude": -75.9774, "latitude": 36.853, "country": "USA"}], "data-d0ae25a3f6b392271f284534b330ba9e": [{"longitude": -122.7454, "latitude": 53.9129, "country": "Canada"}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>We want to find the class for this green triangle city.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>

<span class="n">neigh_clf</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">neigh_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">small_X_train</span><span class="p">,</span> <span class="n">small_y_train</span><span class="p">)</span>
<span class="n">neigh_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_city</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Canada&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>We can set <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code> equal to 1 to classify this triangle based on one neighbouring point.</p>
<p>Our prediction here is Canada since the closest point to the green triangle is a city with the class “Canada”.</p>
<p>Now, what if we consider the nearest 3 neighbours?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neigh_clf</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">neigh_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">small_X_train</span><span class="p">,</span> <span class="n">small_y_train</span><span class="p">)</span>
<span class="n">neigh_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">one_city</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;country&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;USA&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>When we change our model to consider the nearest 3 neighbours, our prediction changes!</p>
<p>It now predicts “USA” since the majority of the 3 nearest points are “USA” cities.</p>
<p>Let’s use our entire training dataset and calculate our training and validation scores</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_X_train</span> <span class="o">=</span> <span class="n">cities_train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">])</span>
<span class="n">cities_y_train</span> <span class="o">=</span> <span class="n">cities_train_df</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span>
<span class="n">cities_X_test</span> <span class="o">=</span> <span class="n">cities_test_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">])</span>
<span class="n">cities_y_test</span> <span class="o">=</span> <span class="n">cities_test_df</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span>


<span class="n">kn1_model</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">kn1_model</span><span class="p">,</span> <span class="n">cities_X_train</span><span class="p">,</span> <span class="n">cities_y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
<span class="n">scores_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.002669</td>
      <td>0.003742</td>
      <td>0.823529</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.002752</td>
      <td>0.002895</td>
      <td>0.705882</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.002319</td>
      <td>0.002516</td>
      <td>0.647059</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.002101</td>
      <td>0.002405</td>
      <td>0.941176</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.002126</td>
      <td>0.002730</td>
      <td>0.823529</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.003362</td>
      <td>0.002801</td>
      <td>0.588235</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.001995</td>
      <td>0.002371</td>
      <td>0.647059</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.002155</td>
      <td>0.003227</td>
      <td>0.812500</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.002191</td>
      <td>0.002434</td>
      <td>0.937500</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.002243</td>
      <td>0.002479</td>
      <td>0.750000</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit_time       0.002391
score_time     0.002760
test_score     0.767647
train_score    1.000000
dtype: float64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="choosing-k">
<h2><span class="section-number">3.12. </span>Choosing K<a class="headerlink" href="#choosing-k" title="Permalink to this headline">¶</a></h2>
<p>Ok, so we saw our validation and training scores for <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code> =1. What happens when we change that?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kn90_model</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="n">scores_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">kn90_model</span><span class="p">,</span> <span class="n">cities_X_train</span><span class="p">,</span> <span class="n">cities_y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">scores_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fit_time</th>
      <th>score_time</th>
      <th>test_score</th>
      <th>train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.003470</td>
      <td>0.003227</td>
      <td>0.705882</td>
      <td>0.620000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.002318</td>
      <td>0.002933</td>
      <td>0.588235</td>
      <td>0.620000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.001890</td>
      <td>0.002301</td>
      <td>0.588235</td>
      <td>0.633333</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.001836</td>
      <td>0.002223</td>
      <td>0.588235</td>
      <td>0.606667</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.001801</td>
      <td>0.002955</td>
      <td>0.588235</td>
      <td>0.620000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.001702</td>
      <td>0.002397</td>
      <td>0.588235</td>
      <td>0.633333</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.002265</td>
      <td>0.002482</td>
      <td>0.647059</td>
      <td>0.700000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.001925</td>
      <td>0.002901</td>
      <td>0.625000</td>
      <td>0.629139</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.002337</td>
      <td>0.002940</td>
      <td>0.687500</td>
      <td>0.622517</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.001635</td>
      <td>0.002180</td>
      <td>0.625000</td>
      <td>0.629139</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fit_time       0.002118
score_time     0.002654
test_score     0.623162
train_score    0.631413
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Comparing this with the results of <code class="docutils literal notranslate"><span class="pre">n_neighbors=1</span></code> we see that we went from overfitting to underfitting.</p>
<p>Let’s look at the decision boundaries now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">kn1_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cities_X_train</span><span class="p">,</span> <span class="n">cities_y_train</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;n_neighbors = 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">)</span>
<span class="n">plot_classifier</span><span class="p">(</span><span class="n">cities_X_train</span><span class="p">,</span> <span class="n">cities_y_train</span><span class="p">,</span> <span class="n">kn1_model</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;n_neighbors = 90&quot;</span><span class="p">)</span>
<span class="n">kn90_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cities_X_train</span><span class="p">,</span> <span class="n">cities_y_train</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">)</span>
<span class="n">plot_classifier</span><span class="p">(</span><span class="n">cities_X_train</span><span class="p">,</span> <span class="n">cities_y_train</span><span class="p">,</span> <span class="n">kn90_model</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;n_neighbors = 90&#39;}, xlabel=&#39;longitude&#39;, ylabel=&#39;latitude&#39;&gt;
</pre></div>
</div>
<img alt="../_images/lecture3_144_1.png" src="../_images/lecture3_144_1.png" />
</div>
</div>
<p>If we plot these two models with <span class="math notranslate nohighlight">\(k=1\)</span> on the left and <span class="math notranslate nohighlight">\(k=90\)</span> on the right.</p>
<p>The left plot shows a much more complex model where it is much more specific and attempts to get every example correct.</p>
<p>The plot on right is plotting a simpler model and we can see more training examples are being predicted incorrectly.</p>
<div class="section" id="how-to-choose-k-n-neighbors">
<h3><span class="section-number">3.12.1. </span>How to choose <span class="math notranslate nohighlight">\(K\)</span> (<code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code>)?<a class="headerlink" href="#how-to-choose-k-n-neighbors" title="Permalink to this headline">¶</a></h3>
<p>So we saw the model was overfitting with <span class="math notranslate nohighlight">\(k\)</span>=1 and  when <span class="math notranslate nohighlight">\(k\)</span>=100, the model was underfitting.</p>
<p>So, the question is how do we pick <span class="math notranslate nohighlight">\(k\)</span>?</p>
<ul class="simple">
<li><p>Since <span class="math notranslate nohighlight">\(k\)</span> is a hyperparameter (<code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code> in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>), we can use hyperparameter optimization to choose <span class="math notranslate nohighlight">\(k\)</span>.</p></li>
</ul>
<p>Here we are looping over different values of <span class="math notranslate nohighlight">\(k\)</span> and performing cross-validation on each one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;n_neighbors&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span> <span class="s2">&quot;mean_train_score&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span> <span class="s2">&quot;mean_cv_score&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">()}</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">knn</span><span class="p">,</span> <span class="n">cities_X_train</span><span class="p">,</span> <span class="n">cities_y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;n_neighbors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;mean_cv_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;test_score&quot;</span><span class="p">]))</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;mean_train_score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;train_score&quot;</span><span class="p">]))</span>

<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
<span class="n">results_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_neighbors</th>
      <th>mean_train_score</th>
      <th>mean_cv_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1.000000</td>
      <td>0.767647</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6</td>
      <td>0.841660</td>
      <td>0.785662</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11</td>
      <td>0.823051</td>
      <td>0.811029</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16</td>
      <td>0.807726</td>
      <td>0.793382</td>
    </tr>
    <tr>
      <th>4</th>
      <td>21</td>
      <td>0.777810</td>
      <td>0.756985</td>
    </tr>
    <tr>
      <th>5</th>
      <td>26</td>
      <td>0.765854</td>
      <td>0.739338</td>
    </tr>
    <tr>
      <th>6</th>
      <td>31</td>
      <td>0.758525</td>
      <td>0.738971</td>
    </tr>
    <tr>
      <th>7</th>
      <td>36</td>
      <td>0.738583</td>
      <td>0.720221</td>
    </tr>
    <tr>
      <th>8</th>
      <td>41</td>
      <td>0.725912</td>
      <td>0.726471</td>
    </tr>
    <tr>
      <th>9</th>
      <td>46</td>
      <td>0.733916</td>
      <td>0.713971</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotting_source</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">,</span> 
                                  <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean_train_score&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_cv_score&#39;</span><span class="p">],</span> 
                                  <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;score_type&#39;</span> <span class="p">,</span>
                                  <span class="n">value_name</span><span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span> <span class="p">)</span>
                                  
                                  
<span class="n">K_plot</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">plotting_source</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;n_neighbors:Q&#39;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;accuracy:Q&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">67</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">])),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;score_type:N&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Accuracies of n_neighbors for KNeighborsClassifier&quot;</span><span class="p">)</span>

<span class="n">K_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-fe56664e21134882a4735b2c96154adf"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-fe56664e21134882a4735b2c96154adf") {
      outputDiv = document.getElementById("altair-viz-fe56664e21134882a4735b2c96154adf");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-0a30ebbeafb719cb7f4a23a7432da33a"}, "mark": "line", "encoding": {"color": {"type": "nominal", "field": "score_type"}, "x": {"type": "quantitative", "field": "n_neighbors"}, "y": {"type": "quantitative", "field": "accuracy", "scale": {"domain": [0.67, 1.0]}}}, "height": 300, "title": "Accuracies of n_neighbors for KNeighborsClassifier", "width": 500, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-0a30ebbeafb719cb7f4a23a7432da33a": [{"n_neighbors": 1, "score_type": "mean_train_score", "accuracy": 1.0}, {"n_neighbors": 6, "score_type": "mean_train_score", "accuracy": 0.8416600441501103}, {"n_neighbors": 11, "score_type": "mean_train_score", "accuracy": 0.8230507726269316}, {"n_neighbors": 16, "score_type": "mean_train_score", "accuracy": 0.8077262693156733}, {"n_neighbors": 21, "score_type": "mean_train_score", "accuracy": 0.7778101545253863}, {"n_neighbors": 26, "score_type": "mean_train_score", "accuracy": 0.7658543046357617}, {"n_neighbors": 31, "score_type": "mean_train_score", "accuracy": 0.7585253863134657}, {"n_neighbors": 36, "score_type": "mean_train_score", "accuracy": 0.7385827814569536}, {"n_neighbors": 41, "score_type": "mean_train_score", "accuracy": 0.7259116997792494}, {"n_neighbors": 46, "score_type": "mean_train_score", "accuracy": 0.7339161147902871}, {"n_neighbors": 1, "score_type": "mean_cv_score", "accuracy": 0.7676470588235293}, {"n_neighbors": 6, "score_type": "mean_cv_score", "accuracy": 0.7856617647058823}, {"n_neighbors": 11, "score_type": "mean_cv_score", "accuracy": 0.8110294117647058}, {"n_neighbors": 16, "score_type": "mean_cv_score", "accuracy": 0.7933823529411764}, {"n_neighbors": 21, "score_type": "mean_cv_score", "accuracy": 0.7569852941176471}, {"n_neighbors": 26, "score_type": "mean_cv_score", "accuracy": 0.7393382352941177}, {"n_neighbors": 31, "score_type": "mean_cv_score", "accuracy": 0.7389705882352942}, {"n_neighbors": 36, "score_type": "mean_cv_score", "accuracy": 0.7202205882352942}, {"n_neighbors": 41, "score_type": "mean_cv_score", "accuracy": 0.7264705882352942}, {"n_neighbors": 46, "score_type": "mean_cv_score", "accuracy": 0.7139705882352942}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<p>Looking at this graph with k on the x-axis and accuracy on the y-axis, we can see there is a sweet spot where the gap between the validation and training scores is the lowest and cross-validation score is the highest. Here it’s when <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code> is 11.</p>
<p>How do I know it’s 11?
Here’s how!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean_cv_score&quot;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_neighbors</th>
      <th>mean_train_score</th>
      <th>mean_cv_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>11</td>
      <td>0.823051</td>
      <td>0.811029</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16</td>
      <td>0.807726</td>
      <td>0.793382</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6</td>
      <td>0.841660</td>
      <td>0.785662</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1.000000</td>
      <td>0.767647</td>
    </tr>
    <tr>
      <th>4</th>
      <td>21</td>
      <td>0.777810</td>
      <td>0.756985</td>
    </tr>
    <tr>
      <th>5</th>
      <td>26</td>
      <td>0.765854</td>
      <td>0.739338</td>
    </tr>
    <tr>
      <th>6</th>
      <td>31</td>
      <td>0.758525</td>
      <td>0.738971</td>
    </tr>
    <tr>
      <th>8</th>
      <td>41</td>
      <td>0.725912</td>
      <td>0.726471</td>
    </tr>
    <tr>
      <th>7</th>
      <td>36</td>
      <td>0.738583</td>
      <td>0.720221</td>
    </tr>
    <tr>
      <th>9</th>
      <td>46</td>
      <td>0.733916</td>
      <td>0.713971</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cities_X_train</span><span class="p">,</span> <span class="n">cities_y_train</span><span class="p">);</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test accuracy:&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">cities_X_test</span><span class="p">,</span> <span class="n">cities_y_test</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test accuracy: 0.857
</pre></div>
</div>
</div>
</div>
<p>This testing accuracy surprisingly higher than the validation mean accuracy we had earlier.</p>
<p>This could be due to having a small dataset.</p>
</div>
</div>
<div class="section" id="curse-of-dimensionality">
<h2><span class="section-number">3.13. </span>Curse of Dimensionality<a class="headerlink" href="#curse-of-dimensionality" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(k\)</span> -NN usually works well when the number of dimensions is small.</p>
</div></blockquote>
<p>In the previous module, we discussed one of the most important problems in machine learning which was overfitting the second most important problem in machine learning is <strong>the curse of dimensionality</strong>.</p>
<p>If there are many irrelevant features, <span class="math notranslate nohighlight">\(k\)</span>-NN is hopelessly confused because all of them contribute to finding similarities between examples.</p>
<p>With enough irrelevant features, the accidental similarity between features wips out any meaningful similarity and <span class="math notranslate nohighlight">\(k\)</span>-NN becomes is no better than random guessing.</p>
</div>
<div class="section" id="id2">
<h2><span class="section-number">3.14. </span>Let’s Practice<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Consider this toy dataset:</p>
<div class="math notranslate nohighlight">
\[\begin{split} X = \begin{bmatrix}5 &amp; 2\\4 &amp; 3\\  2 &amp; 2\\ 10 &amp; 10\\ 9 &amp; -1\\ 9&amp; 9\end{bmatrix}, \quad y = \begin{bmatrix}0\\0\\1\\1\\1\\2\end{bmatrix}.\end{split}\]</div>
<p>What would you predict for <span class="math notranslate nohighlight">\(x=\begin{bmatrix} 0\\0\end{bmatrix}\)</span>:</p>
<p>1. If <span class="math notranslate nohighlight">\(k=1\)</span>?<br />
2. If <span class="math notranslate nohighlight">\(k=3\)</span>?</p>
<p><strong>True or False</strong></p>
<p>3. The classification of the closest neighbour to the test example always contributes the most to the prediction.<br />
4. The <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code> hyperparameter must be less than the number of examples in the training set.<br />
5. Similar to decision trees, <span class="math notranslate nohighlight">\(k\)</span>-NNs find a small set of good features.<br />
6. With  <span class="math notranslate nohighlight">\(k\)</span> -NN, setting the hyperparameter  <span class="math notranslate nohighlight">\(k\)</span>  to larger values typically increases training score.<br />
7. <span class="math notranslate nohighlight">\(k\)</span>-NN may perform poorly in high-dimensional space (say, d &gt; 100)</p>
<p>Consider this graph:</p>
<a class="reference internal image-reference" href="../_images/Q18a.png"><img alt="404 image" src="../_images/Q18a.png" style="width: 70%;" /></a>
<p>8. What value of <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code> would you choose to train your model on?</p>
<div class="dropdown admonition">
<p class="admonition-title">Solutions!</p>
<ol class="simple">
<li><p>1</p></li>
<li><p>0</p></li>
<li><p>False</p></li>
<li><p>True</p></li>
<li><p>False</p></li>
<li><p>False</p></li>
<li><p>True</p></li>
<li><p>12</p></li>
</ol>
</div>
</div>
<div class="section" id="what-we-ve-learned-today-a-id-9-a">
<h2><span class="section-number">3.15. </span>What We’ve Learned Today<a id="9"></a><a class="headerlink" href="#what-we-ve-learned-today-a-id-9-a" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The concept of baseline models.</p></li>
<li><p>How to initiate a Dummy Classifier and Regressor.</p></li>
<li><p>How to measure Euclidean distance.</p></li>
<li><p>How the <span class="math notranslate nohighlight">\(k\)</span>NN algorithm works for classification.</p></li>
<li><p>How changing <span class="math notranslate nohighlight">\(k\)</span> (<code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code>) affects a model.</p></li>
<li><p>What the curse of dimensionality is.</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "bait509-ubc/BAIT509",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="lecture2.html" title="previous page"><span class="section-number">2. </span>Splitting and Cross-validation</a>
    <a class='right-next' id="next-link" href="lecture4.html" title="next page"><span class="section-number">4. </span>SVM with RBF Kernel and Feature Preprocessing</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hayley Boyce<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>